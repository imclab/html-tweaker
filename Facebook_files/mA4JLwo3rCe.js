/*1347249233,173217057*/

if (window.CavalryLogger) { CavalryLogger.start_js(["NQTqY"]); }

__d("CustomPrivacyOption",["event-extensions","Arbiter","AsyncRequest","Dialog","DOM","Form","ge","Parent","PrivacyConst","Selector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Dialog'),j=b('DOM'),k=b('Form'),l=b('ge'),m=b('Parent'),n=b('PrivacyConst'),o=b('Selector'),p=b('copyProperties');function q(r,s,t,u,v,w){if(!r)return;this.initx(r,s,t,u,v,w);}p(q,{_instances:{},update:function(r,s,t,u){var v=q._instances[r];v._update(s,t)._updateOption(t,u);g.inform('Form/change',{node:v._container});},getData:function(r){return q._instances[r]._privacyData;}});p(q.prototype,{init:function(r,s,t,u,v){var w=l(r);this.initx(w,r,s,t,u,v);},initx:function(r,s,t,u,v,w){(function(){this.initCustomState(r,s,t);Event.listen(r,'click',function(event){this.openCustomDialog(event,s,u,w);}.bind(this));this._initSelector(r,v);}).bind(this).defer();},_initSelector:function(r,s){this._selector=m.byClass(r,'uiSelector');o.listen(this._selector,'select',function(t){if(t.option._id!=this._id)this.clearCustomState();}.bind(this));if(s)o.setButtonTooltip(this._selector,s);},_updateOption:function(r,s){var t=o.getOption(this._selector,r)||o.getOption(this._selector,n.BaseValue.CUSTOM+'');g.inform('CustomPrivacyOption/update',{selector:this._selector,option:t,tooltip:s});return this;},_update:function(r,s){var t=s==n.BaseValue.CUSTOM||!o.getOption(this._selector,s),u=this._selector.getAttribute('data-name');this.updateCustomState(r,t,u);return this;},initCustomState:function(r,s,t){q._instances[s]=this;this._container=j.find(r,'.customPrivacyInputs');this._id=t;this._privacyData={};var u=k.serialize(this._container);if(u.audience)this._privacyData=u.audience[t];return r;},openCustomDialog:function(event,r,s,t){var u=new h('/ajax/privacy/custom_dialog/').setData({option_id:r,id:this._id,privacy_data:this._privacyData,explain_tags:s,autosave:t});new i().setAsync(u).setModal(true).setCausalElement(event.getTarget()).show();},updateCustomState:function(r,s,t){this.clearCustomState();this._privacyData=p({},r);if(s)if(t){t=t.slice(0,-'[value]'.length);var u={};u[t]=r;k.createHiddenInputs(u,this._container,null,true);}},clearCustomState:function(){this._privacyData={};j.empty(this._container);}});e.exports=q;});
__d("legacy:CustomPrivacyOption",["CustomPrivacyOption"],function(a,b,c,d){a.CustomPrivacyOption=b('CustomPrivacyOption');},3);
var FriendListPrivacyOptions=(function(){var a=false,b=false,c=null,d={},e=function(f){if(is_empty(d))PageTransitions.registerHandler(function(){d={};a=false;b=false;});var g=f.getAttribute('data-name');d[g]=f;Selector.listen(f,'select',function(h){var i=h.option,j=DOM.find(i,'a.itemAnchor'),k=j.getAttribute('data-flid');if(!k)return;var l=j.getAttribute('data-dynamic');if(l&&a){FriendListPrivacyOptions.showSmartListNux(i,k);}else if(!l&&b)FriendListPrivacyOptions.showDumbListNux([k]);});};return {listen:function(f,g,h){var i=ge(f);if(!i)return;var j=Parent.byClass(i,'audienceSelector');if(j){e(j);a=g;b=h;}},showSmartListNux:function(f,g){new AsyncRequest('/ajax/friends/lists/smart_list_publish_nux.php').setData({option_id:f.id,flid:g}).send();a=false;},setContextualDialog:function(f,g){var h=Parent.byClass(g,'audienceSelector');if(h){f.setContext(h);f.show();var i=Arbiter.subscribe('composer/publish',function(){f.hide();});f.subscribe('hide',function(){i.unsubscribe();});}},showDumbListNux:function(f){new AsyncRequest('/ajax/friends/lists/dumb_list_publish_nux.php').setData({flids:f}).send();b=false;},showBothListsNux:function(f,g){c=f;FriendListPrivacyOptions.showDumbListNux(g);},setDialog:function(){if(!c)return;var f=Dialog.getCurrent();if(f)f.setCloseHandler(function(){FriendListPrivacyOptions.showSmartListNux(c);c=null;});}};})();
__d("OnlyMePrivacyOption",["Arbiter","copyProperties","CSS","DOM","Env","Parent","PrivacyConst","Selector","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('Env'),l=b('Parent'),m=b('PrivacyConst'),n=b('Selector'),o=b('tx');function p(q){if(!q)return;this.initx(q);}h(p.prototype,{init:function(q){this.initx(q);},initx:function(q){this._selector=l.byClass(q,'composerAudienceSelector');this._plusLabel=j.find(q,'.plusLabel');if(!this._selector)return;this._elem=q;this._taggedIDs=[];this._tags=[];this._hasEvent=false;this._recalculateTooltipAndLabel();this._updateSelector();g.subscribe('Composer/changedtags',function(r,s){var t=this._hasEvent;this._hasEvent=!!s.eventTag;this._tags=s.withTags.map(function(v){return v.getText();});this._taggedIDs=s.withTags.map(function(v){return v.getValue();});for(var u in s.mention)if(s.mention[u].type=='user'&&s.mention[u].uid!=k.user){this._tags.push(s.mention[u].text);this._taggedIDs.push(s.mention[u].uid);}else if(s.mention[u].type=='event')this._hasEvent=true;if(this._hasEvent&&t!=this._hasEvent)this._eventTagChanged();if(this._recalculateTooltipAndLabel()&&n.isOptionSelected(this._elem)){this._updateSelector();g.inform('SelectedPrivacyOption/changed',this._getChangedData());}}.bind(this));n.listen(this._selector,'change',this._updateSelector.bind(this));},_eventTagChanged:function(){},_getChangedData:function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:m.FriendsValue.SELF};},_recalculateTooltipAndLabel:function(){var q=this._tooltip,r=this._label;if(this._taggedIDs.length){this._tooltip="Anyone tagged";this._label="Only Me"+' (+)';}else{this._tooltip="Only you";this._label="Only Me";}i.conditionShow(this._plusLabel,this._taggedIDs.length);return (q!=this._tooltip)||(r!=this._label);},_updateSelector:function(){if(n.isOptionSelected(this._elem)){n.setButtonLabel(this._selector,this._label);n.setButtonTooltip(this._selector,this._tooltip);return false;}return true;}});e.exports=p;});
__d("TooltipLink",["Parent","Tooltip"],function(a,b,c,d,e,f){var g=b('Parent'),h=b('Tooltip'),i={setTooltipText:function(j,k){j=g.byTag(j,'a');j&&h.set(j,k);}};e.exports=i;});
function BassWhitespaceListener(a,b){this.link=b;Event.listen(a,'click',this.onclicked.bind(this));}copyProperties(BassWhitespaceListener.prototype,{onclicked:function(a){if(Parent.byTag(a.getTarget(),'A'))return;switch(this.link.getAttribute('rel')){case 'async':Bootloader.loadComponents('async',function(){AsyncRequest.bootstrap(this.link.getAttribute('ajaxify'),this.link);}.bind(this));break;case 'theater':var b=Parent.byClass(a.getTarget(),'fbPhotoSnowlift');Bootloader.loadComponents('PhotoViewer',function(){PhotoViewer.bootstrap(this.link.getAttribute('ajaxify'),this.link);}.bind(this));if(b)return false;break;default:goURI(this.link.getAttribute('href'));}}});
function CIWebmailBootloader(a,b){this.controllerFn=b;var c=Event.listen(a,'mouseover',function(){c.remove();this.bootload();}.bind(this));return this;}copyProperties(CIWebmailBootloader.prototype,{bootload:function(a){Bootloader.loadComponents('contact-importer-webmail',function(){this.controller=this.controller||this.controllerFn();if(a)this.controller.onSubmit();}.bind(this));},onSubmit:function(){if(this.controller){this.controller.onSubmit();}else this.bootload(true);}});
__d("AppRequestReminders",["AsyncRequest","CSS","DOM","ge"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('ge'),k=3,l=0,m=0,n={},o={},p=1,q=j('OtherAppReqReminder'),r=function(z,aa,ba){n[aa]={node:z,seq:p++,reqCount:ba};},s=function(z,aa,ba,ca){if(ca){o[aa]={node:z,seq:p++,reqCount:ba};}else l++;},t=function(z){m=z;},u=function(z){return z.id.split('_')[1];},v=function(z){var aa=j(z),ba=aa.nextSibling;if(ba!==q){h.show(ba);m-=n[u(ba)].reqCount;}x(m);},w=function(z){var aa=j(z);l--;while(l<k&&m>0){aa=aa.nextSibling;var ba=u(aa);if(aa!==q&&o[ba]!==undefined){h.show(aa);m-=o[ba].reqCount;delete o[ba];l++;}}x(m);},x=function(z){new g().setURI('/ajax/reminders/update_count.php').setData({new_count:z}).setMethod('POST').send();},y=function(z,aa){if(q&&aa&&z>0){i.setContent(j('OtherAppReqLabel'),aa);}else if(q){h.hide(q);}else h.hide(j('OtherAppReqReminder'));};f.initNode=r;f.initAggressiveNode=s;f.handleRemove=v;f.handleAggressiveRemove=w;f.updateCount=y;f.setTotalOtherCount=t;});
__d("legacy:ARIA",["ARIA"],function(a,b,c,d){a.ARIA=b('ARIA');},3);
__d("legacy:CounterDisplay",["CounterDisplay"],function(a,b,c,d){a.CounterDisplay=b('CounterDisplay');},3);
function startMessagingNavCountUpdater(a){var b=FutureSideNav.getInstance().getNodeForKey('inbox');if(!b)return;var c=FutureSideNav.getInstance().getNodeForKey('other'),d=DOM.scry(c,'span.count')[0],e=DOM.scry(d,'span.countValue')[0],f=DOM.scry(d,'span.maxCountIndicator')[0];new CounterMaxDisplay('other_unseen',e,d,null,null,true).setMaxCounter(a,f);}function CounterMaxDisplay(){this._maxValue=null;this._maxIndicatorNode=null;var a=[this].concat($A(arguments));return this.parent.construct.apply(this.parent,a);}Class.extend(CounterMaxDisplay,'CounterDisplay');copyProperties(CounterMaxDisplay.prototype,{setMaxCounter:function(a,b){this._maxValue=a;this._maxIndicatorNode=b;},paint:function(){var a=this._maxValue&&this._count>this._maxValue,b=a?this._maxValue:this._count;if(this._maxIndicatorNode){DOM.setContent(this._maxIndicatorNode,a?'+':'');}else if(a)b=b+'+';DOM.setContent(this._valueNode,b);this._toggleNodes();}});
__d("ComposerAudienceSelector",["DynamicIconSelector","CustomPrivacyOption","PrivacyConst","Selector"],function(a,b,c,d,e,f){b('DynamicIconSelector');var g=b('CustomPrivacyOption'),h=b('PrivacyConst'),i=b('Selector'),j={},k={},l={syncSelector:function(m){j[m]&&i.setSelected(m,j[m]);if(j[m]==h.BaseValue.CUSTOM&&k[m]){var n=i.getOption(m,h.BaseValue.CUSTOM+''),o=k[m];(function(){g.update(n.id,o.data,o.audience,o.tooltip);}).defer();}}};e.exports=l;});
__d("legacy:ComposerAudienceSelector",["ComposerAudienceSelector"],function(a,b,c,d){a.ComposerAudienceSelector=b('ComposerAudienceSelector');},3);
__d("FriendsPrivacyOption",["Arbiter","Class","CSS","OnlyMePrivacyOption","PrivacyConst","Selector","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('CSS'),j=b('OnlyMePrivacyOption'),k=b('PrivacyConst'),l=b('Selector'),m=b('tx');function n(o,p){if(!o){this.parent.construct(this);return;}this._hasRestricted=p;this.parent.construct(this,o);}h.extend(n,j);n.prototype.init=function(o,p){this._hasRestricted=p;this.parent.init(o);};n.prototype._getChangedData=function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:k.FriendsValue.ALL_FRIENDS};};n.prototype._eventTagChanged=function(){var o=this._getChangedData();o.privacy=l.getValue(this._selector);g.inform('EventTagged/changed',o);};n.prototype._recalculateTooltipAndLabel=function(){var o=this._hasEvent,p=this._tags.length,q=this._tooltip,r=this._label;if(p>2){if(o){this._tooltip=this._hasRestricted?"Your friends, friends of anyone tagged and event guests; Except: Restricted":"Your friends, friends of anyone tagged and event guests";}else this._tooltip=this._hasRestricted?"Your friends and friends of anyone tagged; Except: Restricted":"Your friends and friends of anyone tagged";}else if(p==2){if(o){if(this._hasRestricted){this._tooltip="Your friends, friends of anyone tagged and event guests; Except: Restricted";}else this._tooltip="Your friends, friends of anyone tagged and event guests";}else if(this._hasRestricted){this._tooltip=m._("Your friends, {user}'s friends and {user2}'s friends; Except: Restricted ",{user:this._tags[0],user2:this._tags[1]});}else this._tooltip=m._("Your friends, {user}'s friends and {user2}'s friends",{user:this._tags[0],user2:this._tags[1]});}else if(p==1){if(o){if(this._hasRestricted){this._tooltip=m._("Your friends, {user}'s friends and event guests; Except: Restricted",{user:this._tags[0]});}else this._tooltip=m._("Your friends, {user}'s friends and event guests",{user:this._tags[0]});}else if(this._hasRestricted){this._tooltip=m._("Your friends and {user}'s friends; Except: Restricted",{user:this._tags[0]});}else this._tooltip=m._("Your friends and {user}'s friends",{user:this._tags[0]});}else if(o){this._tooltip=this._hasRestricted?"Your friends and event guests; Except: Restricted":"Your friends and event guests";}else this._tooltip=this._hasRestricted?"Your friends; Except: Restricted":"Your friends";i.conditionShow(this._plusLabel,this._tags.length);this._label=this._elem.getAttribute('data-label');if(this._tags.length||this._hasEvent)this._label+=' (+)';return (q!=this._tooltip)||(r!=this._label);};e.exports=n;});
function MetaComposerEdDialog(){}copyProperties(MetaComposerEdDialog.prototype,{init:function(a,b,c,d,e,f,g){MetaComposerEdDialog.timesTagEduShown=c;MetaComposerEdDialog.timesEventTagEduShown=e;MetaComposerEdDialog.timesStickyEduShown=g;if(MetaComposerEdDialog.singleton){a.destroy();return;}MetaComposerEdDialog.singleton=this;this._dialog=a;if(f)Arbiter.subscribe('composer/mutate',function(h,i){this._sendEducationRequest({sticky_num:MetaComposerEdDialog.timesStickyEduShown},'/ajax/composer/audience/sticky_education');}.bind(this));if(d)if(e===0){Arbiter.subscribe('EventTagged/changed',function(h,i){this._sendEducationRequest({id:"composerTourAudience",privacy:i.privacy,event_tag_num:MetaComposerEdDialog.timesEventTagEduShown},'ajax/events/tagging/user_education',null);}.bind(this));Arbiter.subscribe(['composer/publish','composer/reset'],function(){var h=ge("event_tagging_tag_expansion_NUX");h&&CSS.hide(h);}.bind(this));}else Arbiter.subscribe('EventTagged/changed',function(h,i){this._sendEducationRequest({ids:i.tags,from:'AtTagger',hasEvent:i.hasEvent,type:i.privacy,tag_num:MetaComposerEdDialog.timesTagEduShown,event_tag_num:MetaComposerEdDialog.timesEventTagEduShown},'ajax/composer/audience/tag_education',this._handler.bind(this));}.bind(this));if(b)Arbiter.subscribe('SelectedPrivacyOption/changed',function(h,i){this._sendEducationRequest({ids:i.tags,from:'WithTagger',hasEvent:i.hasEvent,type:i.privacy,tag_num:MetaComposerEdDialog.timesTagEduShown,event_tag_num:MetaComposerEdDialog.timesEventTagEduShown},'/ajax/composer/audience/tag_education',this._handler.bind(this));}.bind(this));Selector.subscribe('open',this._killAnim.bind(this));},_sendEducationRequest:function(a,b,c){if(!this._updateDialogContext())return;this._async&&this._async.abort();this._async=new AsyncRequest(b);this._async.setData(a).setHandler(c).send();},_updateDialogContext:function(){var a=DOM.scry(document.body,'div.composerAudienceWrapper'),b,c;for(var d=0;d<a.length;d++){b=a[d];c=Vector2.getElementPosition(b);if(b&&c.x>0&&c.y>0){this._dialog.setContext(b);return true;}}return false;},_handler:function(a){var b=a.payload;if(!b||!this._updateDialogContext())return;var c=this._dialog.getContent();DOM.setContent(c,b);ARIA.announce(DOM.getText(c));this._dialog.disableBehavior(LayerDestroyOnHide).show();var d=Parent.byClass(c,'metaComposerUserEd');if(this._anim){this._anim.stop();this._anim=animation(d);}else this._anim=animation(d).from('opacity',0);this._anim.by('opacity',1).checkpoint().duration(3500).checkpoint().to('opacity',0).checkpoint().ondone(this._killAnim.bind(this)).go();},_killAnim:function(a,b){if(this._anim){this._anim.stop();this._dialog.hide(false);this._anim=null;}}});
__d("ChatOnlineFriends",["event-extensions","AvailableList","AvailableListConstants","ChannelConnection","Chat","ChatConfig","ChatVisibility","Class","CSS","DataStore","DOM","OrderedFriendsList","Parent","Run","ShortProfiles","TooltipLink","XHPTemplate","copyProperties","createObjectFrom","ChatTypeaheadBehavior","ChatTypeaheadCore","ChatTypeaheadDataSource","ChatTypeaheadRenderer","Typeahead"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AvailableList'),h=b('AvailableListConstants'),i=b('ChannelConnection'),j=b('Chat'),k=b('ChatConfig'),l=b('ChatVisibility'),m=b('Class'),n=b('CSS'),o=b('DataStore'),p=b('DOM'),q=b('OrderedFriendsList'),r=b('Parent'),s=b('Run'),t=b('ShortProfiles'),u=b('TooltipLink'),v=b('XHPTemplate'),w=b('copyProperties'),x=b('createObjectFrom');b('ChatTypeaheadBehavior');b('ChatTypeaheadCore');b('ChatTypeaheadDataSource');b('ChatTypeaheadRenderer');b('Typeahead');function y(aa){switch(aa){case h.OFFLINE:return 'chatOffline';case h.IDLE:return 'chatIdle';case h.ACTIVE:return 'chatOnline';case h.MOBILE:return 'chatMobile';}}var z=function(aa,ba,ca,da,ea,fa,ga){var ha=(da&&ea)||(fa&&ga);if(aa&&ba&&ca&&ha)this.init(aa,ba,ca,da,ea,fa,ga);};w(z.prototype,{chatFriends:{},chatStatuses:['chatOnline','chatIdle','chatMobile','chatOffline'],_availableListSubscribe:function(event,aa){this._arbiterTokens.push(g.subscribe(event,aa));},_channelSubscribe:function(event,aa){this._arbiterTokens.push(i.subscribe(event,aa));},onunload:function(){this._arbiterTokens.forEach(function(aa){aa.unsubscribe();});},_setStatus:function(aa,ba){if(n.hasClass(aa,ba))return;this.chatStatuses.forEach(function(ca){n.conditionClass(aa,ca,ca==ba);});},initTypeahead:function(aa,ba,ca){aa.subscribe('reset',function(){n.show(ba);});aa.subscribe('query',function(da,ea){n.conditionShow(ba,!ea.value);});if(ca)aa.subscribe(['query','reset'],function(da){n.conditionShow(ca,da==='reset');});},init:function(aa,ba,ca,da,ea,fa,ga){this.maxElements=aa;this._faceTmpl=ea;this._arbiterTokens=[];this._root=ca;s.onLeave(this.onunload.bind(this));var ha=p.scry(ca,'.chatUpgradeLink');this.initTypeahead(ba,da||fa,ha[0]);var ia=p.find(ca,'.sidebarBtn');Event.listen(ia,'click',function(event){j.toggleSidebar();event.kill();});this._faceFutures&&this._hideAllFaces();this._faceFutures=[];this._orderedFriends=q.getList();this._hashedFriends=x(this._orderedFriends);this._availableListSubscribe(h.ON_AVAILABILITY_CHANGED,this.update.shield(this));this.update.bind(this).defer();this._channelSubscribe(i.CONNECTED,this.update.shield(this));this._channelSubscribe(i.RECONNECTING,this._handleChannelReconnecting.bind(this));this._channelSubscribe(i.SHUTDOWN,this._handleChannelShutdown.bind(this));this._channelSubscribe([i.MUTE_WARNING,i.UNMUTE_WARNING],this.update.shield(this));if(da){this._facepile=da.firstChild;Event.listen(da,'click',this.clickHandler.bind(this));}else{this._miniDivebar=fa;this._divebarTmpl=ga;}Event.listen(p.find(ca,'.fbChatGoOnlineLink'),'click',function(event){if(i.disconnected()){j.openBuddyList();}else l.goOnline(j.openBuddyList);event.kill();}.bind(this));Event.listen(p.find(ca,'.fbChatReconnectLink'),'click',function(event){if(i.disconnected())i.reconnect();event.kill();}.bind(this));g.update();},_updateMiniDivebar:function(){var aa=Math.min(this._orderedFriends.length,10),ba=[];for(var ca=0;ca<aa;ca++)ba.push(this._renderDivebarItem(this._orderedFriends[ca]));p.setContent(this._miniDivebar,ba);},_renderDivebarItem:function(aa){var ba=this._divebarTmpl.build(),ca=ba.getNode('anchor'),da=ba.getNode('status'),ea=g.get(aa);if(ea===h.ACTIVE){n.addClass(da,'active');}else if(ea===h.MOBILE)n.addClass(da,'mobile');t.get(aa,function(fa){ba.setNodeContent('name',fa.name).setNodeProperty('profile-photo','src',fa.thumbSrc);Event.listen(ca,'click',function(){j.openTab(aa,null,'friend','online_friends');return false;});});return ba.getRoot();},_handleChannelReconnecting:function(aa,ba){var ca=(ba<1000),da=p.find(this._root,'.fbChatReconnectLink'),ea=p.find(this._root,'.fbChatReconnecting');n.conditionShow(da,!ca);n.conditionShow(ea,ca);},_handleChannelShutdown:function(){var aa=p.find(this._root,'.fbChatReconnectLink'),ba=p.find(this._root,'.fbChatReconnecting');n.hide(aa);n.hide(ba);},update:function(){var aa=i.disconnected(),ba=l.isOnline();n.conditionClass(this._root,'disconnected',aa);if(this._facepile){n.conditionShow(this._facepile,ba);ba&&this._updateFacepile(aa);}else ba&&this._updateMiniDivebar();var ca=p.find(this._root,'.typeaheadContainer');n.conditionShow(ca,ba);if(k.get('chat_upgrade_link')){var da=p.find(this._root,'.chatUpgradeLink');n.conditionShow(da,ba);}var ea=p.find(this._root,'.chatGoOnlineLink');n.conditionShow(ea,!ba);var fa=p.find(this._root,'.chatReconnectLink');n.conditionShow(fa,ba&&aa);},_updateFacepile:function(aa){g.getAvailableIDs().forEach(function(ha){if(!this._hashedFriends[ha]){this._orderedFriends.push(ha);this._hashedFriends[ha]=true;}}.bind(this));var ba=0;for(var ca=0;ca<this._orderedFriends.length;ca++){var da=this._orderedFriends[ca],ea=g.get(da),fa=this._faceFutures[ca],ga=(aa||ea!==h.OFFLINE)&&(ba<this.maxElements);if(ga){if(!fa){fa=this._makeFace(ca);this._faceFutures[ca]=fa;}ba++;}this._updateFace(fa,ga,y(ea));}},_updateFace:function(aa,ba,ca){aa&&aa(function(da){this._setStatus(da,ca);n.conditionShow(da,ba);}.bind(this));},_makeFace:function(aa){var ba=null,ca=null,da=this._orderedFriends[aa];t.get(da,function(ea){ca=this._faceTmpl.render();o.set(ca,'friendID',da);var fa=v.getNode(ca,'img'),ga=fa.cloneNode(false);ga.setAttribute('src',ea.thumbSrc);p.replace(fa,ga);var ha=v.getNode(ca,'anchor');u.setTooltipText(ha,ea.name);ba&&ba(ca);var ia=false;for(var ja=aa+1;ja<this._orderedFriends.length&&!ia;ja++){var ka=this._faceFutures[ja],la=ka&&ka();if(la){this._facepile.insertBefore(ca,la);ia=true;}}if(!ia)this._facepile.appendChild(ca);}.bind(this));return function ea(fa){if(fa)if(ca){fa(ca);}else ba=fa;return ca;};},clickHandler:function(event){var aa=event.getTarget(),ba=r.byClass(aa,'uiFacepileItem');if(ba){var ca=o.get(ba,'friendID');if(ca&&l.isOnline()){j.openTab(ca,null,'friend','online_friends');return false;}}},_hideAllFaces:function(){this._faceFutures.forEach(function(aa){aa&&aa(function(ba){p.remove(ba);});});}});e.exports=z;});
__d("MercuryUnreadState",["Arbiter","copyProperties","MercuryFolders","JSLogger","KeyedCallbackManager","createObjectFrom","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('MercuryFolders'),j=b('JSLogger'),k=b('KeyedCallbackManager'),l=b('createObjectFrom'),m=b('MercuryServerRequests'),n=b('MercuryThreadInformer'),o=b('MercuryThreads'),p=c('MercuryConstants'),q=(i.getSupportedFolders()||[]).filter(function(ma){return ma!=p.MessagingTag.ACTION_ARCHIVED;}),r={},s={},t={},u={},v={};q.forEach(function(ma){t[ma]=0;u[ma]=false;v[ma]=new k();});var w='unread_thread_hash',x='unseen_thread_list',y=p.MercuryThreadlistConstants.MAX_UNREAD_COUNT,z=j.create('mercury_unread_state'),aa={getUnreadCount:function(ma){if(aa.exceedsMaxCount(ma)){z.error('unguarded_unread_count_fetch',{});return 0;}return ea(ma);},exceedsMaxCount:function(ma){return u[ma]||(ea(ma)>y);},markFolderAsRead:function(ma){if(u[ma]||ea(ma)>0)m.markFolderAsRead(ma);}};function ba(ma,na){v[ma].setResource(w,na);v[ma].setResource(x,Object.keys(na));}function ca(ma,na){var oa=v[ma].executeOrEnqueue(w,na),pa=v[ma].getUnavailableResources(oa);if(pa.length)m.fetchUnreadThreadIDs(ma);}function da(ma){return v[ma].getResource(w);}function ea(ma){var na=v[ma].getResource(x);if(na){return na.length;}else return t[ma];}function fa(ma){var na;(ma.unread_thread_ids||[]).forEach(function(oa){na=oa.folder;if(!la(na))return;var pa=ja(oa.thread_ids);ba(na,l(pa,true));if(pa.length>y)u[na]=true;n.updatedUnreadState();});(ma.message_counts||[]).forEach(function(oa){if(oa.unread_count===undefined)return;na=oa.folder;if(oa.unread_count>y){u[na]=true;ba(na,{});n.updatedUnreadState();}else{t[na]=oa.unread_count;if(t[na]===0)ba(na,{});n.updatedUnreadState();}});(ma.actions||[]).forEach(function(oa){if(oa.is_forward)return;var pa=p.MercuryActionType,qa=oa.thread_id?oa.thread_id:oa.server_thread_id;if(oa.action_type==pa.DELETE_THREAD){q.forEach(function(sa){ha(sa,qa);});}else if(oa.action_type==pa.CHANGE_ARCHIVED_STATUS||oa.action_type==pa.CHANGE_FOLDER){var ra=o.getThreadMetaNow(oa.thread_id);na=i.getFromMeta(ra);if(la(na)&&ra.unread_count>0)ga(na,qa);q.forEach(function(sa){if(sa!=na)ha(sa,qa);});}else{na=oa.folder;if(!la(na))return;if(oa.action_type==pa.CHANGE_READ_STATUS){if(oa.mark_as_read){ha(na,qa,oa.timestamp);}else ga(na,qa,oa.timestamp);}else if(oa.action_type==pa.USER_GENERATED_MESSAGE||oa.action_type==pa.LOG_MESSAGE)if(oa.is_unread)ga(na,qa,oa.timestamp);}});}function ga(ma,na,oa){if(u[ma])return;ca(ma,function(pa){var qa=r[ma]||0,ra=s[na]||0,sa=oa||Number.POSITIVE_INFINITY;if(sa>=qa&&sa>=ra&&!pa[na]){pa[na]=oa||0;ba(ma,pa);n.updatedUnreadState();}});}function ha(ma,na,oa){if(u[ma])return;ca(ma,function(pa){if(oa){var qa=s[na];if(!qa||qa<oa)s[na]=oa;}var ra=pa[na];if(oa&&typeof ra=='number'&&oa<ra)return;if(na in pa){delete pa[na];ba(ma,pa);n.updatedUnreadState();}});}function ia(ma,na){u[ma]=false;ba(ma,{});r[ma]=Math.max(r[ma]||0,na||0);n.updatedUnreadState();}function ja(ma){return ma.map(m.convertThreadIDIfAvailable);}function ka(ma){q.forEach(function(na){var oa=da(na);if(!oa)return;for(var pa in ma){var qa=ma[pa];if(oa[pa]){oa[qa]=oa[pa];delete oa[pa];}}ba(na,oa);});}function la(ma){return q.contains(ma);}m.subscribe('update-unread',function(ma,na){fa(na);var oa=na.global_actions||[];for(var pa=0;pa<oa.length;pa++){var qa=oa[pa];if(qa.action_type==p.MercuryGlobalActionType.MARK_ALL_READ)ia(qa.folder,qa.timestamp);}});m.subscribe('update-thread-ids',function(ma,na){ka(na);});g.subscribe(j.DUMP_EVENT,function(ma,na){na.messaging=na.messaging||{};na.messaging.unread={};na.messaging.unread_max_count={};q.forEach(function(oa){na.messaging.unread[oa]=h({},da(oa));na.messaging.unread_max_count[oa]=u[oa];});});e.exports=aa;});
__d("MercuryLeftNavCountControl",["Arbiter","CSS","DOM","URI","MercuryUnreadState","MercuryServerRequests","MercuryThreadInformer","copyProperties","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('URI'),k=b('MercuryUnreadState'),l=b('MercuryServerRequests'),m=b('MercuryThreadInformer'),n=c('MercuryConstants'),o=b('copyProperties'),p,q,r=function(s,t){p=s;q=t;this.render();this.listenerToken=m.subscribe('unread-updated',this.render.bind(this));this.subscriptions=[g.subscribe('onload/exit',this.cleanup.bind(this))];};o(r.prototype,{render:function(){var s=k.exceedsMaxCount(n.MessagingTag.INBOX);if(s){i.setContent(p,n.MercuryThreadlistConstants.MAX_UNREAD_COUNT);}else{var t=k.getUnreadCount(n.MessagingTag.INBOX);i.setContent(p,t.toString());h.conditionClass(p.parentNode,'hidden_elem',t<=0);}i.setContent(q,s?'+':'');},cleanup:function(){this.subscriptions.forEach(g.unsubscribe);m.unsubscribe(this.listenerToken);}});e.exports=r;});
__d("MercuryLeftNav",["DOM","MercuryServerRequests","MercuryLeftNavCountControl"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryServerRequests'),i=b('MercuryLeftNavCountControl');e.exports=function(j,k){h.handleUpdate(k);var l=g.scry(j,'span.countValue')[0],m=g.scry(j,'span.maxCountIndicator')[0],n=new i(l,m);};});
__d("legacy:Selector",["Selector"],function(a,b,c,d){a.Selector=b('Selector');},3);
__d("AppRequestBookmarks",["HoverFlyout"],function(a,b,c,d,e,f){var g=b('HoverFlyout'),h={listen:function(i,j){new g(i,j);}};e.exports=h;});