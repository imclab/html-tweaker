/*1347249149,173214269*/

if (window.CavalryLogger) { CavalryLogger.start_js(["aPFYm"]); }

function TickerRightHideController(){}TickerRightHideController._markAsClosedHelper=function(a){var b=ge('pagelet_reminders');if(b){var c=DOM.scry(b,'div.tickerToggleWrapper')[0];if(c)CSS.conditionClass(c,'displayedTickerToggleWrapper',a);}var d=ge('pagelet_rhc_ticker');if(d){var e=DOM.scry(d,'div.tickerToggleWrapper')[0];if(e)CSS.conditionClass(e,"displayedTickerToggleWrapper",!a);CSS.conditionClass(d,"hidden_rhc_ticker",a);}};TickerRightHideController.markAsClosed=function(){TickerRightHideController._markAsClosedHelper(true);};TickerRightHideController.markAsUnclosed=function(){TickerRightHideController._markAsClosedHelper(false);};
function TickerCache(a,b){this.parent.construct(this,a,b,['Ticker/storiesInserted','Ticker/resized','Ticker/afterInsert','Ticker/animateOut']);this._numStoriesToKeep=15;}Class.extend(TickerCache,'PageletCacheController');copyProperties(TickerCache.prototype,{handlePageletDOMOnSnapshot:function(a){var b=DOM.scry(a,'div.storyQueue')[0];b&&DOM.remove(b);var c=DOM.scry(a,'div.fbFeedTickerStory');if(c.length>this._numStoriesToKeep)c.slice(this._numStoriesToKeep).forEach(DOM.remove);var d=['tickerStoryActive','tickerStorySelected','tickerStoryFetching'];c.forEach(function(g){d.forEach(function(h){CSS.removeClass(g,h);});if(CSS.hasClass(g,'tickerSponsoredStory'))DOM.remove(g);});CSS.removeClass(a,'tickerChildSelected');var e=DOM.scry(a,'div.uiScrollableAreaTrack')[0];e&&Style.set(e,'opacity',0);var f=DOM.scry(a,'div.fbFeedTicker')[0];if(f){Style.set(f,'top','');CSS.removeClass(f,'fixed_elem');}},getControllerDataOnSnapshot:function(a){return {newest:a.getNewest(),customStories:[]};},insertStory:function(a){var b=HTML(a).getRootNode(),c=DOM.scry(b,'div.fbFeedTickerStory');for(var d=0;d<c.length;d++)if(this._controller.dedupeStory(c[d]))c[d].parentNode.removeChild(c[d]);this._controller.insertStory(b,true,c.length>3);},updateAfterload:function(a){a.update({cache_update:1});}});
__d("TickerReadStateTracking",["event-extensions","Style","clickRefAction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Style'),h=b('clickRefAction'),i=73,j='ticker_hover',k=[];function l(n){var o=JSON.parse(n.getAttribute('data-ft'));if(!o)return null;if(o.mf_story_key)return o.mf_story_key;if(o.fbid)return o.fbid;return null;}function m(n){var o=l(n);if(!o||o in k)return;k[o]=true;var p={evt:i};h(j,n,null,'FORCE',{ft:p});}e.exports.log=m;});
__d("TickerController",["event-extensions","Animation","Arbiter","AsyncRequest","AsyncSignal","Bootloader","ChannelConstants","ContextualDialogX","CSS","DOM","HTML","JSLogger","Keys","LayerFadeOnHide","LiveTimer","NavigationMessage","Parent","Run","ScrollableArea","Selector","Style","TickerReadStateTracking","Toggler","UIPagelet","URI","UserActivity","UserAgent","Vector","$","clickRefAction","collectDataAttributes","copyProperties","ge","goURI","throttle","userAction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncSignal'),k=b('Bootloader'),l=b('ChannelConstants'),m=b('ContextualDialogX'),n=b('CSS'),o=b('DOM'),p=b('HTML'),q=b('JSLogger'),r=b('Keys'),s=b('LayerFadeOnHide'),t=b('LiveTimer'),u=b('NavigationMessage'),v=b('Parent'),w=b('Run'),x=b('ScrollableArea'),y=b('Selector'),z=b('Style'),aa=b('TickerReadStateTracking'),ba=b('Toggler'),ca=b('UIPagelet'),da=b('URI'),ea=b('UserActivity'),fa=b('UserAgent'),ga=b('Vector'),ha=b('$'),ia=b('clickRefAction'),ja=b('collectDataAttributes'),ka=b('copyProperties'),la=b('ge'),ma=b('goURI'),na=b('throttle'),oa=b('userAction'),pa=1,qa=2,ra=3,sa=4,ta=q.create('ticker_controller');function ua(){}ka(ua,{_instances:{},_activeInstance:null,_placeholders:{},_logPositionChange:false,getInstance:function(va){var wa=v.byClass(ha(va),'fbFeedTicker');return wa?ua._instances[wa.id]:null;},isLoaded:function(va){var wa=ua._placeholders[va.id];return !wa||wa.status==ra;},show:function(va,wa){wa=wa||bagofholding;for(var xa in ua._instances){var ya=la(xa);if(!ya||ya.parentNode.id==va.id)continue;ua.hide(ya.parentNode);}ua._doPositionChange(va);n.show(va);var za=ua._placeholders[va.id];if(za&&za.status==pa){ua._fetchTickerForPlaceholder(va,wa);}else{var ab=o.scry(va,'.fbFeedTicker')[0],bb=ab&&ua.getInstance(ab);ua._activeInstance=bb;bb&&bb._poll();ua._placeholders[va.id]={status:sa,callback:wa};wa();}},_doPositionChange:function(va){if(!ua._logPositionChange||n.shown(va))return;new j('/common/ods_endpoint.php',{k:'ticker.render.switch.'+va.id}).send();},hide:function(va){var wa=o.scry(va,'.fbFeedTicker')[0],xa=wa&&ua.getInstance(wa);xa&&xa.hideActiveStory();n.hide(va);},hideStoriesByClass:function(va){for(var wa in ua._instances)o.scry(ha(wa),va).forEach(n.hide);},hideStory:function(va){var wa=va&&ua.getInstance(va);wa&&wa.hideStory(va);},undoHideStory:function(va){var wa=va&&ua.getInstance(va);wa&&wa.undoHideStory(va);},insertStoriesAtBottom:function(va){ua._activeInstance.insertStoriesAtBottom(va);},_fetchTickerForPlaceholder:function(va,wa){var xa={handler:function(){ua._placeholders[va.id].status=ra;wa();}};ca.loadFromEndpoint('TickerPagelet',va.id,ua._placeholders[va.id].pageletData,xa);ua._placeholders[va.id].status=qa;},registerStoryDialog:function(va,wa){h.subscribe('ticker/init',function(){var xa=la(va),ya=xa&&ua.getInstance(xa);ya&&ya.registerStoryDialog(xa,wa);},h.SUBSCRIBE_ALL);},registerPlaceholder:function(va,wa){var xa=ua._placeholders[va];ua._placeholders[va]={status:pa,pageletData:wa};if(xa&&xa.status==sa){ua.show(ha(va));xa.callback();}}});ka(ua.prototype,{ADS_IDLE_MS:300000,FLYOUT_MAX_HEIGHT:450,FLYOUT_OFFSET_THRESHOLD:20,FLYOUT_COMMENT_OFFSET:15,FLYOUT_VIEWPORT_PADDING:75,FLYOUT_TARGET_HEIGHT_OFFSET:25,init:function(va,wa,xa){ua._instances[va.id]=this;ua._activeInstance=this;this._root=va;this._content=o.find(va,'.ticker_stream');this._stories=o.find(this._root,'.tickerActivityStories');this._scrollableArea=wa;this._container=o.find(va,'div.uiScrollableAreaWrap');this._newestStory={};this._storyIDs=[];this._objectIDs=[];this._fetchedStories={};this._removedStoryIDs=[];this._storiesToRemove=[];var ya=Date.now();this._initTime=ya;this._lastUpdate=ya;this._lastPull=ya;this._lastInsert=ya;this._lastCustomStory=0;this._pollOnly=false;this._needNonCustomStoryNum=0;this._doCustomUpdate=true;this._autoloadStoryIndex=1;this._scrollTopThreshold=100;this._scrollTopPrompt=o.find(this._root,'.scrollTopPrompt');this._scrollTopPromptVisible=false;this._maxStoriesToKeep=50;this._minStoriesToKeep=25;this._tickerInSidebarMode=!!v.byClass(this._root,'fbChatSidebar');this._loadStoriesWithActions();ia('ticker_flyout');ia('ticker_flyout_prefetch');ia('ticker_flyout_loadtime');ia('ticker_stream');this._ua={flyout:oa('ticker').uai('flyout','flyout',false),flyout_prefetch:oa('ticker').uai('flyout_prefetch','flyout_prefetch',false),flyout_loadtime:oa('ticker').uai('ticker_flyout_loadtime','flyout_loadtime',false),stream:oa('ticker').uai('ticker_stream','stream',false)};this._uaCurStoryIDFetch=null;this._uaCurStoryIDPrefetch=null;var za=o.create('div',{className:'storyQueue hidden_elem'});this._storyQueue=za;o.appendContent(this._root,za);this._initObjectIDs();this._initPageletCache(xa);this._initConfig(xa);this._resetMorePager();this._initListeners();this._initSubscriptions(xa);h.inform('ticker/init',this,h.BEHAVIOR_PERSISTENT);this._poll();if(this._prefetchAfterLoad){this._logUserEvent('stream','prefetch');this._fetchStories(this._getInsertedStories().slice(0,5));}},_loadStoriesWithActions:function(){var va=la('rightCol');if(!va)return;this._toggleWrapper=o.scry(va,'.tickerToggleWrapper')[0];if(this._toggleWrapper){var wa=o.scry(this._stories,'.tickerStoryWithButton');this._storiesWithActions={};for(var xa=0;xa<wa.length;xa++){var ya=wa[xa];this._storiesWithActions[ya.getAttribute('data-story-key')]=ya;}}},_initPageletCache:function(va){if(window.PageletCacheController){this._cache=window.PageletCacheController.registerController(this._root.parentNode.id,this);if(this._cache){ka(va,this._cache.loadData());this._cache.registerCleanup('Ticker/cleanup');}}},_initConfig:function(va){ka(this,{_newest:va.newest,_page_newest:va.newest,_timeout:va.timeout,_heartbeatTimeout:Math.max(15000,va.heartbeatTimeout),_pullTimeout:Math.max(30000,va.pullTimeout),_insertTimeout:va.insertTimeout,_friendCount:va.friendCount,_maxQueueLength:va.maxQueueLength,_heartbeatEndpoint:va.heartbeatEndpoint,_noPoll:va.nopoll,_maxCustomQueueLength:va.maxCustomQueueLength,_customStoryInsertTimeout:Math.max(5000,va.customStoryInsertTimeout),_nonCustomToCustomStoryRatio:va.nonCustomToCustomStoryRatio,_minForceUpdateInterval:Math.max(va.insertTimeout,va.minForceUpdateInterval),_popupOnHover:va.popupOnHover,_priorityAppId:va.priorityAppId,_prefetchOnHover:va.prefetchStoriesOnHover,_userIdleTimeout:va.userIdleTimeout,_firstCustomStoryDelay:va.firstCustomStoryDelay,_pollOnly:va.pollOnly,_tickerSource:va.tickerSource,_prefetchAfterLoad:va.prefetchAfterLoad,_logFlyouts:va.logFlyouts,_userScrollGaurdDelay:va.userScrollGaurdDelay,_rescheduleScrollToTopDelay:va.rescheduleScrollToTopDelay,_aggressiveRegulator:va.aggressiveRegulator});this._queueCustomStories(va.customStories);},_initListeners:function(){this._listeners=Event.listen(this._root,{click:this._handleClick.bind(this),keydown:this._handleKeydown.bind(this),mouseout:this._handleMouseout.bind(this),mouseover:this._handleMouseover.bind(this),mousedown:this._tickerDeClicker.bind(this),mouseup:this._handleMouseup.bind(this)});this._listeners.scroll=Event.listen(this._container,'scroll',na(this._handleScroll.bind(this)));this._initInfiniteScrollListener.bind(this).defer();},_initSubscriptions:function(va){w.onLeave(this._cleanup.bind(this));this._subscriptions=[h.subscribe(u.NAVIGATION_BEGIN,this._onNavHandler.bind(this)),h.subscribe(l.getArbiterType('ticker_update'),this._handleTickerPush.bind(this)),h.subscribe('composer/publish',this._handleComposerPublish.bind(this)),h.subscribe('Ticker/storiesInserted',this._handleStoriesInserted.bind(this)),h.subscribe('Ticker/fixed',this._setFixed.bind(this,true)),h.subscribe('Ticker/unfixed',this._setFixed.bind(this,false)),h.subscribe('Ticker/resized',this._checkInfiniteScroll.bind(this)),h.subscribe('ufi/comment',this._scrollDialogToBottom.bind(this)),h.subscribe('Ticker/chatOpened',this._handleChatOpened.bind(this))];if(va.pushChannel)this.setPushChannel(va.pushChannel);},_handleClick:function(event){var va=event.getTarget();if(this._getButtonFromNode(va)){this._logUserAction(va,'click',event);this._handleActionButton(event);return;}var wa=this._getStoryFromNode(va),xa=v.byClass(va,'tickerStoryAllowClick');if(!wa||wa==this._selectedStory||xa)return;if(this._storyIsHidden(wa))return;if(wa==this._activeStory&&!this._selectedStory)this._selecting=true;this._clearNux();this._logUserEvent('flyout','click');this._logUserEvent('flyout_loadtime','open');if(this._storyCanOpenExternally(wa)){var ya=wa.getAttribute('data-href');if(ya&&!va.getAttribute('href')){var za={href:ya},ab=ja(va,['ft','gt']);ia('click',za,event,'FORCE',ab);oa('ticker',za,event).uai('click');}else this._logUserAction(va,'click',event);this._openStoryExternally(wa,event);return;}this._logUserAction(va,'flyout',event);this._activateStory(wa,'click');this._selectStory(wa);},_handleMouseover:function(event){this._setLocked(true);var va=event.getTarget(),wa=this._getOpenableStory(va);if(!wa)return;event.kill();if(this._prefetchOnHover||this._popupOnHover){if(!(wa.id in this._fetchedStories)){this._logUserEvent('flyout_prefetch','prefetch_on_hover');this._uaCurStoryIDPrefetch=wa.id;}this._fetchStory(wa);}if(this._selectedStory)return;if(this._popupOnHover){this._clearHoverTimeouts();var xa=this._storyCanOpenExternally(wa)?500:1000,ya=this._activeStory?75:xa;this._hoverShowTimeout=this._setTimeout(function(){this._logUserEvent('flyout','hover',ya);this._logUserEvent('flyout_loadtime','open');this._activateStory(wa,'hover');this._logUserAction(va,'flyout',event);}.bind(this),ya);}},_handleMouseout:function(event){var va=event.getTarget();this._setLocked(false);if(va==this._getStoryFromNode(va)){var wa=o.scry(va.parentNode,'.openToggler');for(var xa=0;xa<wa.length;xa++)y.toggle(wa[xa]);}this._clearClickedStory();this._scheduleHide();},_handleKeydown:function(event){this._tickerDeClicker(event);var va=this._activeStory;if(!va)return;var wa=Event.getKeyCode(event);switch(wa){case r.UP:case r.DOWN:var xa=this._getInsertedStories(),ya;if(event.getModifiers().any){ya=wa===r.UP?0:xa.length-1;}else ya=xa.indexOf(va)+(wa===r.UP?-1:1);va=xa[ya];break;case r.ESC:this._deactivateStory(true);return;default:return;}if(!va)return;event.kill();this._activateStory(va,'keypress');this._selectStory(va);},_fadeTopmostStoryButton:function(){var va=0,wa=15;if(this._storiesWithActions)for(var xa in this._storiesWithActions){var ya=this._storiesWithActions[xa],za=o.scry(ya,'.tickerInlineActionButton')[0],ab=o.scry(za,'.tickerActionIcon')[0],bb=ga.getElementPosition(za).y-ga.getElementPosition(this._toggleWrapper).y;if(bb<va){z.set(za,'opacity',0);z.set(ab,'opacity',0);}else if(bb>=va&&bb<wa){var cb=(bb-va)/(wa-va);z.set(za,'opacity',cb);z.set(ab,'opacity',cb);break;}else{z.set(za,'opacity',1);z.set(ab,'opacity',1);}}},_handleScroll:function(){this._fadeTopmostStoryButton();!this._preventScrollDismiss&&this._deactivateStory(true);this._checkInfiniteScroll();this._setIsUserScrolling();if(!this._scrollLogged){this._scrollLogged=true;var va=this._stories.childNodes.length,wa=this._stories.getAttribute('data-gt'),xa={ticker_scroll:1,number_stories:va,source:wa};ia('scroll',null,null,'FORCE',{gt:xa});oa('ticker').uai('scroll');}},_setIsUserScrolling:function(){clearTimeout(this._userScrollingToken);if(this._isScrolledToTop()){this._userScrolling=false;return;}this._userScrolling=true;this._userScrollingToken=setTimeout(function(){this._userScrolling=false;this._userScrollingToken=null;}.bind(this),this._userScrollGaurdDelay);},_isUserScrolling:function(){return this._userScrolling;},_handleStoriesInserted:function(){this._initInfiniteScrollListener();if(this._scrollableArea instanceof x){this._scrollableArea.adjustGripper();}else ta.error('wrong_scrollable_area',{dump:this});this._logUserEvent('stream','insert');},_handleActionButton:function(event){var va=event.getTarget(),wa=this._getOpenableStory(va),xa=this._getStoryDialog(wa);if(xa)var ya=xa.subscribe('beforehide',function(){xa.unsubscribe(ya);return false;});},_handleScrollToTopClick:function(){this._scrollToTop(this._poll.bind(this));},_scheduleScrollToTop:function(){this._scrollToTopToken&&clearTimeout(this._scrollToTopToken);this._scrollToTopToken=setTimeout(function(){if(this._isLocked()||this._isUserScrolling()){this._scheduleScrollToTop();}else{this._scrollToTopToken=null;this._scrollToTop();}}.bind(this),this._rescheduleScrollToTopDelay);},_scrollToTop:function(va){new g(this._container).to('scrollTop',0).ease(g.ease.end).ondone(va).go();},_clearHoverTimeouts:function(){clearTimeout(this._hoverShowTimeout);clearTimeout(this._hoverHideTimeout);},_getAllStories:function(){return o.scry(this._root,'div.fbFeedTickerStory');},_getInsertedStories:function(){return this._getAllStories().filter(function(va){return !n.hasClass(va,'queuedStory')&&!n.hasClass(va,'customStory');});},_getQueuedStories:function(){return o.scry(this._storyQueue,'.fbFeedTickerStory.queuedStory');},_getQueuedCustomStories:function(){return o.scry(this._storyQueue,'.fbFeedTickerStory.customStory');},_getButtonFromNode:function(va){return v.byClass(va,'tickerInlineOverlay');},_getStoryFromNode:function(va){return v.byClass(va,'fbFeedTickerStory');},_getActionButtonFromStory:function(va){return o.scry(va,'.tickerInlineActionButton')[0];},_getOpenableStory:function(va){var wa=this._getStoryFromNode(va);return this._storyCanOpenDialog(wa)?wa:null;},_getStoryDialog:function(va){return m.getInstance(va);},_getStoryDialogEndpoint:function(va){return va&&va.getAttribute('data-rel')=='async'&&va.getAttribute('data-ajaxify')||null;},_storyCanOpenDialog:function(va){return !!this._getStoryDialogEndpoint(va)&&!this._storyIsHidden(va);},_storyCanOpenExternally:function(va){return !!va.getAttribute('data-href')||!this._storyCanOpenDialog(va);},_storyIsHidden:function(va){return n.hasClass(va,'tickerStoryHidden');},hideActiveStory:function(){this._activeStory&&this.hideStory(this._activeStory);},hideStory:function(va){this._deactivateStory();n.addClass(va,'tickerStoryHidden');n.removeClass(va,'tickerStoryClickable');},undoHideStory:function(va){n.addClass(va,'tickerStoryClickable');n.removeClass(va,'tickerStoryHidden');},insertStoriesAtBottom:function(va){if(!va)return;var wa=o.create('div');wa.appendChild(va);var xa=o.scry(wa,'.fbFeedTickerStory'),ya=o.find(wa,'.tickerMorePager'),za=[];for(var ab=0;ab<xa.length-1;ab++)if(!this.dedupeStory(xa[ab]))za.push(xa[ab]);if(za.length){za.push(ya);o.replace(o.find(this._root,'.tickerMorePager'),za);}h.inform('Ticker/storiesInserted');},_scheduleHide:function(){if(this._popupOnHover&&!this._selectedStory){this._clearHoverTimeouts();this._hoverHideTimeout=this._setTimeout(this._deactivateStory.bind(this),100);}},_setScrollTopPromptVisible:function(va){this._scrollTopPromptVisible=va;n.conditionShow(this._scrollTopPrompt,va);if(va&&!this._listeners.scrollTop){this._listeners.scrollTop=Event.listen(this._scrollTopPrompt,{click:this._handleScrollToTopClick.bind(this)});}else if(!va&&this._listeners.scrollTop){this._listeners.scrollTop.click.remove();this._listeners.scrollTop=null;}},_isUserIdle:function(){return !ea.isActive(this._userIdleTimeout);},_schedulePoll:function(){clearTimeout(this._pollToken);this._pollToken=this._setTimeout(this._poll.bind(this),this._timeout);},_poll:function(){if(!this._isTickerVisible())return;if(this._storiesToRemove.length>0){if(this._isInsertingStory)return this._schedulePoll();var va=this._storiesToRemove.pop();this.removeStory(va);}var wa=!this._isScrolledToTop()&&this._getQueuedStories().length;this._setScrollTopPromptVisible(wa);var xa=Date.now(),ya=xa-this._lastInsert;if(ya<this._insertTimeout||this._isLocked())return this._schedulePoll();var za=this._getQueuedStories(),ab=this._getQueuedCustomStories(),bb=this._isUserIdle(),cb=za.length>0,db=ab.length>0&&!bb&&(xa-this._initTime>this._firstCustomStoryDelay)&&(this._needNonCustomStoryNum===0||(!cb&&(xa-this._lastCustomStory)>this._customStoryInsertTimeout));if(db){this.insertStory(ab.shift());this._lastCustomStory=xa;this._needNonCustomStoryNum=this._nonCustomToCustomStoryRatio;return this._schedulePoll();}if(cb){this.insertStory(za.shift());this._needNonCustomStoryNum--;if(this._needNonCustomStoryNum<0)this._needNonCustomStoryNum=0;return this._schedulePoll();}if(bb)return ea.subscribeOnce(this._poll.bind(this));var eb=ab.length===0&&this._needNonCustomStoryNum===0&&this._nonCustomToCustomStoryRatio>0&&ea.isActive(this.ADS_IDLE_MS)&&((xa-this._lastUpdate)>this._minForceUpdateInterval),fb=false,gb=false;if(this._pollOnly){gb=xa-this._lastUpdate>this._heartbeatTimeout;}else fb=(xa-this._lastPull>this._pullTimeout);var hb=(eb&&this._doCustomUpdate)||fb||gb;if(!hb)return this._schedulePoll();if(eb)this._doCustomUpdate=false;this.update({pull:fb,fullpoll:gb,needcustomstory:eb});},update:function(va){if(this._noPoll&&!this._pollOnly)return this._schedulePoll();var wa={newest:(va.fullpoll||va.cache_update)?this._newest:this._page_newest,storyids:this._storyIDs,friendcount:this._friendCount,priorityappid:this._priorityAppId,source:this._tickerSource,needcustomstory:this._nonCustomToCustomStoryRatio>0};ka(wa,va);new i().setURI(this._heartbeatEndpoint).setReadOnly(true).setOption('retries',0).setData(wa).setHandler(this._handleResponse.bind(this)).setFinallyHandler(this._poll.bind(this)).setAllowCrossPageTransition(true).send();this._lastUpdate=Date.now();if(wa.pull)this._lastPull=this._lastUpdate;this._storyIDs=[];},insertStory:function(va,wa,xa){this._lastInsert=Date.now();window.LiveTimer&&t.addTimeStamps(va);n.removeClass(va,'queuedStory');n.removeClass(va,'customStory');if(wa!==false){var ya=xa?this._fadeStoryIn:this._flyStoryIn;if(this._isUserScrolling()){var za=function(){this._container.scrollTop=this._container.scrollTop+this._stories.firstChild.offsetHeight;this._scheduleScrollToTop();}.bind(this);this._fadeStoryIn(va,za);}else this._scrollToTop(ya.bind(this,va));}else o.prependContent(this._stories,va);if(this._storiesWithActions&&n.hasClass(va,'tickerStoryWithButton'))this._storiesWithActions[va.getAttribute('data-story-key')]=va;this._removeOldStories();},_removeOldStories:function(){var va=this._getInsertedStories();if(va.length<=this._maxStoriesToKeep)return;var wa=this._minStoriesToKeep,xa=va.slice(wa);xa.forEach(o.remove);if(this._storiesWithActions)for(var ya=0;ya<xa.length;ya++)delete this._storiesWithActions[xa[ya].getAttribute('data-story-key')];this._resetMorePager();},_resetMorePager:function(){var va=this._getInsertedStories();if(!va||!va.length)return;var wa=va[va.length-1].getAttribute('data-ticker-timestamp'),xa=o.scry(this._root,'.tickerMorePager a')[0];if(!xa||!wa)return;var ya=new da(xa.getAttribute('ajaxify'));ya.addQueryData({oldest:wa});xa.setAttribute('ajaxify',ya);},_setLocked:function(va){this._locked=va;},_isLocked:function(){return !!(this._locked||this._activeStory);},informAndRemoveStory:function(va,wa,xa){var ya=this._getStoryFromNode(va),za=ya.getAttribute('data-story-key');o.setContent(ya,wa);n.addClass(ya,'highlightedStory');this._setTimeout(this.removeStory.bind(this,za),xa||6000);},_getStoryByStoryKey:function(va){var wa=this._getAllStories();for(var xa=0;xa<wa.length;xa++){var ya=wa[xa];if(ya.getAttribute('data-story-key')==va)return ya;}return null;},removeStory:function(va){this._removedStoryIDs[va]=true;var wa=this._getStoryByStoryKey(va);if(!wa)return;if(this._storiesWithActions)delete this._storiesWithActions[va];if(wa==this._activeStory)this._deactivateStory();var xa=this._getStoryDialog(wa);xa&&xa.destroy();if(n.hasClass(wa,'queuedStory')){o.remove(wa);return;}this._animateStoryOut(wa);},_isScrolledToTop:function(){return this._container.scrollTop<=this._scrollTopThreshold;},_flyStoryIn:function(va){var wa=o.create('div',{style:{marginTop:'-1000px'}},va);z.set(wa,'opacity',0);o.prependContent(this._stories,wa);var xa=ga.getElementDimensions(wa).y;z.set(wa,'marginTop','-'+xa+'px');this._isInsertingStory=true;new g(wa).to('marginTop',0).ease(g.ease.end).checkpoint(.5).to('opacity',1).ondone(function(){o.replace(wa,va);this._afterInsert(va);this._isInsertingStory=false;}.bind(this)).go();},_fadeStoryIn:function(va,wa){new g(this._stories).to('opacity',.5).ondone(function(){o.prependContent(this._stories,va);if(wa)wa();new g(this._stories).to('opacity',1).ondone(function(){this._afterInsert(va);}.bind(this)).go();}.bind(this)).go();},_animateStoryOut:function(va){var wa=o.create('div',{style:{overflow:'hidden',position:'relative'}});o.insertBefore(va,wa);o.appendContent(wa,va);new g(wa).to('top',20).to('height',0).to('opacity',0).ease(g.ease.end).ondone(function(){o.remove.curry(wa);h.inform('Ticker/animateOut');}.bind(this)).go();},_afterInsert:function(va){h.inform('Ticker/afterInsert');},setPushChannel:function(va){this._pushSubscription&&this._pushSubscription.unsubscribe();this._pushSubscription=h.subscribe(l.getArbiterType(va),this._handleTickerPush.bind(this));d(['ChatConfig','ChannelConnection'],function(wa,xa){this._channelConnection=xa;this._checkChannelConnection();this._channelConnectionSubscription=this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],this._handleChannelConnection.bind(this));}.bind(this));},_checkChannelConnection:function(){n.conditionClass(this._root,'disconnected',this._channelConnection.disconnected());},setCurrentAppId:function(va){this._priorityAppId=va;},_handleTickerPush:function(va,wa){var xa=wa.obj;if(xa.delete_id){this._storiesToRemove.push(xa.delete_id);return;}if(xa.fromups)if(xa.do_logging)this._logDarkLaunch(xa);var ya=xa.story_xhp;if(!ya)return;this._newest=xa.story_time;var za=p(ya).getRootNode();this.queueStory(za,xa.flyout_js_cmds);if(this._aggressiveRegulator&&xa.actor==this._newestStory.actorID){this.removeStory(this._newestStory.storyKey);new j('/common/ods_endpoint.php',{k:'ticker.aggr.remove'}).send();}this._newestStory={actorID:xa.actor,storyKey:za.getAttribute('data-story-key')};},_handleComposerPublish:function(va,wa){wa.tickerMarkup&&this.insertStory(wa.tickerMarkup);},_clearNux:function(){var va=o.scry(document.body,'div.tickerNUXContainer');if(va.length){va.forEach(function(wa){var xa=m.getInstance(wa);xa&&xa.hide();});new i().setURI('/ajax/feed/ticker/nux.php').send();}this._clearNux=bagofholding;},_logDarkLaunch:function(va){var wa={actor:va.actor,story_time:va.story_time,key:va.story_obj_id,dark:1};new i().setURI('/alite/push/log.php').setData({msg:JSON.stringify(wa)}).send();},_logRender:function(){if(this._loggedRender)return;var va=this._tickerInSidebarMode;if(va||v.byClass(this._content,'home_right_column')){new j('/ajax/log_ticker_render.php',{sidebar_mode:va}).send();this._loggedRender=true;}},_isTickerVisible:function(){var va=(ua._activeInstance==this);va&&this._logRender();return va;},_handleResponse:function(va){var wa=va.getPayload();if(wa.newest)this._newest=this._page_newest=wa.newest;if(wa.content)if(wa.cache_update&&this._cache){this._cache.insertStory(wa.content);}else if(wa.content instanceof Array){for(var xa=0;xa<wa.content.length;xa++)this.queueStoryMarkup(wa.content[xa]);}else this.queueStoryMarkup(wa.content);if(wa.custom_stories&&wa.custom_stories.length){this._queueCustomStories(wa.custom_stories);this._doCustomUpdate=true;}},queueStoryMarkup:function(va){var wa=p(va).getRootNode();this.queueStory(wa);},dedupeStory:function(va){var wa=va.getAttribute('data-story-key'),xa=wa&&(!!this._objectIDs[wa]||!!this._removedStoryIDs[wa]);wa&&(this._objectIDs[wa]=true);return xa;},queueStory:function(va,wa){if(this.dedupeStory(va))return;n.addClass(va,'queuedStory');o.appendContent(this._storyQueue,va);var xa=wa&&wa.length;if(xa)wa.forEach(function(za){new Function(za).apply();});va.setAttribute('id',va.id+'_'+this._root.id);var ya=this._getQueuedStories();ya.slice(0,-this._maxQueueLength).forEach(o.remove);if(xa)this._fetchedStories[va.id]=true;},_queueCustomStories:function(va){while(va.length){var wa=va.shift();wa=p(wa).getRootNode();if(this.dedupeStory(wa))continue;n.addClass(wa,'customStory');o.appendContent(this._storyQueue,wa);}var xa=this._getQueuedCustomStories();xa.slice(0,-this._maxQueueLength).forEach(o.remove);},_cleanup:function(){ua._placeholders.pagelet_rhc_ticker=null;if(!v.byClass(this._content,'hasRightCol'))return;this._objectIDs=[];this._subscriptions.forEach(h.unsubscribe);this._channelConnectionSubscription&&this._channelConnection.unsubscribe(this._channelConnectionSubscription);this._pushSubscription&&this._pushSubscription.unsubscribe();for(var va in this._listeners)this._listeners[va]&&this._listeners[va].remove();clearTimeout(this._pollToken);this._pollToken=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();h.inform('Ticker/cleanup');},_onNavHandler:function(va,wa){var xa=wa.params.key;if(xa!='lf'&&xa!='h')this._cleanup();},registerStoryDialog:function(va,wa){if(this._uaCurStoryIDFetch==va.id){this._uaCurStoryIDFetch=null;this._logUserEvent('flyout','fetch_success');}if(this._uaCurStoryIDPrefetch==va.id){this._uaCurStoryIDPrefetch=null;this._logUserEvent('flyout_prefetch','prefetch_success');}this._fetchedStories[va.id]=true;wa.setContext(va);wa.subscribe('hide',this._deactivateStory.bind(this,true));wa.subscribe('success',this._focusStory.bind(this,va));wa.subscribe('beforehide',function(){if(this._selecting){this._selecting=false;return false;}}.bind(this));if(this._popupOnHover){wa.subscribe('mouseenter',this._clearHoverTimeouts.bind(this));wa.subscribe('mouseleave',this._scheduleHide.bind(this));wa.subscribe('show',function(){this._highlightDialogScrollbar.bind(this,wa).defer();var xa=Event.listen(wa.getContent(),'click',function(){this._selectStory(va);xa.remove();}.bind(this));}.bind(this));}if(va==this._activeStory){this._logUserEvent('flyout_loadtime','show_fetched');this._logUserEvent('flyout','show');this._openDialog(wa);}},_highlightDialogScrollbar:function(va){var wa=o.scry(va.getContent(),'.uiScrollableArea')[0];wa&&x.poke(wa);},_openStoryExternally:function(va,event){var wa=va.getAttribute('data-href');if(!wa||wa=='#')return;var xa=va.getAttribute('data-story-rel');switch(xa){case 'theater':this._deactivateAndClearStory();k.loadModules(['PhotoViewer'],function(ab){ab.bootstrap(wa,va);});return;case 'async':this._deactivateAndClearStory();i.bootstrap(wa,va);return;}var ya=va.getAttribute('data-target'),za=(event.which!=1||event.getModifiers().any||ya=='_blank');za?window.open(wa,'_blank'):ma(wa);},_deactivateAndClearStory:function(){this._clearHoverTimeouts();this._deactivateStory();},_focusStory:function(va){clearTimeout(this._scrollDismissal);this._preventScrollDismiss=true;this._scrollDismissal=this._setTimeout(function(){this._preventScrollDismiss=false;}.bind(this),100);va.focus();},_selectStory:function(va){this._selectedStory=va;n.addClass(va,'tickerStorySelected');n.addClass(this._root,'tickerChildSelected');},_activateStory:function(va,wa){this._clearHoverTimeouts();if(va==this._activeStory||!this._storyCanOpenDialog(va))return;this._deactivateStory();this._focusStory(va);this._activeStory=va;n.addClass(va,'tickerStoryActive');window.Toggler&&ba.hide();if(this._logFlyouts){wa=wa||'unknown';new j('/ajax/feed/ticker/flyout.php',{src:wa}).send();}aa.log(va);var xa=this._getStoryDialog(va);if(xa){this._logUserEvent('flyout_loadtime','show_prefetched');this._logUserEvent('flyout','show');this._openDialog(xa);return;}if(!(va.id in this._fetchedStories)){this._uaCurStoryIDFetch=va.id;this._logUserEvent('flyout','fetch');}this._fetchStory(va);},_deactivateStory:function(va){if(this._activeStory===this._deactivatingStory)return;this._deactivatingStory=this._activeStory;if(this._dialog){if(va===true){this._dialog.enableBehavior(s);}else this._dialog.disableBehavior(s);this._dialog.hide();this._logUserEvent('flyout','close');}if(this._activeStory){n.removeClass(this._activeStory,'tickerStoryActive');n.removeClass(this._activeStory,'tickerStorySelected');n.removeClass(this._root,'tickerChildSelected');}this._dialog=this._selectedStory=this._activeStory=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();this._deactivatingStory=null;},_logUserAction:function(va,wa,event){ia(wa,va,event,'FORCE');oa('ticker',va,event).uai(wa);},_logUserEvent:function(va,event){if(this._ua[va])this._ua[va].add_event(event);},_fetchStory:function(va){clearTimeout(this._fetchToken);var wa=[],xa=this._getInsertedStories(),ya=xa.indexOf(va);[-1,0,1].forEach(function(za){var ab=xa[ya+za];ab&&wa.push(ab);},this);this._fetchToken=setTimeout(this._fetchStories.bind(this,wa),100);},_fetchStories:function(va){var wa=[],xa,ya=function(za){clearTimeout(xa);va.forEach(function(ab){n.conditionClass(ab,'tickerStoryFetching',za);});};va=va.filter(function(za){if(za.id in this._fetchedStories)return false;this._fetchedStories[za.id]=true;var ab=this._getStoryDialogEndpoint(za),bb=da(ab).getQueryData();if(!ab||!bb)return false;bb.uniq_id=za.getAttribute('id');bb.referrer=this._tickerSource;wa.push(bb);return true;},this);if(!wa.length)return;xa=this._setTimeout(ya.curry(true),500);new i('/ajax/feed/ticker/multi_story').setFinallyHandler(ya.curry(false)).setErrorHandler(bagofholding).setData({stories:wa}).setAllowCrossPageTransition(this._tickerInSidebarMode).send();},_tickerDeClicker:function(event){var va=event.getTarget(),wa=v.byTag(va,'a'),xa=this._getStoryFromNode(va),ya=this._getButtonFromNode(va);if(xa&&wa&&!ya&&n.hasClass(xa,'tickerStoryClickable')&&!n.hasClass(wa,'tickerStoryAllowClick')&&!this._storyIsHidden(xa)){wa.setAttribute('rel','ignore');wa.removeAttribute('onclick');wa.removeAttribute('ajaxify');wa.removeAttribute('href');}var za=(event.button==2),ab=(event.type==='keydown'),bb=xa&&this._getActionButtonFromStory(xa);if(!za&&bb&&!ab)this._setClickedStory(xa);},_handleMouseup:function(event){this._clearClickedStory();},_setClickedStory:function(va){this._clearClickedStory();n.addClass(va,'tickerStoryClicked');this._clickedStory=va;},_clearClickedStory:function(){if(this._clickedStory){n.removeClass(this._clickedStory,'tickerStoryClicked');this._clickedStory=null;}},_initInfiniteScrollListener:function(){var va=this._getInsertedStories();if(this._storiesWithActions)for(var wa=0;wa<va.length;wa++){var xa=va[wa];if(n.hasClass(xa,'tickerStoryWithButton'))this._storiesWithActions[xa.getAttribute('data-story-key')]=xa;}var ya=Math.max(0,va.length-this._autoloadStoryIndex);this._infiniteScrollStory=va[ya];this._checkInfiniteScroll();},_checkInfiniteScroll:function(){if(this._infiniteScrollStory){var va=ga.getElementPosition(this._infiniteScrollStory).y,wa=ga.getElementPosition(this._container).y+ga.getElementDimensions(this._container).y;if(va<wa){var xa=o.scry(this._root,'.tickerMorePager a')[0];if(xa){var ya=v.byClass(xa,'stat_elem')||xa;new i(xa.getAttribute('ajaxify')).setReadOnly(true).setRelativeTo(xa).setStatusElement(ya).setAllowCrossPageTransition(true).send();this._logUserEvent('stream','scroll');}this._infiniteScrollStory=null;this._autoloadStoryIndex=5;}}},_setFixed:function(va){if(!this._selectedStory)return;var wa=this._getStoryDialog(this._selectedStory);if(wa){wa.setFixed(va);wa.updatePosition();}},_setTimeout:function(va,wa){return setTimeout(va,wa,!this._tickerInSidebarMode);},_scrollDialogToBottom:function(){var va=this._dialog&&this._dialog.getContent(),wa=va&&o.scry(va,'.uiScrollableAreaWrap')[0],xa=wa&&x.getInstance(wa);xa&&xa.scrollToBottom();},_openDialog:function(va){this._dialog=va.show();this._updateDialogPosition();this._writeSwfFrame(va);this._initCommentFocusListener.bind(this).defer();this._initContentResizeListener.bind(this).defer();this._stupidIE7VideoResizeHack(va);},_stupidIE7VideoResizeHack:function(va){if(fa.ie()===7){var wa=o.scry(va.getContent(),'.uiVideoThumb .img');wa.forEach(function(xa){z.set(xa,'width','');});}},_updateDialogPosition:function(){var va=this._tickerInSidebarMode||!!v.byClass(this._root,'fixed_elem');this._dialog.setFixed(va);this._adjustFlyoutContentHeight();this._dialog.updatePosition();},_writeSwfFrame:function(va){var wa=this._dialog&&this._dialog.getContent(),xa=o.scry(wa,'.swfObject')[0];if(!xa)return;var ya=xa.getAttribute('data-swfid');if(ya&&window[ya]){var za=window[ya];za.write(xa);}},_initCommentFocusListener:function(){var va=this._dialog&&this._dialog.getContent(),wa=va&&o.scry(va,'.tickerDialogFooter textarea')[0];if(!wa)return;this._listeners.inputFocus=Event.listen(wa,'focus',this._scrollDialogToBottom.bind(this));},_cleanupInputFocusListener:function(){if(this._listeners.inputFocus){this._listeners.inputFocus.remove();this._listeners.inputFocus=null;}},_initContentResizeListener:function(){var va=this._dialog&&this._dialog.getContent();if(!va)return;this._listeners.contentResize=Event.listen(va,'click',function(){this._dialog.updatePosition.bind(this._dialog).defer();}.bind(this));},_cleanupContentResizeListener:function(){if(this._listeners.contentResize){this._listeners.contentResize.remove();this._listeners.contentResize=null;}},_adjustFlyoutContentHeight:function(){var va=this._dialog&&this._dialog.getContent(),wa=va&&o.scry(va,'.uiScrollableAreaWrap')[0];if(!wa)return;var xa=ga.getElementDimensions(wa),ya=ga.getElementPosition(wa),za=o.scry(wa,'.uiUfi .uiUfiComment'),ab=ga.getViewportDimensions().y-this.FLYOUT_VIEWPORT_PADDING,bb=Math.min(this.FLYOUT_MAX_HEIGHT,ab),cb=bb-this.FLYOUT_TARGET_HEIGHT_OFFSET;for(var db=0;db<za.length;db++){var eb=za[db],fb=ga.getElementPosition(eb),gb=fb.y-ya.y;if(Math.abs(gb-cb)<=this.FLYOUT_OFFSET_THRESHOLD){cb=gb+this.FLYOUT_COMMENT_OFFSET;break;}}if(xa.y>cb){z.set(wa,'height',cb+'px');z.set(wa,'max-height',null);}else{z.set(wa,'max-height',bb+'px');z.set(wa,'height',null);}},_initObjectIDs:function(){var va=this._getAllStories();for(var wa=0;wa<va.length;++wa){var xa=va[wa].getAttribute('data-story-key');xa&&(this._objectIDs[xa]=true);}},_handleChatOpened:function(){this._deactivateStory(true);},_handleChannelConnection:function(){this._checkChannelConnection();},getNewest:function(){return this._newest;}});e.exports=ua;});
__d("legacy:TickerController",["TickerController"],function(a,b,c,d){a.TickerController=b('TickerController');},3);
__d("HomeTickerFirstRightColumnController",["$","ge","debounceAcrossTransitions","throttle","UIPagelet","Arbiter","Style","csx","CSS","DOM","Vector","Run","ContextualDialogX","TickerController","UIIntentionalStreamMessage","event-extensions"],function(a,b,c,d,e,f){var g=b('$'),h=b('ge'),i=b('debounceAcrossTransitions'),j=b('throttle'),k=b('UIPagelet'),l=b('Arbiter'),m=b('Style'),n=b('csx'),o=b('CSS'),p=b('DOM'),q=b('Vector'),r=b('Run'),s=b('ContextualDialogX'),t=b('TickerController'),u=b('UIIntentionalStreamMessage');b('event-extensions');var v=null,w=75,x=50,y=15,z=false,aa=false,ba,ca,da,ea,fa,ga,ha,ia,ja,ka=x,la=[],ma=[],na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za;function ab(){var rb=nb;function sb(){rb.defer();}var tb=p.scry(qa,'img.img');tb.forEach(function(ub){if(!ub.complete)Event.listen(ub,{load:sb,error:sb,abort:sb});});sb();}function bb(){ma=[l.subscribe('page_transition',eb),l.subscribe('netego_loaded',nb),l.subscribe('Ticker/storiesInserted',nb),l.subscribe('concierge/load',nb),l.subscribe(u.INSERT_STORIES,nb)];if(v.enableSidebar){ma.push(l.subscribe('sidebar/hide',ob));ma.push(l.subscribe('sidebar/show',pb));}}function cb(){if(qa){var rb=p.scry(qa,"div._24o");for(var sb=0;sb<rb.length;sb++){var tb=JSON.parse(rb[sb].getAttribute('data-ad')).segment;if(tb==='premium')return true;}}return false;}function db(){za=p.scry(document,'div.fbRemindersContent');ua=p.scry(h('rightCol'),'div.home_right_column')[0];va=p.find(ua,'div.rightColumnWrapper');qa=h('pagelet_ego_pane_w')||h('pagelet_ego_pane_m');ea=v.refreshPremiumAds||!cb();Event.listen(qa,'mouseenter',function(){z=true;});Event.listen(qa,'mouseleave',function(){z=false;});ra=h('pagelet_rhc_ticker');if(!ra)return false;sa=p.scry(ra,'.ticker_container')[0];ta=p.scry(ra,'.ticker_stream')[0];return sa&&ta;}function eb(rb,sb){if(rb==='page_transition'&&sb&&sb.uri){var tb=sb.uri;if(tb.path==='/photo.php'){aa=true;return;}if(aa&&tb.path==='/'){aa=false;return;}}ma.forEach(l.unsubscribe);ma=[];la.forEach(function(ub){ub.remove();});la=[];na.reset();}function fb(){if(ia||!ba)ja=q.getElementPosition(qa,'viewport').y-q.getElementPosition(va,'viewport').y;}function gb(){fb();var rb=ka;kb();if(rb!=ka){ia=true;lb();}ya=wa+q.getElementPosition(pa,'viewport').y;var sb=ya,tb=q.getElementPosition(ua,'viewport').y;for(var ub=0;ub<za.length;ub++){var vb=s.getInstance(za[ub]);vb.hide();}if(ca||!ta){if(v.fixAdsOnScroll&&ha!==null){var wb=tb+ja,xb=wb<=sb-ha;if(ia||xb!==ba){ia=false;var yb=sb-ha-ja;mb(xb,yb);}}return;}var zb=tb<=sb+y;if(zb!==ba)mb(zb);}function hb(){var rb=Date.now();if(ea&&!z&&v.adsRefreshInterval&&rb-fa>=v.adsRefreshInterval)ib();}function ib(){fa=Date.now();k.loadFromEndpoint('WebEgoPane',qa,{pid:27,data:{organic_only:false,ads_only:false,refresh_num:++ga}},{bundle:false,crossPage:false,handler:ab});}function jb(){ia=true;fb();kb();lb();gb();}function kb(){var rb=q.getDocumentDimensions().y-(q.getScrollPosition('document').y+q.getViewportDimensions().y);ka=rb>xa?x:w;}function lb(){if(!v.fixAdsOnScroll)return;var rb=q.getViewportDimensions().y-wa-ka,sb=q.getElementDimensions(va).y;if(sb<=rb){ha=0-ja-y;return;}var tb=sb-ja,ub=p.scry(qa,'div.egoOrganicColumn')[0];if(tb<=rb&&ub){ha=0;}else{var vb=p.scry(qa,'div.ego_unit').reverse(),wb=p.scry(qa,"div._24o").length,xb=v.maxFixedAds;if(wb<=v.maxFixedAds)xb=vb.length;var yb=null;for(var zb=0;zb<xb;zb++){var ac=vb[zb],bc=q.getElementPosition(ac,'viewport').y-q.getElementPosition(va,'viewport').y,cc=q.getElementDimensions(va).y-bc;if(cc>rb){if(zb>0)yb=vb[zb-1];break;}if(zb==xb-1)yb=ac;}if(yb==null){ha=null;}else ha=q.getElementPosition(yb,'viewport').y-q.getElementPosition(qa,'viewport').y;}}function mb(rb,sb){ba=rb;sb=sb||ya;var tb=rb?sb+'px':'';m.set(va,'top',tb);o.conditionClass(va,'fixed_elem',rb);var ub=p.scry(va,'div.displayedTickerToggleWrapper')[0];ub&&o.conditionClass(ub,'toggleWrapperWithoutMargin',v.fixAdsOnScroll&&rb&&!ta);if(da){var vb=rb?'Ticker/fixed':'Ticker/unfixed';l.inform(vb);}}function nb(){if(!da||!ta||o.hasClass(document.documentElement,'tinyViewport')){jb();return;}gb();var rb=q.getViewportDimensions().y,sb=61,tb=q.getElementDimensions(va).y-q.getElementDimensions(sa).y,ub=q.getElementDimensions(ta).y,vb=rb-tb-w-ya-sb,wb=v.tickerAbsMinHeight||120,xb=v.tickerMinHeight||225;ca=false;if(vb<wb){ca=true;mb(false);vb=wb;}else if(vb<xb)if(vb>(xb-sb)){vb=xb;}else vb+=sb;var yb=Math.min(vb,ub,v.tickerMaxHeight||425);m.set(sa,'height',yb+'px');}function ob(){da=true;db();var rb=function(){if(db()){ca=false;gb();nb();}};ra&&t.show(ra,rb);}function pb(){da=false;db();if(v.fixAdsOnScroll){jb();}else{ca=true;mb(false);}ra&&t.hide(ra);}var qb={init:function(rb){v=rb;oa=g('contentCol');pa=g('blueBar');ga=0;fa=Infinity;fa=Date.now();na=i(hb,v.adsRefreshDelay);if(v.adsRefreshOnmove)la.push(Event.listen(window,'mousemove',na));la.push(Event.listen(window,'scroll',na));la.push(Event.listen(window,'resize',na));la.push(Event.listen(window,'resize',j(nb)));wa=q.getElementDimensions(pa).y;xa=q.getElementDimensions(g('pageFooter')).y;db();bb();r.onLeave(eb);la.push(Event.listen(window,'scroll',j(gb)));if(!o.hasClass(document.documentElement,'sidebarMode')){ob();}else if(v.enableSidebar)pb();ab();}};e.exports=qb;});