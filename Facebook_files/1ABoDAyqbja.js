/*1347249099,178142509*/

if (window.CavalryLogger) { CavalryLogger.start_js(["Cxmzw"]); }

__d("AsyncUploadBase",["ArbiterMixin","AsyncRequest","AsyncResponse","Form","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('AsyncResponse'),j=b('Form'),k=b('UserAgent'),l=b('copyProperties');function m(o){this.setURI(o);}m.isSupported=function(){if(k.safari()&&!k.chrome()&&k.windows())return false;return ('FileList' in window)&&('FormData' in window);};l(m.prototype,g,{_limit:10,setAllowCrossOrigin:function(o){this._allowCrossOrigin=!!o;return this;},setData:function(o){this._data=o;return this;},setLimit:function(o){this._limit=o;return this;},setRelativeTo:function(o){this._relativeTo=o;return this;},setStatusElement:function(o){this._statusElement=o;return this;},setURI:function(o){this._uri=o;return this;},_createFileUpload:function(o,p,q){return new n(o,p,q);},_parseFiles:function(o){var p={};for(var q in o){var r=o[q];if(Array.isArray(r)){p[q]=r;}else{p[q]=[];if(r instanceof window.FileList){for(var s=0;s<r.length;s++)p[q].push(r.item(s));}else if(r instanceof window.File||r instanceof window.Blob)p[q].push(r);}}return p;},_processQueue:function(){while(this._pending.length<this._limit){if(!this._waiting.length)break;var o=this._waiting.shift();this._processUpload(o);this._pending.push(o);}},_processUpload:function(o){this.inform('start',o);var p=j.createFormData(o.getData()||this._data);if(o.getFile())p.append(o.getName(),o.getFile());new h().setAllowCrossOrigin(this._allowCrossOrigin).setURI(this._uri).setRawData(p).setRelativeTo(this._relativeTo).setStatusElement(this._statusElement).setHandler(this._success.bind(this,o)).setErrorHandler(this._failure.bind(this,o)).setUploadProgressHandler(this._progress.bind(this,o)).setInitialHandler(this._initial.bind(this,o)).send();},_initial:function(o){this.inform('initial',o);},_success:function(o,p){this.inform('success',o.handleSuccess(p));this._complete(o);},_failure:function(o,p){if(this.inform('failure',o.handleFailure(p))!==false)i.defaultErrorHandler(p);this._complete(o);},_progress:function(o,event){this.inform('progress',o.handleProgress(event));},_complete:function(o){this._pending.remove(o);this._processQueue();if(!this._pending.length)this._inFlight=false;}});var n=function(o,p,q){this._name=o;this._file=p;this._data=q;this._success=null;this._response=null;this._progressEvent=null;};l(n.prototype,{getName:function(){return this._name;},getFile:function(){return this._file;},getData:function(){return this._data;},isComplete:function(){return this._success!==null;},isSuccess:function(){return this._success===true;},getResponse:function(){return this._response;},getProgressEvent:function(){return this._progressEvent;},handleSuccess:function(o){this._success=true;this._response=o;this._progressEvent=null;return this;},handleFailure:function(o){this._success=false;this._response=o;this._progressEvent=null;return this;},handleProgress:function(event){this._progressEvent=event;return this;}});e.exports=m;});
__d("AsyncUploadRequest",["AsyncUploadBase","Class","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncUploadBase'),h=b('Class'),i=b('copyProperties');function j(k){this.parent.construct(this,k);}j.isSupported=function(){return g.isSupported();};h.extend(j,g);i(j.prototype,{setFiles:function(k){this._files=this._parseFiles(k);return this;},send:function(){if(this._inFlight)return;this._inFlight=true;this._uploads=[];for(var k in this._files)this._files[k].forEach(function(l){this._uploads.push(this._createFileUpload(k,l));}.bind(this));if(this._uploads.length){this._waiting=this._uploads.slice(0);this._pending=[];this._processQueue();}else this._processUpload(this._createFileUpload(null,null));},_complete:function(k){this.parent._complete(k);if(!this._pending.length)this.inform('complete',this._uploads);}});e.exports=j;});
__d("FileForm",["event-extensions","ArbiterMixin","AsyncRequest","AsyncUploadRequest","AsyncResponse","BehaviorsMixin","DataStore","DOMQuery","Env","Form","JSONPTransport","Parent","URI","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('AsyncUploadRequest'),j=b('AsyncResponse'),k=b('BehaviorsMixin'),l=b('DataStore'),m=b('DOMQuery'),n=b('Env'),o=b('Form'),p=b('JSONPTransport'),q=b('Parent'),r=b('URI'),s=b('copyProperties');function t(v){var w={},x=m.scry(v,'input[type="file"]');x.forEach(function(y){w[y.name]=y.files;});return w;}function u(v,w,x){if(v.getAttribute('rel')==='async')throw new Error('FileForm cannot be used with Primer forms.');if(v.getAttribute('method').toUpperCase()!=='POST')throw new Error('FileForm must be used with POST forms.');this._form=v;this._previousEncoding=this._form.enctype;this._form.enctype=this._form.encoding='multipart/form-data';w&&this.enableBehaviors(w);this._options=x||{};this.setAllowCrossOrigin(this._options.allowCrossOrigin);this.setUploadInParallel(this._options.uploadInParallel);this._listener=Event.listen(this._form,'submit',this._submit.bind(this));l.set(this._form,'FileForm',this);}s(u,{EVENTS:['submit','initial','progress','success','failure'],getInstance:function(v){return l.get(v,'FileForm');}});s(u.prototype,g,k,{getRoot:function(){return this._form;},setAllowCrossOrigin:function(v){this._allowCrossOrigin=!!v;return this;},setUploadInParallel:function(v){this._uploadInParallel=!!v;return this;},_submit:function(event){if(this.inform('submit')===false){event.prevent();return;}var v='FormData' in window;if(v)if(!r(this._form.action).isSameOrigin()&&!this._allowCrossOrigin)v=false;return v?this._sendViaXHR(event):this._sendViaFrame(event);},_sendViaFrame:function(event){var v=new h();v.setStatusElement(this._getStatusElement());v.addStatusIndicator();v.setOption('useIframeTransport',true);var w=v.handleResponse.bind(v),x=new p('iframe',this._form.action,w),y=x.createTransportFrame(),z=x.getRequestURI().addQueryData({__iframe:true,__user:n.user});this._form.setAttribute('action',z.toString());this._form.setAttribute('target',y.name);v.setURI(z);v.setHandler(this.success.bind(this,null));v.setErrorHandler(this.failure.bind(this,null));v.setInitialHandler(this.initial.shield(this,null));},_sendViaXHR:function(event){var v;if(this._uploadInParallel&&i.isSupported()){v=new i().setData(o.serialize(this._form)).setFiles(t(this._form));var w=[v.subscribe('progress',function(x,y){this.progress(y,y.getProgressEvent());}.bind(this)),v.subscribe('initial',function(x,y){this.initial(y,y.getResponse());}.bind(this)),v.subscribe('success',function(x,y){this.success(y,y.getResponse());}.bind(this)),v.subscribe('failure',function(x,y){this.failure(y,y.getResponse());return false;}.bind(this)),v.subscribe('complete',function(){while(w.length)w.pop().unsubscribe();})];}else v=new h().setRawData(o.createFormData(this._form)).setHandler(this.success.bind(this,null)).setErrorHandler(this.failure.bind(this,null)).setUploadProgressHandler(this.progress.bind(this,null)).setInitialHandler(this.initial.shield(this,null));v.setAllowCrossOrigin(this._allowCrossOrigin).setRelativeTo(this._form).setStatusElement(this._getStatusElement()).setURI(this._form.action).send();event.prevent();},initial:function(v){return this.inform('initial',{upload:v});},success:function(v,w){var x={response:w,upload:v};if(this.inform('success',x)!==false)Event.fire(this._form,'success',x);},failure:function(v,w){var x={response:w,upload:v};if(this.inform('failure',x)!==false)if(Event.fire(this._form,'error',x)!==false)j.defaultErrorHandler(w);},progress:function(v,event){this.inform('progress',{event:event,upload:v});},destroy:function(){this._listener.remove();this._listener=null;this._form.enctype=this._form.encoding=this._previousEncoding;l.remove(this._form,'FileForm');},_getStatusElement:function(){return q.byClass(this._form,'stat_elem')||this._form;}});e.exports=u;});
__d("Composer",["event-extensions","function-extensions","Arbiter","ArbiterMixin","Button","CSS","DOM","Env","FileForm","HTML","Input","PageTransitions","Parent","Run","ServerJS","TextAreaControl","URI","URLScraper","$","copyProperties","ge","tx"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Button'),j=b('CSS'),k=b('DOM'),l=b('Env'),m=b('FileForm'),n=b('HTML'),o=b('Input'),p=b('PageTransitions'),q=b('Parent'),r=b('Run'),s=b('ServerJS'),t=b('TextAreaControl'),u=b('URI'),v=b('URLScraper'),w=b('$'),x=b('copyProperties'),y=b('ge'),z=b('tx'),aa=1,ba=4,ca={},da=function(){var ha=k.scry(this.root,'span.linkAttachment')[0];if(!ha&&this.isMetaComposer)ha=k.scry(this.root,'span.attachmentAcceptsLink')[0];if(!ha)return;var ia=q.byTag(ha,'form');this.scraper=new v(this.input);this.scraper.subscribe('match',function(ja,ka){if(this.isMetaComposer){var la=this.form.xhpc_targetid,ma=new u('/ajax/metacomposer/attachment/link/scraper.php');ma.addQueryData({scrape_url:encodeURIComponent(ka.url),alt_scrape_url:encodeURIComponent(ka.alt_url),targetid:la.value});ia.action=ma.toString();}else{j.show(ha);ia.action='/ajax/composer/attachment/link/scraper.php?scrape_url='+encodeURIComponent(ka.url);}ia.xhpc.value=ha.id;ia.xhpc.disabled=false;ia.xhpc.click();}.bind(this));this.isMetaComposer&&this.scraper.check();},ea=function(ha){if(this.inform('submit')===false){ha.kill();return false;}if(this.submitHandler)return (new Function(this.submitHandler)).apply(this.form);};function fa(ha,ia,ja,ka,la){ca[ha.id]=this;this.root=ha;this.resetCfg=ia;this.dataSource=ka;this.lazyEndpoint=this.resetCfg&&this.resetCfg.lazyEndpoint;this.focus=k.find(ha,'div.focus_target');this.form=k.find(ha,'form.attachmentForm');this.content=k.find(ha,'div.attachmentContent');this.isMetaComposer=ja;if(this.isMetaComposer){this.messageBox=k.find(ha,'div.uiMetaComposerMessageBox');this.metaArea=k.find(ha,'div.attachmentMetaArea');this.bottomArea=k.find(ha,'div.attachmentBottomArea');this.barArea=k.find(ha,'div.attachmentBarArea');this.auxBarArea=k.find(ha,'.attachmentAuxBarArea');this.blurb=k.find(ha,'div.uiMetaComposerMessageBox div.textBlurb');this.input=k.find(ha,'div.uiMetaComposerMessageBox textarea.input');this.button=k.find(ha,'div.uiMetaComposerMessageBox label.submitBtn');this.privacy=k.find(ha,'div.uiMetaComposerMessageBox li.privacyWidget');this.boosting=k.scry(ha,'div.uiMetaComposerMessageBox li.boostingWidget');}else{this.blurb=k.find(ha,'div.uiComposerMessageBox div.textBlurb');this.input=k.find(ha,'div.uiComposerMessageBox textarea.input');this.button=k.find(ha,'div.uiComposerMessageBox label.submitBtn');this.privacy=k.find(ha,'div.uiComposerMessageBox li.privacyWidget');this.boosting=[];}Event.listen(this.form,'submit',ea.bind(this));if(this.isMetaComposer){Event.listen(this.input,'focus',this.onFocus.bind(this));if(la){if(document.activeElement===this.input)this.onFocus.bind(this).defer();}else if(q.byClass(this.input,'child_was_focused'))this.onFocus.bind(this).defer();}g.inform('xhpc/construct/'+ha.id,this,g.BEHAVIOR_STATE);}x(fa.prototype,h,{init:function(ha){this.mentionsInput=ha;if(this.mentionsInput)this.mentionsInput.subscribe('init',function(){var ia=this.mentionsInput.getTypeahead().getView();ia.subscribe(['reset','render'],function(ja){j.conditionClass(this.root,'uiComposerMention',(ja=='render'));}.bind(this));}.bind(this));da.call(this);this.inform('init',null,g.BEHAVIOR_PERSISTENT);this.setupListen();r.onBeforeUnload(this._handleUnsavedChanges.bind(this));},setupListen:function(){Event.listen(this.root,'click',this.clickHandler.bind(this));},clickHandler:function(event){var ha=event.getTarget();if(q.byClass(ha,'collapsedPostButton'))this.focusInput.bind(this).defer();},setBlurb:function(ha){k.setContent(this.blurb,ha);},setEnabled:function(ha){i.setEnabled(this.button,ha);},getEndpoint:function(){return this.form.getAttribute('action');},setEndpoint:function(ha){this.form.setAttribute('action',ha);},setLoading:function(ha){j.conditionClass(this.root,'async_saving',!!ha);},setContentVisible:function(ha){j.conditionClass(this.root,'uiComposerHideContent',!ha);},setMessageBoxVisible:function(ha){j.conditionClass(this.root,'uiComposerHideMessageBox',!ha);},setInputVisible:function(ha){j.conditionClass(this.root,'uiComposerHideInput',!ha);},setStatusBoxVisible:function(ha){j.conditionClass(this.root,'uiComposerHideStatusBox',!ha);},setTopicTaggerVisible:function(ha){j.conditionClass(this.root,'uiTagComposerHidden',!ha);},mutate:function(ha){if(this.lastComposerInput)o.setValue(this.input,o.getValue(y(this.lastComposerInput)));var ia=y(ha.xhpc);if(ia){var ja=k.scry(this.root,'.uiComposerAttachmentSelected')[0];if(ha.confirmAugmentation&&ja!==ia)return;ja&&j.removeClass(ja,'uiComposerAttachmentSelected');j.addClass(ia,'uiComposerAttachmentSelected');if(!ha.disableCache)Event.listen(ia,'click',function(la){la.stop();ha.disableCache=true;this.mutate(ha);}.bind(this));}if(!ha.keepContentAreas){this.setContentVisible(false);k.empty(this.content);if(this.isMetaComposer){this.mentionsInput&&this.mentionsInput.setAuxContent(null);k.empty(this.metaArea);k.empty(this.bottomArea);k.empty(this.barArea);k.empty(this.auxBarArea);}}if(ha.content){k.setContent(this.content,n(ha.content));this.setContentVisible(true);}if(this.isMetaComposer){ha.metaContent&&k.setContent(this.metaArea,n(ha.metaContent));ha.bottomContent&&k.setContent(this.bottomArea,n(ha.bottomContent));ha.barContent&&k.setContent(this.barArea,n(ha.barContent));ha.auxBarContent&&k.setContent(this.auxBarArea,n(ha.auxBarContent));}this.setMessageBoxVisible(!ha.messageBoxHidden);j.conditionClass(this.root,'uiComposerWhiteMessageBox',!ha.messageBoxHidden&&!ha.inputHidden&&!ha.content);this.setInputVisible(!ha.inputHidden);this.setStatusBoxVisible(!ha.statusBoxHidden);j.conditionShow(this.privacy,!ha.privacyWidgetHidden);if(this.boosting.length>0)j.conditionShow(this.boosting[0],!ha.boostingWidgetHidden);if(!ha.keepContentAreas){o.setPlaceholder(this.input,ha.placeholder);i.setLabel(this.button,ha.buttonLabel);}this.setBlurb(n(ha.blurb));if(ha.autoscrape){this.scraper&&this.scraper.enable();}else this.scraper&&this.scraper.disable();this.setEnabled(!ha.disabled);this.setTopicTaggerVisible(!ha.hideTopicTagger);this.setEndpoint(ha.endpoint);if(ha.formType==aa){this.form.setAttribute('rel','async');}else this.form.removeAttribute('rel');this.form.removeAttribute('target');if(ha.formType==ba){if(!this._fileForm){this._fileForm=new m(this.form);this._fileForm.setAllowCrossOrigin(l.allowCrossOriginComposerUpload);this._fileForm.subscribe('submit',this.setLoading.bind(this,true));this._fileForm.subscribe('failure',this.setLoading.bind(this,false));}}else if(this._fileForm){this._fileForm.destroy();this._fileForm=null;}this.submitHandler=ha.submitHandler;this.lazyEndpoint=ha.lazyEndpoint;j.addClass(this.root,'uiComposerInteracted');j.addClass(this.root,'uiComposerOpen');if(ha.messageBoxFocused){var ka=document.activeElement;if(ka===document.body||q.byClass(ka,'attachmentLink'))this.focusInput.bind(this).defer();}if(ha.inputElement){o.setValue(y(ha.inputElement),o.getValue(this.input));t.getInstance(y(ha.inputElement)).update();}else t.getInstance(this.input).update();this.lastComposerInput=ha.inputElement;g.inform('composer/mutate',this);},subscribeToMutate:function(ha){return g.subscribe('composer/mutate',function(ia,ja){if(ja===this)ha();}.bind(this));},unsubscribeFromMutate:function(ha){ha.unsubscribe();},reset:function(ha){if(this.isMetaComposer){k.empty(this.metaArea);k.empty(this.bottomArea);k.empty(this.barArea);k.empty(this.auxBarArea);}if(this.resetCfg){this.mutate(this.resetCfg);}else{var ia=k.scry(this.root,'.uiComposerAttachmentSelected')[0];if(ia)j.removeClass(ia,'uiComposerAttachmentSelected');}if(!ha){o.reset(this.input);this.mentionsInput&&this.mentionsInput.reset();this.scraper&&this.scraper.reset();}j.removeClass(this.root,'uiComposerInteracted');j.setClass(this.focus,'focus_target');this.setLoading(false);g.inform('composer/reset');},onFocus:function(){if(this.lazyEndpoint){var ha=k.find(this.root,'form.attachmentSelectForm'),ia=new u(this.lazyEndpoint);ia.addQueryData({isAugmentation:true});ha.action=ia.toString();var ja=k.scry(this.root,'.uiComposerAttachmentSelected')[0];ha.xhpc.value=ja&&ja.id;ha.xhpc.click();j.removeClass.curry(this.root,'async_saving').defer();}this.inform('focus');},focusInput:function(){o.focus(this.input);},getInput:function(){return this.input;},updateDataSourceToken:function(ha){if(this.dataSource)this.dataSource.updateToken(ha);},_handleUnsavedChanges:function(){var ha=p.getNextURI();if(ha.getQueryData().hasOwnProperty('theater'))return;if(this.input.offsetParent!==null&&!o.isEmpty(this.input)&&!(a.Dialog&&a.Dialog.getCurrent()))return "You haven't finished your post yet. Do you want to leave without finishing?";}});var ga;x(fa,{setNodeToConfigure:function(ha){ga=ha;},configure:function(ha,ia,ja){var ka=q.byClass(ga,'uiComposer').id,la=g.subscribe('xhpc/construct/'+ka,function(ma,na){(function(){la.unsubscribe();}).defer();na.mutate(ha);na.subscribe('init',function(){new s().handle(ia);new Function(ja)();if(ha.attachmentJS)new Function(ha.attachmentJS).call(na);});});},publish:function(ha,ia){ia=ia||{};ia.composer_id=ha;ia.composer=fa.getInstance(ha);ia.composer&&ia.composer.reset(false);if(ia.streamNode){ia.streamStory=ia.streamNode;}else if(ia.streamMarkup)ia.streamStory=n(ia.streamMarkup).getRootNode();g.inform('composer/publish',ia);},finish:function(ha){fa.getInstance(ha).setLoading(false);},getInstance:function(ha){var ia=q.byClass(w(ha),'uiComposer');return ia?ca[ia.id]:null;}});e.exports=fa;});
__d("legacy:Composer",["Composer"],function(a,b,c,d){a.Composer=b('Composer');},3);
function MetaComposerMessageBox(){}copyProperties(MetaComposerMessageBox.prototype,{init:function(a,b){this.inputContainer=DOM.scry(a,'div.inputContainer')[0];this.textInput=DOM.scry(a,'textarea.mentionsTextarea')[0];this.metaArea=DOM.scry(a,'div.attachmentMetaArea')[0];this.bottomArea=DOM.scry(a,'div.attachmentBottomArea')[0];this.barArea=DOM.scry(a,'div.attachmentBarArea')[0];Event.listen(this.inputContainer,'click',function(c){var d=c.getTarget();if(!DOM.contains(this.metaArea,d)&&d!==this.textInput)this.textInput.focus();}.bind(this));}});
__d("legacy:ScrollAwareDOM",["ScrollAwareDOM"],function(a,b,c,d){a.ScrollAwareDOM=b('ScrollAwareDOM');},3);
__d("RequiredFormListener",["event-extensions","Input"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Input');Event.listen(document.documentElement,'submit',function(h){var i=h.getTarget().getElementsByTagName('*');for(var j=0;j<i.length;j++)if(i[j].getAttribute('required')&&g.isEmpty(i[j])){i[j].focus();return false;}},Event.Priority.URGENT);});
__d("ScrollableTypeaheadBehavior",["DOM","CSS","Style","Parent","cx","ScrollableArea","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('CSS'),i=b('Style'),j=b('Parent'),k=b('cx'),l=b('ScrollableArea'),m=b('copyProperties');function n(o){this._typeahead=o;}m(n.prototype,{_subscriptions:null,_scrollableElems:null,_scrollableArea:null,_showScrollbar:null,enable:function(){this._scrollableElems=(l.renderDOM());h.addClass(this._scrollableElems.root,"_ml");g.appendContent(this._typeahead.getView().element,this._scrollableElems.root);this._typeahead.getView().content=this._scrollableElems.content;this._scrollableArea=(l.fromNative(this._scrollableElems.root,{fade:false}));this._subscriptions=[this._typeahead.getView().subscribe('reset',this._reset.bind(this)),this._typeahead.getView().subscribe('render',this._render.bind(this)),this._typeahead.getView().subscribe('beforeRender',this._beforeRender.bind(this)),this._typeahead.getView().subscribe('next',this._scrollHelper.bind(this)),this._typeahead.getView().subscribe('prev',this._scrollHelper.bind(this))];i.set(this._scrollableElems.wrap,'height','0px');h.removeClass(this._scrollableElems.root,"_mm");},disable:function(){while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();this._subscriptions=null;},_reset:function(){i.set(this._scrollableElems.wrap,'height','0px');h.removeClass(this._scrollableElems.root,"_mm");this._scrollableArea.scrollToTop();},_render:function(){this._scrollableArea.poke();this._showScrollbar?this._scrollableArea.showScrollbar(false):this._scrollableArea.hideScrollbar(true);h.addClass(this._scrollableElems.root,"_mm");},_beforeRender:function(o,p){var q=5;if(this._typeahead.getView().maxResults<10)q=3;i.set(this._scrollableElems.body,'width',this._scrollableElems.wrap.offsetWidth+'px');if(p.results.length<q){i.set(this._scrollableElems.wrap,'height',(38*p.results.length+4)+'px');this._showScrollbar=false;}else{this._scrollableArea.showScrollbar(false);i.set(this._scrollableElems.wrap,'height',(38*q+4)+'px');this._showScrollbar=true;}},_scrollHelper:function(o,p){if(!j.byClass(p,'uiScrollableArea'))return;this._typeahead.getView().ignoreMouseover=true;var q=j.byClass(p,'uiScrollableAreaWrap'),r=p.offsetTop-q.offsetTop;if(r<q.scrollTop){q.scrollTop=r;return;}var s=r+p.offsetHeight;if(s>q.scrollTop+q.offsetHeight)q.scrollTop=s-q.offsetHeight;}});e.exports=n;});
__d("legacy:LegacyScrollableTypeaheadBehavior",["ScrollableTypeaheadBehavior"],function(a,b,c,d){var e=b('ScrollableTypeaheadBehavior');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.scrollArea=function(f){f.enableBehavior(e);};},3);
__d("Popover",["event-extensions","Arbiter","ArbiterMixin","Class","ContextualLayer","ContextualLayerHideOnScroll","CSS","DataStore","DOM","Input","KeyStatus","LayerHideOnEscape","Toggler","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('ContextualLayer'),k=b('ContextualLayerHideOnScroll'),l=b('CSS'),m=b('DataStore'),n=b('DOM'),o=b('Input'),p=b('KeyStatus'),q=b('LayerHideOnEscape'),r=b('Toggler'),s=b('copyProperties');r.subscribe(['show','hide'],function(u,v){var w=m.get(v.getActive(),'Popover');if(w)if(u==='show'){w.showLayer();}else w.hideLayer();});function t(u,v,w,x){this._root=u;this._triggerElem=v;this._behaviors=w;this._config=x;if(!(v.nodeName==='A'&&v.rel==='toggle'))Event.listen(v,'click',function(){r.bootstrap(v);});m.set(u,'Popover',this);}s(t.prototype,h,{_layer:null,_closeListener:null,ensureInit:function(){if(!this._layer)this._init();},showLayer:function(){this.ensureInit();this._layer.show();r.show(this._root);l.addClass(this._root,'selected');this.inform('show');this._triggerElem.setAttribute('aria-expanded','true');},hideLayer:function(){this._layer.hide();this._triggerElem.setAttribute('aria-expanded','false');},isShown:function(){return this._layer.isShown();},setLayerContent:function(u){this.ensureInit();this._layer.setContent(u);},_init:function(){var u=new j({context:this._triggerElem,position:'below'},n.create('div'));u.enableBehaviors([k,q]);r.createInstance(u.getRoot()).setSticky(false);u.subscribe('hide',this._onLayerHide.bind(this));this._behaviors&&u.enableBehaviors(this._behaviors);this._layer=u;if(this._config.alignh)this._layer.setAlignment(this._config.alignh);if(this._config.layer_content)this._layer.setContent(this._config.layer_content);this.inform('init',null,g.BEHAVIOR_PERSISTENT);},_onLayerHide:function(){r.hide(this._root);l.removeClass(this._root,'selected');this.inform('hide');if(p.isKeyDown())o.focus(this._triggerElem);}});e.exports=t;});
__d("PopoverMenuInterface",["Arbiter","ArbiterMixin","Class","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('copyProperties');function k(){}j(k.prototype,h,{getRoot:bagofholding,onShow:bagofholding,onHide:bagofholding,focusAnItem:bagof(false),blur:bagofholding,handleKeydown:bagof(false),done:function(){this.inform('done');}});e.exports=k;});
__d("PopoverAsyncMenuLoading",["Class","copyProperties","DOM","PopoverMenuInterface"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('DOM'),j=b('PopoverMenuInterface');function k(l){this.parent.construct(this);this._className=l||'';}g.extend(k,j);h(k.prototype,{_root:null,getRoot:function(){if(!this._root)this._root=i.create('div',{className:this._className},i.create('div',{className:'uiMenuXBorder'},i.create('div',{className:'uiMenuX uiMenuXLoading'},i.create('span',{className:'spinner'}))));return this._root;}});e.exports=k;});
__d("PopoverMenu",["event-extensions","Arbiter","ArbiterMixin","ARIA","BehaviorsMixin","Class","Input","Keys","KeyStatus","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ARIA'),j=b('BehaviorsMixin'),k=b('Class'),l=b('Input'),m=b('Keys'),n=b('KeyStatus'),o=b('copyProperties');function p(q,r,s,t){this._popover=q;this._triggerElem=r;this._initialMenu=s;q.subscribe('init',this._onLayerInit.bind(this));q.subscribe('show',this._onPopoverShow.bind(this));q.subscribe('hide',this._onPopoverHide.bind(this));t&&this.enableBehaviors(t);}o(p.prototype,h,j);o(p.prototype,{_keydownListener:null,_popoverShown:false,setMenu:function(q){this._menu=q;var r=q.getRoot();this._popover.setLayerContent(r);q.subscribe('done',this._onMenuDone.bind(this));if(this._popoverShown)this._menu.onShow();i.owns(this._triggerElem,r);this.inform('setMenu',null,g.BEHAVIOR_PERSISTENT);},getPopover:function(){return this._popover;},getTriggerElem:function(){return this._triggerElem;},getMenu:function(){return this._menu;},_onLayerInit:function(){this.setMenu(this._initialMenu);},_onPopoverShow:function(){if(this._menu){this._menu.onShow();if(n.isKeyDown())this._menu.focusAnItem();this._keydownListener=Event.listen(document.documentElement,'keydown',this._handleKeydown.bind(this));}this._popoverShown=true;},_onPopoverHide:function(){if(this._menu)this._menu.onHide();if(this._keydownListener){this._keydownListener.remove();this._keydownListener=null;}this._popoverShown=false;},_handleKeydown:function(q){if(q.getModifiers().any)return;var r=Event.getKeyCode(q);switch(r){case m.RETURN:return;case m.UP:case m.DOWN:this._menu.handleKeydown(r);break;default:if(this._menu.handleKeydown(r)===false){this._menu.blur();this._menu.handleKeydown(r);}break;}q.prevent();},_onMenuDone:function(q){this._popover.hideLayer.bind(this._popover).defer();if(n.isKeyDown())l.focus(this._triggerElem);}});e.exports=p;});
__d("PopoverAsyncMenu",["event-extensions","AsyncRequest","Class","CSS","DOM","PopoverAsyncMenuLoading","PopoverMenu","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('Class'),i=b('CSS'),j=b('DOM'),k=b('PopoverAsyncMenuLoading'),l=b('PopoverMenu'),m=b('copyProperties'),n={},o=0;function p(q,r,s,t,u){this._endpoint=t;this._loadingMenu=s;this._instanceId=o++;n[this._instanceId]=this;this._mouseoverListener=Event.listen(r,'mouseover',this._fetchMenu.bind(this));this.parent.construct(this,q,r,null,u);}p.setMenu=function(q,r){n[q].setMenu(r);};h.extend(p,l);m(p.prototype,{_fetched:false,_mouseoverListener:null,_onLayerInit:function(){if(!this._menu)this.setMenu(this._loadingMenu);this._fetchMenu();},_fetchMenu:function(){if(this._fetched)return;new g().setURI(this._endpoint).setData({pmid:this._instanceId}).send();this._fetched=true;if(this._mouseoverListener){this._mouseoverListener.remove();this._mouseoverListener=null;}}});e.exports=p;});
__d("PopoverMenuOverlappingBorder",["function-extensions","CSS","DOM","Style","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('copyProperties');function k(l){this._popoverMenu=l;this._popover=l.getPopover();this._triggerElem=l.getTriggerElem();}j(k.prototype,{_shortBorder:null,_setMenuSubscription:null,_showSubscription:null,_menuSubscription:null,enable:function(){this._setMenuSubscription=this._popoverMenu.subscribe('setMenu',this._onSetMenu.bind(this));},disable:function(){this._popoverMenu.unsubscribe(this._setMenuSubscription);this._setMenuSubscription=null;this._removeBorderSubscriptions();this._removeShortBorder();},_onSetMenu:function(){this._removeBorderSubscriptions();this._menu=this._popoverMenu.getMenu();this._renderShortBorder(this._menu.getRoot());this._showSubscription=this._popover.subscribe('show',this._updateBorder.bind(this));this._menuSubscription=this._menu.subscribe(['change','resize'],Function.prototype.defer.shield(this._updateBorder.bind(this)));this._updateBorder();},_updateBorder:function(){var l=this._menu.getRoot(),m=this._triggerElem.offsetWidth;i.set(l,'min-width',m+'px');var n=Math.max(l.offsetWidth-m,0);i.set(this._shortBorder,'width',n+'px');},_renderShortBorder:function(l){this._shortBorder=h.create('div',{className:'uiMenuXShortBorder'});h.appendContent(l,this._shortBorder);g.addClass(l,'uiMenuXWithShortBorder');},_removeShortBorder:function(){if(this._shortBorder){h.remove(this._shortBorder);this._shortBorder=null;g.removeClass(this._popoverMenu.getMenu().getRoot(),'uiMenuXShortBorder');}},_removeBorderSubscriptions:function(){if(this._showSubscription){this._popover.unsubscribe(this._showSubscription);this._showSubscription=null;}if(this._menuSubscription){this._menu.unsubscribe(this._menuSubscription);this._menuSubscription=null;}}});e.exports=k;});
var StreamShareVideo={_endpoints:[],_thumbs:[],registerThumb:function(a,b,c,d){StreamShareVideo._endpoints[a+' '+c]=d;StreamShareVideo._thumbs[a+' '+c]=b;},clickTitle:function(a,b,event){this.expandInlineOrRedirect(a,b,event);},expandInlineOrRedirect:function(a,b,event){if(StreamShareVideo._shouldFollowHref(event))return true;var c=StreamShareVideo._thumbs[a+' '+b],d=ge(c);if(d){CSS.addClass(d,"uiVideoThumbLoading");AsyncRequest.bootstrap(StreamShareVideo._endpoints[a+' '+b],d.parentElement);return false;}return true;},clickTimeline:function(a,b,event){if(StreamShareVideo._shouldFollowHref(event))return true;CSS.addClass(a,"_1xu");CSS.removeClass(a,"_1xv");AsyncRequest.bootstrap(b,a);return false;},_shouldFollowHref:function(event){event=$E(event);if(!event)return false;if(event.getModifiers().any||event.isMiddleClick())return true;return false;}};
__d("MentionsInputMatchers",[],function(a,b,c,d,e,f){var g=['@','\\uff20','+','\\uff0b'].join(''),h='.,*?$|#{}()\\^\\-\\[\\]\\\\\/!%&\'"~=<>_:;',i='\\b[A-Z][^ A-Z'+h+']',j='([^'+g+h+']|['+h+'][^ '+h+'])',k='(?:^|\\s)(?:['+g+']('+j+'{0,20}))',l='(?:(?:'+i+'+)|'+k+')',m='(?:'+i+'{4,})',n={trigger:new RegExp('['+g+']$'),mainMatcher:new RegExp(k+'$'),autoMatcher:new RegExp(l+'$'),userMatcher:new RegExp(m+'$')};e.exports=n;});
__d("MentionsInput",["event-extensions","function-extensions","Arbiter","ArbiterMixin","Class","CSS","DataStore","DOM","HTML","Input","InputSelection","Parent","htmlize","Style","Typeahead","TypeaheadUtil","UserAgent","copyProperties","MentionsInputMatchers"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('HTML'),n=b('Input'),o=b('InputSelection'),p=b('Parent'),q=b('htmlize'),r=b('Style'),s=b('Typeahead'),t=b('TypeaheadUtil'),u=b('UserAgent'),v=b('copyProperties'),w=b('MentionsInputMatchers');function x(y,z,aa,ba,ca,da){k.set(y,'MentionsInput',this);this._root=y;this._typeahead=z;this._input=aa;var ea=false;try{ea=document.activeElement===this._input;}catch(fa){}if(ea){this.init.bind(this,ba,ca,da).defer();}else var ga=Event.listen(this._input,'focus',function(){this.init.bind(this,ba,ca,da).defer();ga.remove();}.bind(this));}x.getInstance=function(y){var z=p.byClass(y,'uiMentionsInput');return z?k.get(z,'MentionsInput'):null;};v(x.prototype,h,{init:function(y,z,aa){this.init=Function.prototype;this._initialized=true;this._highlighter=l.find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=l.find(this._root,'.highlighterContent');this._hiddenInput=l.find(this._root,'.mentionsHidden');this._placeholder=this._input.getAttribute('placeholder')||'';this._maxMentions=y.max||6;this._metrics=aa;if(u.firefox()<4){this._input.blur();setTimeout(function(){this._input.focus();}.bind(this));}if(!this._hiddenInput.name){var ba=this._input.name;this._input.name=ba+'_text';this._hiddenInput.name=ba;}this._initEvents();this._initTypeahead();this.reset(z);this.inform('init',null,g.BEHAVIOR_STATE);},reset:function(y){if(!this._initialized)return;this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._hiddenInput&&(this._hiddenInput.value='');this._highlighterContent&&l.empty(this._highlighterContent);this._highlighterAuxContent&&l.remove(this._highlighterAuxContent);this._highlighterAuxContent=null;n.setPlaceholder(this._input,this._placeholder);r.set(this._typeahead.getElement(),'height','auto');if(y){n.setValue(this._input,y.flattened);for(var z in y.mention_data)this._addToken({uid:z,text:y.mention_data[z],type:'unknown'});}this._updateTypeahead();this._updateWidth();this._update();},getValue:function(){return n.getValue(this._input);},getRawValue:function(){this._update();return n.getValue(this._hiddenInput);},checkValue:function(){var y=this._typeahead.getCore().getValue();if(w.trigger.exec(y)||y==='')this.inform('sessionEnd',{});},getTypeahead:function(){return this._typeahead;},_initEvents:function(){var y=this._update.bind(this);Event.listen(this._input,{input:y,keyup:y,change:y,blur:this._handleBlur.bind(this),focus:this._handleFocus.bind(this)});if(this._metrics){this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);Event.listen(this._input,'keyup',function(event){this.checkValue.bind(this).defer();}.bind(this));}},_initTypeahead:function(){this._typeahead.subscribe('select',function(ca,da){var ea=da.selected;this._addToken({uid:ea.uid,text:ea.text,type:ea.type});this.updateValue();}.bind(this));var y=this._input,z=null,aa=function(){if(z===null){z=n.getSubmitOnEnter(y);n.setSubmitOnEnter(y,false);}},ba=function(){if(z!==null){n.setSubmitOnEnter(y,z);z=null;}};this._typeahead.subscribe('render',aa);this._typeahead.subscribe('reset',ba);this._typeahead.subscribe('highlight',function(ca,da){da.index>=0?aa():ba();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));this._typeahead.getCore().suffix='';this._handleFocus();},_handleBlur:function(){if(this._filterToken){this._filterToken.remove();this._filterToken=null;}},_handleFocus:function(){if(!this._filterToken)this._filterToken=this._typeahead.getData().addFilter(this._filterResults.bind(this));this._updateWidth();},_filterResults:function(y){if(this._filterData===null){var z=o.get(this._input).start||0;for(var aa=0;aa<this._offsets.length;aa++){var ba=this._offsets[aa];if(z>ba[0]&&z<=ba[1]){this._filterData={caretIsInsideMention:true};return false;}}var ca=this._typeahead.getCore();this._filterData={value:ca.getValue(),rawValue:ca.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(w.mainMatcher.test(this._filterData.rawValue))return true;if(y.type!='user')return false;if(w.userMatcher.test(this._filterData.value))return true;return t.isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(y));},_addToken:function(y){var z=y.uid;if(!this._mentioned.hasOwnProperty(z)){this._mentioned[z]=y;this._orderedUIDs.push(z);this._numMentioned++;this._updateTypeahead();}},_removeToken:function(y){if(this._mentioned.hasOwnProperty(y)){delete this._mentioned[y];this._orderedUIDs.remove(y);this._numMentioned--;this._updateTypeahead();}},_reduceToken:function(y,z){var aa=z.split(' '),ba=[];for(var ca=0;ca<aa.length;ca++)if(y.indexOf(aa[ca])!=-1)ba.push(aa[ca]);aa=ba;for(ca=1;ca<aa.length;ca++)for(var da=1;da<aa[ca-1].length+1;da++)if(y.indexOf(aa[ca-1].substr(0,da)+aa[ca])!=-1)aa.splice(ca-1,1);while(y.indexOf(aa.join(' '))==-1)aa.splice(0,1);return aa.join(' ');},_update:function(){var y=this.getValue();if(y==this._value)return;this._updateTokens();this.updateValue();this._updateDirection();},_updateTokens:function(){var y=this.getValue(),z=false;for(var aa=0;aa<this._orderedUIDs.length;++aa){var ba=this._orderedUIDs[aa],ca=this._mentioned[ba],da=ca.text,ea;if(ca.type=='user'&&(ea=this._reduceToken(y,da))!==''){if(ea==da.substring(0,da.lastIndexOf(' '))&&y==this._value.substring(0,this._value.length-1)){y=y.substring(0,y.lastIndexOf(' '));z=true;}ca.text=ea;}else if(!da||y.indexOf(da)==-1||typeof da!=='string')this._removeToken(ba);}this._value=y;if(z)n.setValue(this._input,y);},updateValue:function(){var y=this.getValue(),z=this._orderedUIDs,aa=[],ba,ca,da,ea;for(ea=0;ea<z.length;++ea){ca=this._mentioned[z[ea]].text;y=y.replace(ca,function(fa,ga){aa.push([ga,ga+ca.length]);return ca;});}for(ea=0;ea<z.length;++ea){da=z[ea];ca=this._mentioned[da].text;y=y.replace(ca,'@['+da+':]');}ba=q(y);for(ea=0;ea<z.length;++ea){da=z[ea];ca=this._mentioned[da].text;ba=ba.replace('@['+da+':]','<b>'+q(ca)+'</b>');ca=ca.replace(/[\\\]:]/g,function(fa){return '\\'+fa;});y=y.replace('@['+da+':]','@['+da+':'+ca+']');}if(u.ie()){ba=ba.replace(/ {2}/g,'&nbsp;<wbr />&nbsp;<wbr />');ba=ba.replace(/ (?=[^\/]|\/[^>])/g,'&nbsp;<wbr />');}this._offsets=aa;this._hiddenInput.value=y;l.setContent(this._highlighterContent,m(ba));this._updateHighlighter();this._updateHeight();},_updateDirection:function(){var y=r.get(this._input,'direction');if(y==this._dir)return;this._dir=y;r.set(this._highlighter,'direction',y);if(y=='rtl'){r.set(this._highlighter,'text-align','right');}else r.set(this._highlighter,'text-align','left');},_updateWidth:function(){var y=r.getFloat.curry(this._input),z=this._input.offsetWidth-y('paddingLeft')-y('paddingRight')-y('borderLeftWidth')-y('borderRightWidth');if(u.firefox())z-=2;if(u.ie()<=7){z-=r.getFloat(this._highlighterInner,'paddingLeft');this._highlighter.style.zoom=1;}this._highlighterInner.style.width=Math.max(z,0)+'px';},_updateHeight:function(){if(this._highlighterAuxContent){var y=this._highlighter.offsetHeight,z=this._typeahead.getElement();if(y>z.offsetHeight){r.set(z,'height',y+'px');g.inform('reflow');}}},_updateTypeahead:function(){var y=this._typeahead.getCore(),z=null;if(!this._maxMentions||this._numMentioned<this._maxMentions)z=w.autoMatcher;y.matcher=z;y.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});},setPlaceholder:function(y){this._placeholder=y;if(!this.hasAuxContent())n.setPlaceholder(this._input,y);},_updateHighlighter:function(){if(this._highlighterContent)j.conditionShow(this._highlighterContent,this._numMentioned>0||this.hasAuxContent());},setAuxContent:function(y){if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=l.create('span',{className:'highlighterAuxContent'});l.insertAfter(this._highlighterContent,this._highlighterAuxContent);}l.setContent(this._highlighterAuxContent,y);if(y){n.setPlaceholder(this._input,'');}else n.setPlaceholder(this._input,this._placeholder);this._updateHighlighter();this._updateHeight();}},hasAuxContent:function(){var y=this.getAuxContentRoot();return y&&y.innerHTML.length>0;},getAuxContentRoot:function(){return this._highlighterAuxContent;},addMention:function(y){var z=this.getValue();n.setValue(this._input,z+" "+y.text);this._addToken(y);this._update();},getMentions:function(){return this._mentioned;}});e.exports=x;});
__d("OptimisticUFI",["event-extensions","Arbiter","AsyncRequest","AsyncResponse","CommentPrelude","CSS","DOM","Form","HTML","Input","MentionsInput","Parent","htmlize","XHPTemplate","randomInt"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AsyncResponse'),j=b('CommentPrelude'),k=b('CSS'),l=b('DOM'),m=b('Form'),n=b('HTML'),o=b('Input'),p=b('MentionsInput'),q=b('Parent'),r=b('htmlize'),s=b('XHPTemplate'),t=b('randomInt'),u={_commentSeqNo:0,init:function(v){this._commentTemplate=v;if(!this._loaded){Event.listen(document.documentElement,'click',this._clickHandler.bind(this),Event.Priority.URGENT);this._loaded=true;}},_clickHandler:function(event){var v=event.getTarget(),w=v.name=='comment'&&v.parentNode&&q.byClass(v,'optimistic_submit');if(!w)return true;var x=v.form,y=l.scry(x,'textarea')[0];if(o.isEmpty(y))return true;j.uncollapse(x);var z,aa,ba=l.scry(v,'^.commentList li.uiUfiAddComment')[0];if(!ba){z=this._commentTemplate.render();aa=s.getNode(z,'text');l.setContent(aa,n(r(y.value.trim())));}var ca=l.scry(x,'ul.commentList')[0];if(!ca)return true;var da;if(ba){da=ba.previousSibling;k.show(da);k.hide(ba);}else{k.show(ca.parentNode);ca.appendChild(z);da=ca.lastChild;}var ea=t(0,4294967295);da.id='optimistic_comment_'+ea+'_'+this._commentSeqNo++;var fa=m.serialize(x);fa.comment_replace=da.id;fa.comment=1;function ga(){new h(m.getAttribute(x,'action')).setData(fa).setRelativeTo(x).setErrorHandler(function(ia){k.addClass(da,'uiUfiCommentFailed');i.defaultErrorHandler(ia);}).setServerDialogCancelHandler(function(){l.remove(da);}).send();}if(!ba)Event.listen(s.getNode(z,'retry_link'),'click',ga);ga();y.value=y.style.height='';y.focus();var ha=p.getInstance(y);ha&&ha.reset();if(ba){l.remove(ba);}else g.inform('ufi/comment',{form:x});return false;}};e.exports=u;});
__d("UFIUpdate",["CommentPrelude","CSS","DOM","DOMQuery","HTML","MentionsInput","Parent","ScrollableArea","ScrollAwareDOM"],function(a,b,c,d,e,f){var g=b('CommentPrelude'),h=b('CSS'),i=b('DOM'),j=b('DOMQuery'),k=b('HTML'),l=b('MentionsInput'),m=b('Parent'),n=b('ScrollableArea'),o=b('ScrollAwareDOM'),p={expandFeedback:function(q,r,s){i.scry(q,r).forEach(function(t){g.expand(t,s);});},uncollapseFeedback:function(q){g.uncollapse(m.byTag(i.find(q,'.fbUfi'),'form'));},multiContentReplaceGlobal:function(q,r){this.multiContentReplace(document.documentElement,q,r);},multiContentReplace:function(q,r,s){s=s instanceof k?s.getRootNode():s;i.scry(q,r).forEach(function(t){o.replace(t,s.cloneNode(true));});},refocusCommentBox:function(q,r){var s=i.find(q,'textarea');s.value=s.style.height="";if(r){s.blur();s.focus.defer();}else document.documentElement.onfocusin({target:s});},resetMentionsInput:function(q){var r=l.getInstance(i.find(q,'div.uiMentionsInput'));r&&r.reset();},insertAtBottom:function(q,r,s,t){var u=i.scry(q,'.comment_'+s).length;if(r)u+=i.scry(q,'#'+r).length;if(!u){var v=i.find(q,'.commentList'),w=n.getInstance(v),x=w&&w.isScrolledToBottom();o.appendContent(v,t);x&&w.scrollToBottom(false);}},updateUnsubscribeLink:function(q,r){var s=i.scry(q,'.unsub_link')[0];if(s){i.replace(s,r);}else if(r)i.insertAfter(i.find(q,'.comment_link'),[" \xB7 ",r]);},updateSeenCount:function(q){j.scry(q,'.uiUfiSeenBar').forEach(function(t){h.hide(t);});j.scry(q,'.uiUfiViewSeenCount').forEach(function(t){h.hide(t);});var r=j.scry(q,'.uiUfiLike')[0];if(r&&r.childNodes.length===0)r=null;r=r||j.scry(q,'.uiUfiSeenBar')[0];if(!r)return;var s=j.scry(r,'.uiUfiViewSeenCount')[0];if(!s)return;h.show(s);h.show(r);}};e.exports=p;});
__d("legacy:MentionsInput",["MentionsInput"],function(a,b,c,d){a.MentionsInput=b('MentionsInput');},3);
__d("TypeaheadAreaCore",["Class","InputSelection","TypeaheadCore","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('InputSelection'),i=b('TypeaheadCore'),j=b('copyProperties');function k(l){this.parent.construct(this,l);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}g.extend(k,i);j(k.prototype,{prefix:'',suffix:', ',matcher:"\\b[^,]*",click:bagofholding,select:function(l){this.parent.select(l);var m=this.element.value,n=this.prefix+l.text+this.suffix;this.expandBounds(m,n);var o=m.substring(0,this.start),p=m.substring(this.end);this.element.value=o+n+p;h.set(this.element,o.length+n.length);},expandBounds:function(l,m){l=l.toLowerCase().trim();m=m.toLowerCase();var n,o,p,q,r=/\s/;o=l.substring(this.start,this.end);p=m.indexOf(o);n=this.start;while(n>=0&&p>=0){q=l.charAt(n-1);if(!q||r.test(q))this.start=n;o=q+o;p=m.indexOf(o);n--;}o=l.substring(this.start,this.end);p=m.indexOf(o);n=this.end;while(n<=l.length&&p>=0){q=l.charAt(n);if(!q||r.test(q))this.end=n;o=o+q;p=m.indexOf(o);n++;}},getRawValue:function(){var l=h.get(this.element).start||0;return this.parent.getValue().substring(0,l);},getValue:function(){var l=this.matcher&&this.matcher.exec(this.getRawValue());if(!l)return '';var m=l[0],n=l.index+m.length;m=m.replace(/^\s/,'');var o=m.length;m=m.replace(/\s$/,'');var p=o-m.length;this.start=n-o;this.end=n+p;return l[1]||l[0];}});e.exports=k;});
__d("TypeaheadMetrics",["event-extensions","AsyncRequest","copyProperties","Typeahead"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('copyProperties'),i=b('Typeahead');function j(k){this.extraData={};h(this,k);}h(j.prototype,{endPoint:'/ajax/typeahead/record_basic_metrics.php',init:function(k){this.init=bagofholding;this.core=k.getCore();this.view=k.getView();this.data=k.getData();this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();},_reset:function(){this.stats={};this.avgStats={};this.sessionActive=false;this.sid=Math.floor(Date.now()*Math.random());this.data.setQueryData({sid:this.sid});},recordSelect:function(k){var l=k.selected;if(l.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',l.uid);this.recordStat('selected_type',l.type);this.recordStat('selected_position',k.index);this.recordStat('selected_with_mouse',k.clicked?1:0);this._sessionEnd();},bindSessionStart:function(k,event,l){if(l)for(var m=0;m<this._sessionStartEvents.length;++m){var n=this._sessionStartEvents[m];n.obj.unsubscribe(n.token);}this._sessionStartEvents.push({obj:k,token:k.subscribe(event,function(o,p){this._sessionStart();}.bind(this))});},bindSessionEnd:function(k,event,l){if(l)for(var m=0;m<this._sessionEndEvents.length;++m){var n=this._sessionEndEvents[m];n.obj.unsubscribe(n.token);}this._sessionEndEvents.push({obj:k,token:k.subscribe(event,function(o,p){this._sessionEnd();}.bind(this))});},initEvents:function(){this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(k,l){this.recordSelect(l);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(k,l){this.results=l;}.bind(this));this.data.subscribe('beforeQuery',function(k,l){if(!l.value)return;this.query=l.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('beforeFetch',function(k,l){if(l.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else l.fetch_context.queryBegin=Date.now();}.bind(this));this.data.subscribe('fetchComplete',function(k,l){if(l.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);var m={};l.response.payload.entries.forEach(function(n){if(!m[n.type]){m[n.type]=1;}else m[n.type]++;});this.recordStat('bootstrap_response_types',m);this.bootstrapped=true;}else this.recordAvgStat('avg_query_latency',Date.now()-l.fetch_context.queryBegin);}.bind(this));this.data.subscribe('dirty',function(k,l){this.bootstrapped=false;});},_sessionStart:function(){if(this.sessionActive)return;this.sessionActive=true;},_sessionEnd:function(){if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();},recordStat:function(k,l){this.stats[k]=l;},recordCountStat:function(k){var l=this.stats[k];this.stats[k]=l?l+1:1;},recordAvgStat:function(k,l){if(this.avgStats[k]){this.avgStats[k][0]+=l;++this.avgStats[k][1];}else this.avgStats[k]=[l,1];},submit:function(){if(Object.keys(this.stats).length){h(this.stats,this.extraData);if(this.results){var k=(this.results).map(function(n,o){return n.uid;});this.recordStat('candidate_results',JSON.stringify(k));}if(this.query)this.recordStat('query',this.query);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var l in this.avgStats){var m=this.avgStats[l];this.stats[l]=m[0]/m[1];}new g().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).send();this._reset();}}});j.register=function(k,l,m){if(document.activeElement===k){l.init(m);}else var n=Event.listen(k,'focus',function(){l.init(m);n.remove();});};e.exports=j;});
__d("TypeaheadHoistFriends",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._typeahead=i;}g(h.prototype,{_subscription:null,enable:function(){var i=this._typeahead.getView();this._subscription=i.subscribe('beforeRender',function(j,k){var l=[],m=[];for(var n=0;n<k.results.length;++n){var o=k.results[n];if(o.type=='user'&&o.bootstrapped){m.push(o);}else l.push(o);}k.results=m.concat(l);});},disable:function(){this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;}});e.exports=h;});
__d("legacy:HoistFriendsTypeaheadBehavior",["TypeaheadHoistFriends"],function(a,b,c,d){var e=b('TypeaheadHoistFriends');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.hoistFriends=function(f){f.enableBehavior(e);};},3);
__d("legacy:UIControllerRegistry",[],function(a,b,c,d){a.__UIControllerRegistry=a.__UIControllerRegistry||{};},3);
__d("MenuX",["event-extensions","Class","copyProperties","CSS","DataStore","DOM","HTML","Keys","Parent","PopoverMenuInterface","ScrollableArea","Style","UserAgent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('HTML'),m=b('Keys'),n=b('Parent'),o=b('PopoverMenuInterface'),p=b('ScrollableArea'),q=b('Style'),r=b('UserAgent');function s(t,u,v,w){this.parent.construct(this);this._id=t;this._className=u;this._items=[];for(var x=0;x<v.length;x++)this._items[x]=new v[x].ctor(v[x]);this._config=w;}g.extend(s,o);h(s.prototype,{_focused:null,_root:null,addItem:function(t){this._items.push(t);if(this._root)this._insertItem(t);},getRoot:function(){if(!this._root)this._render();return this._root;},onShow:function(){if(this._config.maxheight)if(!this._scrollableArea){q.set(this._scrollableElems.root,'width',this._scrollableElems.body.offsetWidth+'px');this._scrollableArea=p.fromNative(this._scrollableElems.root,{fade:true});q.set(this._scrollableElems.wrap,'max-height',this._config.maxheight+'px');}else{q.set(this._scrollableElems.root,'width','');q.set(this._scrollableElems.content,'width','');if(r.ie()<=7){q.set(this._scrollableElems.root,'width',this._scrollableElems.content.offsetWidth+'px');}else q.set(this._scrollableElems.root,'width',this._scrollableElems.content.offsetWidth+'px');this._scrollableArea.resize();}},onHide:function(){this.blur();},focusAnItem:function(){return this._attemptFocus(0,1);},blur:function(){if(this._focused){this._focused.blur();this._focused=null;this.inform('blur');}},handleKeydown:function(t){var u=this._items.indexOf(this._focused);switch(t){case m.UP:case m.DOWN:var v=t===m.UP?-1:1;if(u!==-1){return this._attemptFocus(u+v,v);}else if(t===m.UP){return this._attemptFocus(this._items.length-1,-1);}else return this._attemptFocus(0,1);break;case m.SPACE:if(this._items.indexOf(this._focused)!==-1){this._handleItemClick(this._focused);return true;}return false;default:var w=String.fromCharCode(t).toLowerCase(),x;for(var y=u+1;y<this._items.length;y++){x=this._items[y].getAccessKey();if(x&&x.charAt(0).toLowerCase()===w)if(this._focusItem(this._items[y]))return true;}return false;}},_render:function(){this._ul=k.create('ul',{className:'uiMenuX'});this._ul.setAttribute('role','menu');this._items.forEach(this._insertItem.bind(this));Event.listen(this._ul,'click',this._handleClick.bind(this));Event.listen(this._ul,'mouseover',this._handleMouseOver.bind(this));Event.listen(this._ul,'mouseout',this._handleMouseOut.bind(this));var t=this._ul;if(this._config.maxheight){this._scrollableElems=p.renderDOM();k.setContent(this._scrollableElems.content,this._ul);t=this._scrollableElems.root;}var u='uiMenuXWrapper'+(this._className?' '+this._className:'');this._root=k.create('div',{className:u},k.create('div',{className:'uiMenuXBorder'},t));this._id&&this._root.setAttribute('id',this._id);},_handleClick:function(t){var u=this._getItemInstance(t.getTarget());if(u)return this._handleItemClick(u);},_handleItemClick:function(t){this.inform('itemclick',t);if(t.hasAction())this.done();return t.handleClick();},_handleMouseOver:function(t){var u=this._getItemInstance(t.getTarget());u&&this._focusItem(u);},_handleMouseOut:function(t){var u=this._getItemInstance(t.getTarget());if(u&&this._focused===u)this.blur();},_insertItem:function(t){var u=t.getRoot();i.addClass(u,'__MenuXItem');j.set(u,'MenuXItem',t);k.appendContent(this._ul,u);},_attemptFocus:function(t,u){var v=this._items[t];if(v)if(this._focusItem(v)){return true;}else return this._attemptFocus(t+u,u);return false;},_focusItem:function(t){if(t.focus()!==false){if(this._focused!==t){this.blur();this._focused=t;this.inform('focus');}return true;}return false;},_getItemInstance:function(t){var u=n.byClass(t,'__MenuXItem');return u?j.get(u,'MenuXItem'):null;}});e.exports=s;});
__d("MenuXSelectableItem",["Class","copyProperties","CSS","MenuXItem"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('MenuXItem');function k(l){this.parent.construct(this,l);}g.extend(k,j);h(k.prototype,{_selected:false,getLabel:function(){return this._data.label;},getIcon:function(){return this._data.icon;},isSelected:function(){return this._selected;},select:function(){i.addClass(this._root,'checked');this._selected=true;},deselect:function(){i.removeClass(this._root,'checked');this._selected=false;},render:function(){var l=this.parent.render();if(this._data.selected){i.addClass(l,'checked');this._selected=true;}return l;}});e.exports=k;});
__d("MentionsTypeaheadAreaView",["Class","ContextualTypeaheadView","Parent","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('ContextualTypeaheadView'),i=b('Parent'),j=b('copyProperties');function k(l,m){this.parent.construct(this,l,m);}g.extend(k,h);j(k.prototype,{getContext:function(){return i.byClass(this.element,'uiMentionsInput');}});e.exports=k;});