/*1347326928,173213215*/

if (window.CavalryLogger) { CavalryLogger.start_js(["8ItVR"]); }

__d("GenderConst",[],function(a,b,c,d,e,f){var g={UNKNOWN:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11};e.exports=g;});
__d("Encoding",[],function(a,b,c,d,e,f){var g={toBytes:function(n){for(var o=[],p=0;p<n.length;p++)o.push(n.charCodeAt(p)&255);return o;},fromBytes:function(n){for(var o=[],p=0;p<n.length;p++)o.push(String.fromCharCode(n[p]));return o.join("");}},h={toBytes:function(n){return g.toBytes(window.unescape(encodeURIComponent(n)));},fromBytes:function(n){return decodeURIComponent(window.escape(g.fromBytes(n)));}},i={toBytes:function(n){for(var o=[],p=0;p<n.length*32;p+=8)o.push((n[p>>>5]>>>(24-p%32))&255);return o;},fromBytes:function(n){for(var o=[],p=0,q=0;p<n.length;p++,q+=8)o[q>>>5]|=(n[p]&255)<<(24-q%32);return o;}},j={fromBytes:function(n){for(var o=[],p=0;p<n.length;p++){o.push((n[p]>>>4).toString(16));o.push((n[p]&15).toString(16));}return o.join("");},toBytes:function(n){for(var o=[],p=0;p<n.length;p+=2)o.push(parseInt(n.substr(p,2),16));return o;}},k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l={toBytes:function(n){if(typeof window.atob=="function")return g.toBytes(window.atob(n));n=n.replace(/[^A-Z0-9+\/]/ig,"");for(var o=[],p=0,q=0;p<n.length;q=++p%4){if(q===0)continue;o.push(((k.indexOf(n.charAt(p-1))&(Math.pow(2,-2*q+8)-1))<<(q*2))|(k.indexOf(n.charAt(p))>>>(6-q*2)));}return o;},fromBytes:function(n){if(typeof window.btoa=="function")return window.btoa(g.fromBytes(n));for(var o=[],p=0;p<n.length;p+=3){var q=(n[p]<<16)|(n[p+1]<<8)|n[p+2];for(var r=0;r<4;r++)if(p*8+r*6<=n.length*8){o.push(k.charAt((q>>>6*(3-r))&63));}else o.push("=");}return o.join("");}},m={UTF8:h,binary:g,words:i,hex:j,base64:l};e.exports=m;});
__d("CryptoUtil",[],function(a,b,c,d,e,f){var g={rotl:function(h,i){return (h<<i)|(h>>>(32-i));},rotr:function(h,i){return (h<<(32-i))|(h>>>i);},endian:function(h){if(h.constructor==Number)return g.rotl(h,8)&16711935|g.rotl(h,24)&4278255360;for(var i=0;i<h.length;i++)h[i]=g.endian(h[i]);return h;},randomBytes:function(h){for(var i=[];h>0;h--)i.push(Math.floor(Math.random()*256));return i;}};e.exports=g;});
__d("md5",["Encoding","CryptoUtil"],function(a,b,c,d,e,f){var g=b('Encoding'),h=b('CryptoUtil');function i(o,p,q,r,s,t,u){var v=o+(p&q|~p&r)+(s>>>0)+u;return ((v<<t)|(v>>>(32-t)))+p;}function j(o,p,q,r,s,t,u){var v=o+(p&r|q&~r)+(s>>>0)+u;return ((v<<t)|(v>>>(32-t)))+p;}function k(o,p,q,r,s,t,u){var v=o+(p^q^r)+(s>>>0)+u;return ((v<<t)|(v>>>(32-t)))+p;}function l(o,p,q,r,s,t,u){var v=o+(q^(p|~r))+(s>>>0)+u;return ((v<<t)|(v>>>(32-t)))+p;}function m(o){var p;if(o.constructor==String)o=g.UTF8.toBytes(o);var q=g.words.fromBytes(o),r=o.length*8,s=1732584193,t=-271733879,u=-1732584194,v=271733878;for(p=0;p<q.length;p++)q[p]=((q[p]<<8)|(q[p]>>>24))&16711935|((q[p]<<24)|(q[p]>>>8))&4278255360;q[r>>>5]|=128<<(r%32);q[(((r+64)>>>9)<<4)+14]=r;var w=i,x=j,y=k,z=l;for(p=0;p<q.length;p+=16){var aa=s,ba=t,ca=u,da=v;s=w(s,t,u,v,q[p+0],7,-680876936);v=w(v,s,t,u,q[p+1],12,-389564586);u=w(u,v,s,t,q[p+2],17,606105819);t=w(t,u,v,s,q[p+3],22,-1044525330);s=w(s,t,u,v,q[p+4],7,-176418897);v=w(v,s,t,u,q[p+5],12,1200080426);u=w(u,v,s,t,q[p+6],17,-1473231341);t=w(t,u,v,s,q[p+7],22,-45705983);s=w(s,t,u,v,q[p+8],7,1770035416);v=w(v,s,t,u,q[p+9],12,-1958414417);u=w(u,v,s,t,q[p+10],17,-42063);t=w(t,u,v,s,q[p+11],22,-1990404162);s=w(s,t,u,v,q[p+12],7,1804603682);v=w(v,s,t,u,q[p+13],12,-40341101);u=w(u,v,s,t,q[p+14],17,-1502002290);t=w(t,u,v,s,q[p+15],22,1236535329);s=x(s,t,u,v,q[p+1],5,-165796510);v=x(v,s,t,u,q[p+6],9,-1069501632);u=x(u,v,s,t,q[p+11],14,643717713);t=x(t,u,v,s,q[p+0],20,-373897302);s=x(s,t,u,v,q[p+5],5,-701558691);v=x(v,s,t,u,q[p+10],9,38016083);u=x(u,v,s,t,q[p+15],14,-660478335);t=x(t,u,v,s,q[p+4],20,-405537848);s=x(s,t,u,v,q[p+9],5,568446438);v=x(v,s,t,u,q[p+14],9,-1019803690);u=x(u,v,s,t,q[p+3],14,-187363961);t=x(t,u,v,s,q[p+8],20,1163531501);s=x(s,t,u,v,q[p+13],5,-1444681467);v=x(v,s,t,u,q[p+2],9,-51403784);u=x(u,v,s,t,q[p+7],14,1735328473);t=x(t,u,v,s,q[p+12],20,-1926607734);s=y(s,t,u,v,q[p+5],4,-378558);v=y(v,s,t,u,q[p+8],11,-2022574463);u=y(u,v,s,t,q[p+11],16,1839030562);t=y(t,u,v,s,q[p+14],23,-35309556);s=y(s,t,u,v,q[p+1],4,-1530992060);v=y(v,s,t,u,q[p+4],11,1272893353);u=y(u,v,s,t,q[p+7],16,-155497632);t=y(t,u,v,s,q[p+10],23,-1094730640);s=y(s,t,u,v,q[p+13],4,681279174);v=y(v,s,t,u,q[p+0],11,-358537222);u=y(u,v,s,t,q[p+3],16,-722521979);t=y(t,u,v,s,q[p+6],23,76029189);s=y(s,t,u,v,q[p+9],4,-640364487);v=y(v,s,t,u,q[p+12],11,-421815835);u=y(u,v,s,t,q[p+15],16,530742520);t=y(t,u,v,s,q[p+2],23,-995338651);s=z(s,t,u,v,q[p+0],6,-198630844);v=z(v,s,t,u,q[p+7],10,1126891415);u=z(u,v,s,t,q[p+14],15,-1416354905);t=z(t,u,v,s,q[p+5],21,-57434055);s=z(s,t,u,v,q[p+12],6,1700485571);v=z(v,s,t,u,q[p+3],10,-1894986606);u=z(u,v,s,t,q[p+10],15,-1051523);t=z(t,u,v,s,q[p+1],21,-2054922799);s=z(s,t,u,v,q[p+8],6,1873313359);v=z(v,s,t,u,q[p+15],10,-30611744);u=z(u,v,s,t,q[p+6],15,-1560198380);t=z(t,u,v,s,q[p+13],21,1309151649);s=z(s,t,u,v,q[p+4],6,-145523070);v=z(v,s,t,u,q[p+11],10,-1120210379);u=z(u,v,s,t,q[p+2],15,718787259);t=z(t,u,v,s,q[p+9],21,-343485551);s=(s+aa)>>>0;t=(t+ba)>>>0;u=(u+ca)>>>0;v=(v+da)>>>0;}return h.endian([s,t,u,v]);}function n(o){if(null===o||undefined===o)return null;var p=g.words.toBytes(m(o));return g.hex.fromBytes(p);}e.exports=n;});
__d("Dock",["event-extensions","function-extensions","Arbiter","ArbiterMixin","ChatQuietLinks","CSS","DataStore","DOM","Parent","Style","Toggler","Vector","copyProperties","ge"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatQuietLinks'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('Parent'),n=b('Style'),o=b('Toggler'),p=b('Vector'),q=b('copyProperties'),r=b('ge');function s(){}q(s,h,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(t){this.init=bagofholding;this.rootEl=t;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();i.removeEmptyHrefs(this.rootEl);Event.listen(t,'click',this._onClick.bind(this));Event.listen(window,'resize',this._onWindowResize.bind(this));o.subscribe(['show','hide'],function(u,v){var w=v.getActive();if(!l.contains(t,w))return;if(j.hasClass(w,'fbNub')){this.notifyNub(w,u);if(u==='show')this._resizeNubFlyout(w);}else{var x=m.byClass(w,'fbNubFlyout');if(x)j.conditionClass(x,'menuOpened',u==='show');}}.bind(this));this.inform('init',{},g.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return (this.viewportDimensions=p.getViewportDimensions());},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+p.getElementDimensions(this.rootEl).y;var t=r('blueBar');if(t){var u=n.isFixed(t)?'viewport':'document';this.flyoutHeightOffset+=p.getElementPosition(t,u).y+p.getElementDimensions(t).y;}},toggle:function(t){var u=this._findFlyout(t);if(!u)return;this.subscribe('init',function(){o.toggle(t);});},show:function(t){this.subscribe('init',function(){o.show(t);});},showNub:function(t){j.show(t);},hide:function(t){this.subscribe('init',function(){var u=o.getInstance(t);l.contains(t,u.getActive())&&u.hide();});},hideNub:function(t){j.hide(t);this.hide(t);},setUseMaxHeight:function(t,u){j.conditionClass(t,'maxHeight',u!==false);this._resizeNubFlyout(t);},_resizeNubFlyout:function(t){var u=this._findFlyout(t);if(!u||!(j.hasClass(t,'openToggler')||j.hasClass(t,'opened')))return;var v=l.find(u,'div.fbNubFlyoutOuter'),w=l.find(v,'div.fbNubFlyoutInner'),x=l.find(w,'div.fbNubFlyoutBody'),y=x.scrollTop,z=x.offsetHeight;n.set(x,'height','auto');var aa=p.getElementPosition(u,'viewport'),ba=p.getElementDimensions(u),ca=p.getElementDimensions(x),da=this.getMaxFlyoutHeight(t);n.set(u,'max-height',da+'px');n.set(v,'max-height',da+'px');ba=p.getElementDimensions(u);var ea=p.getElementDimensions(w),fa=ea.y-ca.y;if(ba.y>fa)n.set(x,'height',(ba.y-fa)+'px');j.removeClass(u,'swapDirection');var ga=p.getElementPosition(u).x;j.conditionClass(u,'swapDirection',function(){if(ga<0)return true;return (ga+ba.x>this.viewportDimensions.x);}.bind(this)());if(y+z>=ca.y){x.scrollTop=ca.y;}else x.scrollTop=y;this.notifyNub(t,'resize');},getMaxFlyoutHeight:function(t){var u=this._findFlyout(t),v=p.getElementPosition(u,'viewport'),w=p.getElementDimensions(u),x=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-v.y-w.y);return Math.max(x,0);},resizeAllFlyouts:function(){var t=l.scry(this.rootEl,'div.fbNub.openToggler');t=t.concat(l.scry(this.rootEl,'div.fbNub.opened'));var u=t.length;while(u--)this._resizeNubFlyout(t[u]);},_onClick:function(event){var t=event.getTarget(),u=m.byClass(t,'fbNub');if(u){if(m.byClass(t,'fbNubFlyoutTitlebar')){var v=m.byTag(t,'a');if(!v){this.hide(u);return false;}}this.notifyNub(u,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(t){return j.hasClass(t,'fbNubFlyout')?t:l.scry(t,'div.fbNubFlyout')[0]||null;},registerNubController:function(t,u){k.set(t,'dock:nub:controller',u);u.subscribe('nub/button/content-changed',this.inform.shield(this,'resize',t));u.subscribe('nub/flyout/content-changed',this._resizeNubFlyout.shield(this,t));},unregisterNubController:function(t){k.remove(t,'dock:nub:controller');},notifyNub:function(t,u,v){var w=k.get(t,'dock:nub:controller');w&&w.inform(u,v);}});e.exports=a.Dock||s;});
__d("NubController",["ArbiterMixin","Class","Dock","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('Class'),i=b('Dock'),j=b('copyProperties');function k(){}j(k.prototype,g,{init:function(l){this.el=l;i.registerNubController(l,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){i.hide(this.el);},show:function(){i.show(this.el);}});e.exports=k;});
__d("DropdownContextualHelpLink",["copyProperties","DOM","ge"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('DOM'),i=b('ge'),j={set:function(k){var l=i('navHelpCenter');if(l!==null)h.replace(l,k);}};e.exports=j;});
__d("isRTL",[],function(a,b,c,d,e,f){function g(i){for(var j=0,k=i.length;j<k;j++){var l=i.charCodeAt(j);if(l>=1470&&l<=1920)return true;}return false;}function h(i){var j=0,k=0;i.split(/\s/,10).forEach(function(l){j++;g(l)&&k++;});return j&&(k/j>=.4);}e.exports=h;});
__d("IntlDateFormats",[],function(a,b,c,d,e,f){var g={},h={setFormats:function(i,j){g=j;},getFormat:function(i){if(!(i in g))return i;return g[i];}};e.exports=h;});
__d("date-extensions",["IntlDateFormats","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('IntlDateFormats'),h=b('copyProperties'),i=b('tx'),j=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],k=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m=["January","February","March","April","May","June","July","August","September","October","November","December"];function n(o,p){p=p||2;o=''+o;while(o.length<p)o='0'+o;return o;}Date.format=function(o,p,q){var r=p?new Date(p*1000):new Date();return r.format(o,q);};h(Date.prototype,{format:function(o,p){if(!o)return '';var q=[],r=null,s=null,t=(p?'getUTC':'get'),u=this[t+'Date'](),v=this[t+'Day'](),w=this[t+'Month'](),x=this[t+'FullYear'](),y=this[t+'Hours'](),z=this[t+'Minutes'](),aa=this[t+'Seconds'](),ba=this[t+'Milliseconds']();for(var ca=0;ca<o.length;ca++){s=o.charAt(ca);if(s=='\\'){ca++;q.push(o.charAt(ca));continue;}switch(s){case 'd':r=n(u);break;case 'D':r=j[v];break;case 'j':r=u;break;case 'l':r=k[v];break;case 'F':r=m[w];break;case 'm':r=n(w+1);break;case 'M':r=l[w];break;case 'n':r=w+1;break;case 'Y':r=x;break;case 'y':r=(''+x).slice(2);break;case 'a':r=y<12?'am':'pm';break;case 'A':r=y<12?'AM':'PM';break;case 'g':r=(y==0||y==12)?12:y%12;break;case 'G':r=y;break;case 'h':r=(y==0||y==12)?12:n(y%12);break;case 'H':r=n(y);break;case 'i':r=n(z);break;case 's':r=n(aa);break;case 'S':r=n(ba,3);break;default:r=s;}q.push(r);}return q.join('');}});a.IntlDateFormats=g;},3);
__d("StickyPlaceholderInput",["event-extensions","CSS","DOM","Input","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('Input'),j=b('Parent');function k(o){return j.byClass(o,'uiStickyPlaceholderInput');}function l(o){return h.scry(o,'.placeholder')[0];}function m(o){o=o||window.event;var p=o.target||o.srcElement;if(h.isNodeOfType(p,['input','textarea'])){var q=k(p);if(q){var r=o.type;(function(){if((r==='keydown'||r==='paste')&&p.value.length)g.removeClass(q,'uiStickyPlaceholderEmptyInput');if((r==='blur'||r==='focusout')&&!p.value.length)g.addClass(q,'uiStickyPlaceholderEmptyInput');}).defer();}}}var n={init:function(){n.init=bagofholding;Event.listen(document.documentElement,{keydown:m,paste:m});if(document.documentElement.addEventListener){document.documentElement.addEventListener('blur',m,true);}else Event.listen(document.documentElement,'focusout',m);},registerInput:function(o){n.init();var p=o.getAttribute('placeholder')||'';if(p.length)if(document.activeElement===o){var q=Event.listen(o,'blur',function(){n.manipulateInput(o,p);q.remove();});}else n.manipulateInput(o,p);},manipulateInput:function(o,p){var q=h.create('div',{className:'placeholder','aria-hidden':'true'},p),r=h.create('div',{className:'uiStickyPlaceholderInput'},q);if(h.isNodeOfType(o,'textarea'))g.addClass(r,'uiStickyPlaceholderTextarea');Event.listen(q,'click',function(){o.focus();});if(o.value===p)o.value='';g.removeClass(o,'DOMControl_placeholder');o.setAttribute('placeholder','');h.replace(o,r);h.appendContent(r,o);g.conditionClass(r,'uiStickyPlaceholderEmptyInput',!o.value.length);},setPlaceholderText:function(o,p){var q=k(o);if(!q){i.setPlaceholder(o,p);}else{var r=l(q);r&&h.setContent(r,p);}},getPlaceholderText:function(o){var p=k(o),q=l(p);return q&&h.getText(q);},update:function(o){var p=k(o);if(p)g.conditionClass(p,'uiStickyPlaceholderEmptyInput',!o.value.length);},getVisibleText:function(o){var p=k(o);if(g.hasClass(p,'uiStickyPlaceholderEmptyInput')){var q=l(p);return q&&h.getText(q);}else return o.value;}};e.exports=n;});
__d("Tokenizer",["array-extensions","event-extensions","Arbiter","ArbiterMixin","Class","CSS","DataStore","DOM","DOMQuery","Input","Keys","Parent","StickyPlaceholderInput","Style","TextMetrics","Token","UserAgent","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('DOMQuery'),n=b('Input'),o=b('Keys'),p=b('Parent'),q=b('StickyPlaceholderInput'),r=b('Style'),s=b('TextMetrics'),t=b('Token'),u=b('UserAgent'),v=b('copyProperties'),w=b('createObjectFrom');function x(y,z){this.element=y;this.typeahead=z;this.input=z.getCore().getElement();k.set(this.element,'Tokenizer',this);}x.getInstance=function(y){var z=p.byClass(y,'uiTokenizer');return z?k.get(z,'Tokenizer'):null;};v(x.prototype,h,{inline:false,maxTokens:null,excludeDuplicates:true,placeholder:'',init:function(y,z,aa,ba){this.init=bagofholding;this.tokenarea=y;this.paramName=z;if(!this.placeholder)this.placeholder=this.input.getAttribute('data-placeholder')||'';v(this,ba||{});this.initEvents();this.initTypeahead();this.reset(aa);this.initBehaviors();g.inform('Tokenizer/init',this,g.BEHAVIOR_PERSISTENT);},reset:function(y){this.tokens=[];this.unique={};if(y){this.populate(y);}else l.empty(this.tokenarea);this.updateTokenarea();},populate:function(y){var z=[];this.tokens=this.getTokenElements().map(function(aa,ba){var ca=y[ba];z.push(this._tokenKey(ca));return this.createToken(ca,aa);},this);this.unique=w(z,this.tokens);},getElement:function(){return this.element;},getTypeahead:function(){return this.typeahead;},getInput:function(){return this.input;},initBehaviors:function(){this.behaviors=this.behaviors||[];if(this.behaviors instanceof Array){this.behaviors.forEach(function(aa){aa.behavior(this,aa.config);}.bind(this));}else for(var y in (this.behaviors||{})){var z=window.TokenizerBehaviors&&window.TokenizerBehaviors[y];z.call(null,this,this.behaviors[y]);}},initTypeahead:function(){var y=this.typeahead.getCore();y.resetOnSelect=true;y.setValueOnSelect=false;y.preventFocusChangeOnTab=true;if(this.inline){var z=this.typeahead.getView();j.addClass(z.getElement(),'uiInlineTokenizerView');}this.typeahead.subscribe('select',function(aa,ba){var ca=ba.selected;if('uid' in ca){this.updateInput();this.addToken(this.createToken(ca));}}.bind(this));this.typeahead.subscribe('blur',this.handleBlur.bind(this));},handleBlur:function(event){this.inform('blur',{event:event});this.updatePlaceholder();},initEvents:function(){var y=this.handleEvents.bind(this),z=u.firefox()<4?'keypress':'keydown';Event.listen(this.tokenarea,{click:y,keydown:y});Event.listen(this.input,'paste',this.paste.bind(this));Event.listen(this.input,z,this.keydown.bind(this));},handleEvents:function(event){var y=event.getTarget(),z=y&&this.getTokenElementFromTarget(y);if(!z)return;if(event.type!='keydown'||Event.getKeyCode(event)==o.RETURN)this.processEvents(event,y,z);},processEvents:function(event,y,z){if(p.byClass(y,'remove')){var aa=z.nextSibling;aa=aa&&m.scry(z.nextSibling,'.remove')[0];var ba=this.getTokenFromElement(z);ba=this.addTokenData(ba,y);this.removeToken(ba);this.focusOnTokenRemoval(event,aa);event.kill();}},focusOnTokenRemoval:function(event,y){n.focus(event.type=='keydown'&&y||this.input);},addTokenData:function(y,z){return y;},keydown:function(event){this.inform('keydown',{event:event});var y=Event.getKeyCode(event),z=this.input;if(this.inline&&y==o.BACKSPACE&&n.isEmpty(z)){var aa=this.getLastToken();if(aa&&aa.isRemovable())this.removeToken(aa);}this.updateInput();},paste:function(event){this.inform('paste',{event:event});this.updateInput(true);},focusInput:function(){n.focus(this.input);},updateInput:function(y){if(!this.inline)return;setTimeout(function(){this.adjustWidth(this.input.value);if(y)this.input.value=this.input.value;}.bind(this),20);q.setPlaceholderText(this.input,'');},setPlaceholder:function(y){this.placeholder=y;if(this.stickyPlaceholder)q.setPlaceholderText(this.input,y);this.updatePlaceholder();},updatePlaceholder:function(){if(!this.inline||this.input.value)return;var y=!this.tokens.length,z='';if(y||this.stickyPlaceholder){this.adjustWidth(this.placeholder);z=this.placeholder;}q.setPlaceholderText(this.input,z);},adjustWidth:function(y){if(!this.inline||!this._getIsInDOM())return;if(!y&&this.stickyPlaceholder&&this.input.value==='')y=this.placeholder;var z=this._getMetrics().measure(y),aa=z.width+this._getWidthOffset()+10;r.set(this.input,'width',aa+'px');},getToken:function(y){return this.unique[y]||null;},getTokens:function(){return this.tokens||[];},getTokenElements:function(){return m.scry(this.tokenarea,'span.uiToken');},getTokenElementFromTarget:function(y){return p.byClass(y,'uiToken');},getTokenFromElement:function(y){return k.get(y,'Token');},getTokenValues:function(){return this.tokens.map(function(y){return y.getValue();});},getFirstToken:function(){return this.tokens[0]||null;},getLastToken:function(){return this.tokens[this.tokens.length-1]||null;},hasMaxTokens:function(){return this.maxTokens&&this.maxTokens<=this.tokens.length;},createToken:function(y,z){var aa=this.getToken(this._tokenKey(y));aa=aa||new t(y,this.paramName);z&&aa.setElement(z);return aa;},addToken:function(y){if(this.hasMaxTokens())return;var z=this._tokenKey(y.getInfo());if(z in this.unique)return;this.unique[z]=y;this.tokens.push(y);this.insertToken(y);this.updateTokenarea();this.inform('addToken',y);g.inform('Form/change',{node:this.element});},insertToken:function(y){l.appendContent(this.tokenarea,y.getElement());},removeToken:function(y){if(!y)return;var z=this.tokens.indexOf(y);if(z<0)return;this.tokens.splice(this.tokens.indexOf(y),1);delete this.unique[this._tokenKey(y.getInfo())];l.remove(y.getElement());this.updateTokenarea();this.inform('removeToken',y);g.inform('Form/change',{node:this.element});},removeAllTokens:function(){this.reset();this.inform('removeAllTokens');},updateTokenarea:function(){var y=this.typeahead.getCore(),z=this.getTokenValues();if(this.excludeDuplicates){this._exclusions||(this._exclusions=y.getExclusions());y.setExclusions(z.concat(this._exclusions));}y.setEnabled(!this.hasMaxTokens());this.updateTokenareaVisibility();this.updatePlaceholder();this.adjustWidth(this.placeholder);},updateTokenareaVisibility:function(){j.conditionShow(this.tokenarea,this.tokens.length!==0);},_tokenKey:function(y){return y.uid+(y.freeform?':':'');},_widthOffset:null,_getWidthOffset:function(){if(this._widthOffset===null){var y=this.input.clientWidth,z=r.getFloat(this.input,'width');if(y==z){this._widthOffset=r.getFloat(this.input,'paddingLeft')+r.getFloat(this.input,'paddingRight');}else this._widthOffset=0;}return this._widthOffset;},_metrics:null,_getMetrics:function(){if(!this._metrics)this._metrics=new s(this.input,this.inline);return this._metrics;},_getIsInDOM:function(){return this._isInDOM||(this._isInDOM=m.contains(document.body,this.input));}});e.exports=x;});
__d("endsWith",[],function(a,b,c,d,e,f){function g(h,i){return h.indexOf(i,h.length-i.length)>-1;}e.exports=g;});
__d("htmlHyperlink",["Env","htmlize","UntrustedLink","URI","URLScraper"],function(a,b,c,d,e,f){var g=b('Env'),h=b('htmlize'),i=b('UntrustedLink'),j=b('URI'),k=b('URLScraper');function l(m,n,o,p){if(typeof m==='undefined'||!m.toString)return '';if(typeof n!=='function')n=h;if(typeof o!=='function')o=h;var m=m.toString(),q=[],r;while((r=k.match(m))){var s=m.indexOf(r);if(s>=0)q.push(n(m.substring(0,s)));var t=o(r),u=r.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(r)))u='http://'+u;q.push('<a target="_blank" rel="nofollow" href="'+u+'"');if(p&&!j(u).isFacebookURI()){a.UntrustedLink=i;q.push(' onmousedown="UntrustedLink.bootstrap(this, \''+g.lhsh+'\', event)"');}q.push('>'+t+'</a>');m=m.substring(s+r.length);}m&&q.push(n(m));return q.join('');}e.exports=l;});
__d("TypingDetector",["event-extensions","function-extensions","ArbiterMixin","Class","Input","Run","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('Input'),j=b('Run'),k=b('copyProperties'),l=b('createObjectFrom');function m(n){this._input=n;this._ignoreKeys={};}m.INACTIVE=0;m.TYPING=1;m.QUITTING=2;k(m.prototype,g,{_timeout:7000,_currentState:m.INACTIVE,init:function(){this.init=bagofholding;this.reset();Event.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=m.INACTIVE;},setIgnoreKeys:function(n){this._ignoreKeys=l(n);},_onunload:function(){if(this._currentState==m.TYPING)this._transition(m.QUITTING);},_update:function(event){var n=Event.getKeyCode(event),o=this._currentState;if(!this._ignoreKeys[n])if(i.getValue(this._input).trim().length===0){if(o==m.TYPING)this._transition(m.INACTIVE);}else if(o==m.TYPING){this._recordKeystroke();}else if(o==m.INACTIVE){this._transition(m.TYPING);this._recordKeystroke();}},_transition:function(n){this.reset();this._currentState=n;this.inform('change',n);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=this._checkTyping.bind(this).defer(this._timeout);},_checkTyping:function(){var n=this._lastKeystrokeTime+this._timeout,o=Date.now();if(o>n){this._transition(m.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=this._checkTyping.bind(this).defer(n-o+10);}}});e.exports=m;});
__d("ChatHovercard",["Arbiter","AsyncLoader","Hovercard","JSLogger","debounce"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncLoader'),i=b('Hovercard'),j=b('JSLogger'),k=b('debounce'),l=5,m=new h('/ajax/chat/hovercard/sidebar.php','hover'),n=j.create('chat_hovercard');g.subscribe('Hovercard/dirty',m.reset.bind(m));function o(s,t){m.get(s,function(u){(function(){if(!u){n.error('fetch_failure',{id:s});return;}var v=i.getDialog(u);if(!v){n.error('no_hovercard',{id:s,endpoint:u});return;}if(s==t.getActiveID())t.showHovercard(s,v);}).defer();});}function p(s,t){var u=[];function v(y){if(y>=0&&y<s.length)u.push(s[y]);}var w=s.indexOf(t);if(w>-1){v(w);for(var x=1;x<l;x++){v(w+x);v(w-x);}}return u;}function q(s,t){var u=t.getActiveID();if(u){var v=s.getShowingUsers(),w=p(v,u);m.get(w,function(){});}}function r(s){var t=s.getHoverController();t.registerDefault(o);t.subscribe('hover',k(q.curry(s,t),100));}e.exports=r;});
__d("ChatOrderedListHover",["event-extensions","function-extensions","ArbiterMixin","Class","CSS","DOM","ErrorUtils","LayerFadeOnHide","Parent","copyProperties","setTimeoutAcrossTransitions","tx"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('CSS'),j=b('DOM'),k=b('ErrorUtils'),l=b('LayerFadeOnHide'),m=b('Parent'),n=b('copyProperties'),o=b('setTimeoutAcrossTransitions'),p=b('tx');function q(t){i.addClass(t,'fetching');}function r(t){i.removeClass(t,'fetching');}function s(t){this._orderedList=t;this._root=t.getRoot();Event.listen(this._root,'mouseover',this._mouseOver.bind(this));Event.listen(this._root,'mouseleave',this._mouseLeave.bind(this));t.subscribe('click',this._hide.shield(this));}n(s.prototype,g,{_root:null,_activeItem:null,_hideTimeout:null,_showTimeout:null,_showingDialog:null,_showingID:null,_alreadyShowing:false,_handlers:{},_defaultHandler:null,_mouseOver:function(t){var u=t.getTarget(),v=m.byClass(u,'item');v&&this._setActiveItem(v);},_mouseLeave:function(t){this._setActiveItem(null);},_clearTimeouts:function(){this._showTimeout&&clearTimeout(this._showTimeout);this._showTimeout=null;this._hideTimeout&&clearTimeout(this._hideTimeout);this._hideTimeout=null;},_checkAlreadyShowing:function(){var t=this.getActiveID();if(!t&&!this._showingID)this._alreadyShowing=false;},_hide:function(){if(this._showingDialog){this._showingDialog.enableBehavior(l);this._showingDialog.hide();this._showingDialog=null;this._showingID=null;}this._checkAlreadyShowing();},_show:function(){this._alreadyShowing=true;var t=this.getActiveID(),u=false;if(this._handlers[t]){u=true;k.applyWithGuard(this._handlers[t],{},[t,this]);}else if(this._defaultHandler){u=true;k.applyWithGuard(this._defaultHandler,{},[t,this]);}if(u&&this._showingID!=this.getActiveID())q(this._activeItem);},_setActiveItem:function(t){if(t!=this._activeItem){this._clearTimeouts();this._activeItem&&r(this._activeItem);this._activeItem=null;var u=t?0:100;this._hideTimeout=o(function(){if(this.getActiveID()!=this._showingID)this._hide();}.bind(this),u);if(t){var v=this._orderedList.getUserForNode(t);this._activeItem=t;var w=u+(this._alreadyShowing?75:500);this._showTimeout=o(function(){this._show();}.bind(this),w);this.inform('hover',v);}else this.inform('leave');this._checkAlreadyShowing();}},register:function(t,u){if(!this._handlers[t]){this._handlers[t]=u;return {unregister:function(){if(t==this._showingID)this._hide();delete this._handlers[t];var v=this._orderedList.getAllNodes(),w=v[t];w&&r(w);}.bind(this)};}},registerDefault:function(t){this._defaultHandler=t;},getActiveID:function(){var t=this._activeItem&&this._orderedList.getUserForNode(this._activeItem);return t||null;},showHovercard:function(t,u){if(t==this.getActiveID()&&t!=this._showingID){this._clearTimeouts();r(this._activeItem);this._hide();this._showingDialog=u;this._showingID=t;var v=u.subscribe('mouseenter',this._setActiveItem.bind(this,this._activeItem)),w=u.subscribe('mouseleave',function(){v.unsubscribe();this._setActiveItem(null);}.bind(this)),x=u.subscribe('hide',function(){v.unsubscribe();w.unsubscribe();x.unsubscribe();});u.setContext(this._activeItem);u.setFixed(true);u.setPosition('left');u.show();u.updatePosition();}}});e.exports=s;});
__d("ChatQuietLinks",["event-extensions","DOM","DOMQuery","UserAgent","DataStore","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOM'),h=b('DOMQuery'),i=b('UserAgent'),j=b('DataStore'),k=b('Parent'),l={},m={silenceLinks:function(q){n(q,this.removeEmptyHrefs.bind(this));},nukeLinks:function(q){n(q,this.removeAllHrefs.bind(this));},removeEmptyHrefs:function(q){o(q,function(r){return !r||r==='#';});},removeAllHrefs:function(q){o(q);}};function n(q,r){var s=!!i.chrome(),t=!!i.chrome()||i.ie()>=9||i.firefox()>=4;if(l[g.getID(q)])return;l[g.getID(q)]=true;if(!t)return;if(!s){r&&r(q);return;}Event.listen(q,'mouseover',function u(v){var w=k.byTag(v.getTarget(),'a');if(w){var x=w.getAttribute('href');if(p(x)){j.set(w,'stashedHref',w.getAttribute('href'));w.removeAttribute('href');}}});Event.listen(q,'mouseout',function u(v){var w=k.byTag(v.getTarget(),'a'),x=w&&j.remove(w,'stashedHref');if(p(x))w.setAttribute('href',x);});Event.listen(q,'mousedown',function(u){if(!u.isDefaultRequested())return true;var v=k.byTag(u.getTarget(),'a'),w=v&&j.get(v,'stashedHref');if(p(w))v.setAttribute('href',w);});}function o(q,r){var s=g.scry(q,'a');if(r)s=s.filter(function(t){return r(t.getAttribute('href'));});s.forEach(function(t){t.removeAttribute('href');t.setAttribute('tabindex',0);});}function p(q){return q&&q!=='#';}e.exports=m;});
__d("ChatOrderedList",["event-extensions","Animation","Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AvailableList","AvailableListConstants","Chat","ChatConfig","ChatOrderedListHover","ChatQuietLinks","ChatVisibility","CSS","DataStore","DOM","HTML","JSLogger","OrderedFriendsList","Parent","PresencePrivacy","ShortProfiles","Tooltip","URI","XHPTemplate","copyProperties","createObjectFrom","debounceAcrossTransitions","goURI","tx","MercuryConfig","ChannelImplementation"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('AsyncDialog'),k=b('AsyncRequest'),l=b('AvailableList'),m=b('AvailableListConstants'),n=b('Chat'),o=b('ChatConfig'),p=b('ChatOrderedListHover'),q=b('ChatQuietLinks'),r=b('ChatVisibility'),s=b('CSS'),t=b('DataStore'),u=b('DOM'),v=b('HTML'),w=b('JSLogger'),x=b('OrderedFriendsList'),y=b('Parent'),z=b('PresencePrivacy'),aa=b('ShortProfiles'),ba=b('Tooltip'),ca=b('URI'),da=b('XHPTemplate'),ea=b('copyProperties'),fa=b('createObjectFrom'),ga=b('debounceAcrossTransitions'),ha=b('goURI'),ia=b('tx'),ja=c('MercuryConfig'),ka=c('ChannelImplementation').instance;function la(qa,ra,sa,ta){this._root=qa;this._items={};this._isVisible=false;this._excludedIds={};this._numTopFriends=5;this._hasRendered=false;this._preventRendering=false;this._hoverController=null;this._template=ra;this._messageTemplate=sa;this._contextualDialog=ta;Event.listen(this._root,'click',this._onClick.bind(this));Event.listen(this._root,'mouseenter',this._mouseEnter.bind(this));Event.listen(this._root,'mouseleave',this._mouseLeave.bind(this));l.subscribe(m.ON_AVAILABILITY_CHANGED,this.update.shield(this));z.subscribe('privacy-changed',this.update.shield(this));ka.subscribe([ka.CONNECTED,ka.RECONNECTING,ka.SHUTDOWN,ka.MUTE_WARNING,ka.UNMUTE_WARNING],this.update.shield(this));this.inform('initialized',this,h.BEHAVIOR_PERSISTENT);this.render();h.subscribe(w.DUMP_EVENT,function(ua,va){va.chat_lists=va.chat_lists||{sorted_list:this.getSortedList(),ordered_list:x.getList(),available_list:la.getAvailableList(this._excludedIds),excluded_list:this._excludedIds};}.bind(this));}function ma(qa,ra){var sa=na(qa,ra);if(sa!==0)return sa;var ta=oa(qa,ra);if(ta!==0)return ta;return x.compare(qa,ra);}function na(qa,ra){var sa=z.allows(qa),ta=z.allows(ra);if(sa!==ta)return sa?-1:1;return 0;}function oa(qa,ra){var sa=aa.getNow(qa),ta=aa.getNow(ra),ua=((sa||{}).name||'~').toLowerCase(),va=((ta||{}).name||'~').toLowerCase();if(ua!==va)return ua<va?-1:1;return 0;}function pa(qa,ra){var sa=l.get(qa)===m.MOBILE,ta=l.get(ra)===m.MOBILE;if(sa!==ta)return ta?-1:1;return oa(qa,ra);}ea(la,{getSortedList:function(qa,ra){var sa=x.getList().filter(function(ib){return !(ib in qa);});sa=sa.filter(function(ib){return z.getFriendVisibility(ib)!==z.BLACKLISTED;});var ta=[],ua=r.isOnline();if(ua){if(z.getOnlinePolicy()===z.ONLINE_TO_WHITELIST){var va=sa,wa={},xa,ya;sa=[];for(xa=0;xa<va.length;++xa){ya=va[xa];if(z.allows(ya)){wa[ya]=true;sa.push(ya);}}var za=z.getWhitelist();for(xa=0;xa<za.length;++xa){ya=za[xa];if(!(ya in wa))sa.push(ya);}for(xa=0;xa<va.length;++xa){ya=va[xa];if(!z.allows(ya))sa.push(ya);}}var ab=o.get('ordered_list.top_friends',0),bb=o.get('ordered_list.available_target',0),cb=Math.floor(ra*bb),db=[];for(var xa=0,eb=sa.length;xa<eb&&cb>0;xa++){var ya=sa[xa],fb=l.get(ya),gb=fb===m.ACTIVE;if(o.get('chat_sidebar_mobile_available'))gb=gb||(fb===m.MOBILE);if(gb||xa<ab){ta.push(ya);gb&&cb--;}else db.push(ya);}if(xa<eb)Array.prototype.push.apply(db,sa.slice(xa));if(ta.length<ra)Array.prototype.push.apply(ta,db);}else Array.prototype.push.apply(ta,sa);ta=ta.slice(0,ra);if(ta.length===ra){var hb=la.getAvailableList(ta.concat(qa)).length;hb&&ta.splice(-1);}ta.sort(ma);return ta;},getAvailableList:function(qa){return l.getOnlineIDs().filter(function(ra){return !(ra in qa);});}});ea(la.prototype,i,{getAllNodes:function(){var qa={},ra=u.scry(this._root,'li.item');for(var sa=0;sa<ra.length;sa++){var ta=t.get(ra[sa],'id');if(ta)qa[ta]=ra[sa];}return qa;},getShowingUsers:function(){return u.scry(this._root,'li.item').map(function(qa){return t.get(qa,'id');});},getUserForNode:function(qa){return t.get(qa,'id');},getHoverController:function(){if(!this._hoverController)this._hoverController=new p(this,this._contextualDialog);return this._hoverController;},_getListItem:function(qa){var ra=this._items[qa];if(ra){var sa=l.get(qa),ta=z.allows(qa)&&!ka.disconnected(),ua={active:false,mobile:false,greenphone:false};ua.active=sa===m.ACTIVE;if(o.get('sidebar_mobile_icon_green')){ua.greenphone=sa===m.MOBILE;}else ua.mobile=sa===m.MOBILE;for(var va in ua)s.conditionClass(ra,va,ua[va]&&ta);s.conditionClass(ra,'invis',!ta);}return ra;},getRoot:function(){return this._root;},getSortedList:function(){return la.getSortedList(this._excludedIds,this._numTopFriends);},hide:function(){if(!this._isVisible)return;this._isVisible=false;s.hide(this._root);this.inform('hide');},_onClick:function(event){var qa=event.getTarget(),ra=y.byTag(qa,'li');if(ra){if(s.hasClass(ra,'blackbirdWhitelist')){var sa=new ca('/ajax/chat/privacy/settings_dialog.php').addQueryData({ref:'whitelist_separator'});j.send(new k(sa));event.prevent();return false;}var ta=t.get(ra,'id');if(ta){var ua='ordered_list';while(ra.previousSibling){ra=ra.previousSibling;if(s.hasClass(ra,'separator')){if(s.hasClass(ra,'moreOnlineFriends')){ua='more_online_friends';break;}if(s.hasClass(ra,'blackbirdWhitelist')){ua='blackbird_offline_section';break;}}}var va=[];if(o.get('chat_realtime_coefficient_impressions'))va=this.getSortedList();aa.get(ta,function(wa){n.openTab(ta,wa.name,'friend',ua,va);});this.inform('click',{id:ta});}else if(s.hasClass(ra,'separator')&&y.byClass(qa,'inner'))this.scrollTo(ra);return false;}},_mouseEnter:function(){this._preventRendering=true;},_mouseLeave:function(){this._preventRendering=false;},setExcludedIds:function(qa){this._excludedIds=fa(qa||[]);},setNumTopFriends:function(qa){if(qa!==this._numTopFriends){this._numTopFriends=qa;this.render();}},_getOfflineToSectionItems:function(){var qa=u.create('a',{href:'#'},u.tx._("Edit")),ra=[],sa=ja.ChatControlLanguageChangeGK?u.tx._("MORE FRIENDS"):u.tx._("OFFLINE FRIENDS");ra.push(v('<li class="separator">'+'<div class="outer">'+'<div class="inner">'+'<span class="text">'+sa+'</span>'+'<div class="dive"><span class="bar"></span></div>'+'</div>'+'</div>'+'</li>'));ra.push(v('<li class="separator blackbirdWhitelist">'+'<div class="outer">'+'<div class="inner">'+'<div class="subheader">'+'<span class="subheaderText">'+u.tx._("These friends can't see you on chat. {=link}",{'=link':qa})+'</span>'+'</div>'+'</div>'+'</li>'));return ra;},render:function(){this.render=ga(function(){if(!this._isVisible||(this._preventRendering&&this._hasRendered))return;this._hasRendered=true;var qa=this.getSortedList(),ra=[],sa,ta,ua=z.getVisibility()&&z.getOnlinePolicy()==z.ONLINE_TO_WHITELIST;for(var va=0,wa=qa.length;va<wa;va++){sa=qa[va];if(ua)if(!z.allows(sa)){if(va+2>=qa.length)break;ua=false;var xa=this._getOfflineToSectionItems();ra.push(xa[0]);ra.push(xa[1]);wa-=2;}ta=this._getListItem(sa);if(ta){ra.push(ta);}else this._renderListItem(sa,this.render.bind(this));}var ya=la.getAvailableList(this._excludedIds),za=fa(qa);ya=ya.filter(function(fb){return !(fb in za);});ya.sort(pa);var ab=ja.ChatControlLanguageChangeGK?"MORE FRIENDS":"MORE ONLINE FRIENDS";if(ya.length&&ra.length)ra.push(v('<li class="separator moreOnlineFriends">'+'<div class="outer">'+'<div class="inner">'+'<span class="text">'+ia._("{MORE ONLINE FRIENDS} ({=count})",{'MORE ONLINE FRIENDS':ab,'=count':ya.length})+'</span>'+'<div class="dive"><span class="bar"></span></div>'+'</div>'+'</div>'+'</li>'));for(var bb=0,cb=ya.length;bb<cb;bb++){sa=ya[bb];ta=this._getListItem(sa);if(ta){ra.push(ta);}else this._renderListItem(sa,this.render.bind(this));}if(!qa.length&&!ya.length){var db=this._messageTemplate.render(),eb=da.getNode(db,'message');u.setContent(eb,"No one is available to chat.");ra.push(db);}if(ra.length){u.setContent(this._root,ra);q.nukeLinks(this.getRoot());this.inform('render');}},300,this);this.render();},_renderListItem:function(qa,ra){aa.get(qa,function(sa){if(sa.type==='friend'){var ta=this._template.render(),ua=da.getNode(ta,'profile-photo');ua.setAttribute('src',sa.thumbSrc);var va=da.getNode(ta,'name');u.setContent(va,sa.name);var wa=da.getNode(ta,'anchor');wa.setAttribute('href','/messages/'+qa);var xa=da.getNode(ta,'timeline_icon');if(xa){var ya=ia._("Go to {name}'s timeline",{name:sa.firstName});ba.set(xa,ya,'above','center');Event.listen(xa,'click',function(event){event.kill();ha(sa.uri);});}t.set(ta,'id',qa);this._items[qa]=ta;ra&&ra(ta);}}.bind(this));},show:function(){if(this._isVisible)return;this._isVisible=true;s.show(this._root);this.render();this.inform('show');},isVisible:function(){return this._isVisible;},update:function(){this._hasRendered=false;this.render();},setScrollContainer:function(qa){if(u.contains(qa,this._root))this._scrollContainer=qa;},scrollTo:function(qa){if(!this._scrollContainer)return;var ra=this._scrollContainer.scrollHeight,sa=this._scrollContainer.clientHeight,ta=this._scrollContainer.scrollTop,ua=Math.min(qa.offsetTop,ra-sa);if(ta!==ua){var va=Math.abs(ua-ta)/this._scrollContainer.clientHeight*500;g(this._scrollContainer).to('scrollTop',ua).ease(g.ease.end).duration(va).go();}}});e.exports=la;});
__d("TypingIndicator",["AsyncRequest","AvailableList","AvailableListConstants","ChannelConnection","ChatVisibility","copyProperties","Keys","ShortProfiles","TypingDetector","PresencePrivacy"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChannelConnection'),k=b('ChatVisibility'),l=b('copyProperties'),m=b('Keys'),n=b('ShortProfiles'),o=b('TypingDetector'),p=b('PresencePrivacy');function q(s){if(!k.isOnline())return false;if(s){var t=n.getNow(s);return t&&t.type=="friend"&&p.allows(s);}return true;}function r(s,t,u,v,w){this.userID=s;this.input=t;this.source=u;this.threadID=w;this.remoteState=o.INACTIVE;this.notifyTimer=null;v=v||{};this.notifyDelay=v.notifyDelay||this.notifyDelay;this._typingDetector=new o(t);this._typingDetector.init(v);this._typingDetector.subscribe('change',this._stateChange.bind(this));}l(r.prototype,{notifyDelay:1000,setUserAndThread:function(s,t){if(this.userID!==s||this.threadID!==t){this.resetState();this.userID=s;this.threadID=t;}},setIgnoreEnter:function(s){var t=s?[m.RETURN]:[];this._typingDetector.setIgnoreKeys(t);},resetState:function(){this.remoteState=r.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;},_stateChange:function(s,t){if(t!=o.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=this._notifyState.shield(this,t).defer(this.notifyDelay,false);}else this._notifyState(t,true);},_notifyState:function(s,t){if(!this.userID&&!this.threadID)return;var u=this.userID,v=q(u);if(v&&s!=this.remoteState){this.remoteState=s;if(j.disconnected())return;var w={typ:s,to:u,source:this.source,thread:this.threadID};new g().setHandler(this._onTypResponse.bind(this,u)).setErrorHandler(bagofholding).setData(w).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous',!t).send();}},_onTypResponse:function(s,t){var u=t.getPayload()||{};if(u.offline)h.set(s,i.OFFLINE,'typing_response');}});e.exports=r;});
__d("ChatSidebarSheet",["event-extensions","function-extensions","ArbiterMixin","BlackbirdUpsell","ChannelConnection","ChannelConstants","ChatBehavior","ChatConfig","ChatVisibility","CSS","DOM","JSLogger","PresencePrivacy","copyProperties","tx","MercuryConfig"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ArbiterMixin'),h=b('BlackbirdUpsell'),i=b('ChannelConnection'),j=b('ChannelConstants'),k=b('ChatBehavior'),l=b('ChatConfig'),m=b('ChatVisibility'),n=b('CSS'),o=b('DOM'),p=b('JSLogger'),q=b('PresencePrivacy'),r=b('copyProperties'),s=b('tx'),t=c('MercuryConfig'),u=p.create('sidebar_sheet');function v(y){switch(y){case j.HINT_AUTH:return "Your session has timed out. Please log in.";case j.HINT_CONN:return s._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});case j.HINT_MAINT:return s._("Facebook {Chat} is currently down for maintenance.",{Chat:"Chat"});default:return s._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});}}function w(y){var z;if(y===null){z="Unable to connect to chat. Check your Internet connection.";}else if(y>l.get('warning_countdown_threshold_msec')){var aa=o.create('a',{href:'#',className:'fbChatReconnectLink'},"Try again");z=o.tx._("Unable to connect to chat. {try-again-link}",{'try-again-link':aa});}else if(y>1000){z=s._("Unable to connect to chat. Reconnecting in {seconds}...",{seconds:Math.floor(y/1000)});}else z="Unable to connect to chat. Reconnecting...";return z;}function x(y){this._root=y;this._message=o.find(y,'div.fbChatSidebarMessage div.message');i.subscribe([i.CONNECTED,i.SHUTDOWN,i.RECONNECTING],this._handleConnectionChange.bind(this));i.subscribe([i.MUTE_WARNING,i.UNMUTE_WARNING],this._render.bind(this));q.subscribe('privacy-user-presence-changed',this._render.bind(this));k.subscribe(k.ON_CHANGED,this._render.bind(this));this._render();}r(x.prototype,g,{_channelStatus:null,_channelData:null,_handleConnectionChange:function(y,z){this._channelStatus=y;this._channelData=z;this._render();},_showWarningTimeout:null,_warningMsgEventListener:null,_renderChannelDisconnect:function(){if(this._channelStatus===i.SHUTDOWN){return o.setContent(this._message,v(this._channelData));}else if(this._channelStatus===i.RECONNECTING){var y=this._channelData;o.setContent(this._message,w(y));if(y>1000){if(y>l.get('warning_countdown_threshold_msec'))this._warningMsgEventListener=Event.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),'fbChatReconnectLink')){i.reconnect();return false;}});this._showWarningTimeout=setTimeout(this._handleConnectionChange.bind(this,i.RECONNECTING,y-1000),1000,false);}}},_goOnlineEventListener:null,_renderOffline:function(){var y='fbChatGoOnlineLink',z=t.ChatControlLanguageChangeGK?"Turn on chat":"Go online",aa=o.create('a',{href:'#',className:y},z),ba;if(t.ChatControlLanguageChangeGK){ba=o.tx._("{=Go online} to see who's available.",{'=Go online':aa});}else ba=o.tx._("{=Go online} to see who's online to chat.",{'=Go online':aa});o.setContent(this._message,ba);this._goOnlineEventListener=Event.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),y)){u.log('sidebar_go_online');m.goOnline();return false;}});},_renderBlackbirdUpsell:function(){o.setContent(this._message,h.getOfflineContent());},_renderBlackbird:function(y){o.setContent(this._message,h.getBlackbirdContent(y));},_clear:function(){if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}if(this._warningMsgEventListener){this._warningMsgEventListener.remove();this._warningMsgEventListener=null;}if(this._goOnlineEventListener){this._goOnlineEventListener.remove();this._goOnlineEventListener=null;}n.removeClass(this._root,'upsell');n.removeClass(this._root,'offline');n.removeClass(this._root,'blackbird');n.removeClass(this._root,'error');n.removeClass(this._root,'notice');o.empty(this._message);},_render:function(){this._clear();if(h.shouldEducate()){if(m.hasBlackbirdEnabled()){var y=m.isOnline()?'blackbird':'upsell';n.addClass(this._root,y);this._renderBlackbird(q.getVisibility());}else if(!m.isOnline()){n.addClass(this._root,'upsell');this._renderBlackbirdUpsell();}}else if(!m.isOnline()){n.addClass(this._root,'offline');this._renderOffline();}else if(i.disconnected()){n.addClass(this._root,'error');this._renderChannelDisconnect();}else if(!k.notifiesUserMessages()){n.addClass(this._root,'notice');o.setContent(this._message,"Alerts are off while you use another client to chat.");}this.inform('updated');}});e.exports=x;});
__d("ChatSidebar",["JSXDOM","event-extensions","Arbiter","ArbiterMixin","AsyncRequest","ChatConfig","ChatHovercard","ChatOptions","ChatSidebarSheet","CSS","DOM","DOMDimensions","FBDesktopPlugin","JSLogger","OrderedFriendsList","PresencePrivacy","ScrollableArea","Style","ViewportBounds","copyProperties","createArrayFrom","debounce","ChatOrderedList","ChatTypeaheadBehavior","ChatTypeaheadCore","ChatTypeaheadDataSource","ChatTypeaheadRenderer","Typeahead"],function(a,b,c,d,e,f){var g=b('JSXDOM'),g=b('JSXDOM');b('event-extensions');var h=b('Arbiter'),i=b('ArbiterMixin'),j=b('AsyncRequest'),k=b('ChatConfig'),l=b('ChatHovercard'),m=b('ChatOptions'),n=b('ChatSidebarSheet'),o=b('CSS'),p=b('DOM'),q=b('DOMDimensions'),r=b('FBDesktopPlugin'),s=b('JSLogger'),t=b('OrderedFriendsList'),u=b('PresencePrivacy'),v=b('ScrollableArea'),w=b('Style'),x=b('ViewportBounds'),y=b('copyProperties'),z=b('createArrayFrom'),aa=b('debounce');b('ChatOrderedList');b('ChatTypeaheadBehavior');b('ChatTypeaheadCore');b('ChatTypeaheadDataSource');b('ChatTypeaheadRenderer');b('Typeahead');var ba,ca=false,da=false,ea=false,fa=false,ga=false,ha,ia,ja,ka,la=null,ma=s.create('chat_sidebar'),na=32;function oa(){o.removeClass(document.documentElement,'sidebarMode');if(!fa||!ua.isVisible())return;ea=false;la=null;o.hide(ia);ha.hide();ja.getCore().reset();ma.rate('sidebar_hide',fa);ua.inform('sidebar/hide',ua);h.inform('sidebar/hide',ua);h.inform('reflow');}function pa(){var va=ua.shouldShowSidebar();o.conditionClass(document.documentElement,'sidebarCapable',va);if(ua.isEnabled()&&va){qa();var wa=ka.height;z(ia.childNodes).forEach(function(xa){if(xa!==ba)wa-=q.getElementDimensions(xa).height;});wa=Math.max(0,wa);w.set(ba,'height',wa+'px');this._maxItems=Math.floor((wa-8)/na);ha.setNumTopFriends(this._maxItems);ja.getData().setMaxResults(this._maxItems);ua.inform('sidebar/resized',ua);h.inform('sidebar/resized',ua);h.inform('reflow');}else oa();if(!fa){ta();fa=true;}la=null;}function qa(){if(ua.isVisible())return;ea=true;la=null;o.show(ia);o.addClass(document.documentElement,'sidebarMode');ha.show();ma.rate('sidebar_show',fa);ua.inform('sidebar/show',ua);h.inform('sidebar/show',ua);}function ra(){m.setSetting('sidebar_mode',ua.isEnabled(),'sidebar');new j('/ajax/chat/settings.php').setHandler(bagofholding).setErrorHandler(bagofholding).setData({sidebar_mode:ua.isEnabled()}).setAllowCrossPageTransition(true).send();}function sa(){return t.getList().length<=k.get('sidebar.min_friends');}function ta(){var va=true;if(!ua.isEnabled()){ma.log('state_not_enabled');va=false;}if(!ua.isViewportCapable()){ma.log('state_not_shown_viewport');va=false;}if(da){ma.log('state_not_shown_hidden');va=false;}if(sa()){ma.log('state_not_shown_num_friends');va=false;}if(r.shouldSuppressSidebar()){ma.log('state_not_shown_fbdesktop');va=false;}ma.log(va?'state_shown':'state_not_shown');}var ua={init:function(va,wa,xa){ua.init=bagofholding;ga=true;ia=va;ha=wa;ja=xa;ba=p.find(va,'div.fbChatSidebarBody');if(k.get('chat_sidebar_hovercards'))new l(wa);var ya=new n(va);ya.subscribe('updated',pa);h.subscribe('sidebar/invalidate',pa);wa.setScrollContainer(p.find(ba,'div.uiScrollableAreaWrap'));wa.subscribe(['render','show','hide'],aa(function(){var za=wa.getRoot(),ab=v.getInstance(za);ab&&ab.adjustGripper();}));Event.listen(window,'resize',pa);h.subscribe('chat/option-changed',function(za,ab){if(ab.name=="sidebar_mode"){ca=!!m.getSetting('sidebar_mode');pa();}});xa.subscribe(['respond','reset'],function(za,ab){if(ea)if(ab&&ab.value&&ab.value===xa.getCore().getValue()&&xa.getView().isVisible()){ha.hide();}else ha.show();});xa.getData().subscribe('beforeQuery',pa);h.subscribe('buddylist-nub/initialized',function(za,ab){Event.listen(ab.getButton(),'click',function(event){ua.enable();return !ua.shouldShowSidebar();});});ca=!!m.getSetting('sidebar_mode');u.subscribe('privacy-user-presence-changed',pa);pa();x.addRight(ua.getVisibleWidth);ua.inform('sidebar/initialized',ua,h.BEHAVIOR_PERSISTENT);h.inform('sidebar/initialized',ua,h.BEHAVIOR_PERSISTENT);},isInitialized:function(){return fa;},disable:function(){if(!ua.isEnabled())return;ca=false;ra();oa();},enable:function(){if(ua.isEnabled())return;ca=true;ra();pa();!function(){if(ua.isVisible())ja.getCore().getElement().focus();}.defer();},ensureLoaded:function(){if(ga)return;d(['UIPagelet'],function(va){var wa=g.div({id:"pagelet_sidebar"});p.appendContent(document.body,wa);va.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});ga=true;},hide:function(){if(da)return;da=true;oa();},unhide:function(){if(!da)return;da=false;pa();},getBody:function(){return ba;},getRoot:function(){return ia;},getVisibleWidth:function(){if(!ea||!ia)return 0;if(la===null)la=ia.offsetWidth;return la;},isEnabled:function(){return ca;},isViewportCapable:function(){ka=q.getViewportWithoutScrollbarDimensions();var va=k.get('sidebar.minimum_width');return ka.width>va;},shouldShowSidebar:function(){return ua.isViewportCapable()&&!da&&!sa()&&!r.shouldSuppressSidebar();},isVisible:function(){return ea;},resize:pa,toggle:function(){ua.isEnabled()?ua.disable():ua.enable();}};y(ua,i);e.exports=ua;a.ChatSidebar=ua;});
__d("VideoCallingTour",["event-extensions","Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Chat'),j=b('ChatSidebar'),k=b('ChatVisibility'),l=b('CSS'),m=b('DOM'),n=b('PresencePrivacy'),o=b('Run'),p=b('Toggler'),q=b('Vector'),r=b('copyProperties'),s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=y.defer();}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=y.defer();}));});x.inform('videocallingtour/start');}});e.exports=x;});
__d("ChatActivity",["Arbiter","AvailableList","AvailableListConstants","copyProperties","event-extensions","JSLogger","MercuryThreads","PresenceState","UserActivity","MercuryConfig"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('copyProperties');b('event-extensions');var k=b('JSLogger'),l=b('MercuryThreads'),m=b('PresenceState'),n=b('UserActivity'),o=c('MercuryConfig'),p=o.activity_limit||60000,q=o.idle_limit||1800000,r=o.idle_poll_interval||300000,s=k.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&(aa-t<p));}var x=j(new g(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);m.doSync();}x.inform('activity');}h.subscribe(i.ON_AVAILABILITY_CHANGED,function(){if(!h.isUserIdle())u=Date.now();});Event.listen(window,'focus',function(){v=true;y();});Event.listen(window,'blur',function(){v=false;});n.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&m.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(m.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);m.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});g.subscribe(k.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});e.exports=x;});
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryMessages","MercuryParticipants","MercuryThreads","tx"],function(a,b,c,d,e,f){var g=b('MercuryAssert'),h=b('MercuryMessages'),i=b('MercuryParticipants'),j=b('MercuryThreads'),k=b('tx');function l(m,n){g.isThreadID(m);j.getThreadMeta(m,function(o){h.getThreadMessagesRange(m,0,1,function(p){var q=p.length&&p[p.length-1];if(q&&q.author!=i.user){i.get(q.author,function(r){if(o.name){n(k._("{senderName} messaged {groupName}",{senderName:r.short_name,groupName:o.name}));}else n(k._("{name} messaged you",{name:r.short_name}));});}else n("New message!");});});}e.exports={renderDocumentTitle:l};});
__d("MercuryTimestampTracker",["MercuryServerRequests","MercuryConstants"],function(a,b,c,d,e,f){var g=b('MercuryServerRequests'),h=c('MercuryConstants'),i=0;e.exports={getLastUserMessageTimestamp:function(){return i;}};g.subscribe('update-messages',function(j,k){if(!k.actions||!k.actions.length)return;var l=h.MercuryPayloadSource;if(k.payload_source==l.CLIENT_SEND_MESSAGE||k.payload_source==l.UNKNOWN)return;for(var m=0;m<k.actions.length;m++){var n=k.actions[m],o=n.action_type;if(o==h.MercuryActionType.USER_GENERATED_MESSAGE&&n.thread_id&&n.timestamp>i)i=n.timestamp;}});});
__d("ChatTitleBarBlinker",["ChatActivity","DocumentTitle","JSLogger","MercuryThreadInformer","MercuryNotificationRenderer","PresenceState","MercuryTimestampTracker","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('ChatActivity'),h=b('DocumentTitle'),i=b('JSLogger'),j=b('MercuryThreadInformer'),k=b('MercuryNotificationRenderer'),l=b('PresenceState'),m=b('MercuryTimestampTracker'),n=b('MercuryUnseenState'),o=i.create('chat_title'),p=null,q=0,r=false;function s(){if(p){p.stop();p=null;return true;}return false;}function t(y){var z=y||m.getLastUserMessageTimestamp();if(q<=z){q=z;if(s()||r)l.doSync();}}var u={blink:function(y,z){if(!p&&q<z)k.renderDocumentTitle(y,function(aa){if(!p)p=h.blink(aa);});},stopBlinking:function(){t();},blinkingElsewhere:function(){r=true;}};function v(y){var z=l.verifyNumber(y.sb2);if(!z||z<=q)return null;return z;}function w(y){var z=y&&v(y);if(z){q=z;o.debug('load',q);s();r=false;}}function x(y){var z=v(y);if(!z){o.debug('store',q);y.sb2=q;r=false;}return y;}l.registerStateStorer(x);l.registerStateLoader(w);j.subscribe('thread-read-changed',function(y,z){var aa=m.getLastUserMessageTimestamp(),ba=0;for(var ca in z)if(z[ca].mark_as_read&&z[ca].timestamp>=aa&&z[ca].timestamp>ba)ba=z[ca].timestamp;ba&&t(ba);});g.subscribe('activity',function(){t();});(function(){var y=l.getInitial();if(y)q=v(y)||0;})();e.exports=u;});
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","copyProperties","MercuryParticipants","Sound","MercuryConstants"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatActivity'),i=b('ChatConfig'),j=b('ChatOptions'),k=b('ChatTitleBarBlinker'),l=b('copyProperties'),m=b('MercuryParticipants'),n=b('Sound'),o=c('MercuryConstants');n.init(['audio/ogg','audio/mpeg']);function p(r){if(j.getSetting('sound'))n.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],r,false);}var q={messageReceived:function(r){var s=o.MessagingTag;if(r.author==m.user||!r.is_unread||(r.folder!=s.INBOX&&r.folder!=s.ARCHIVED))return;var t=h.isActive(),u=r.thread_id,v=r.timestamp;if(t){var w=false;q.inform('before-alert',{threadID:u,cancelAlert:function(){w=true;}});!w&&p(v);}else{k.blink(u,v);p(v);}k.blinkingElsewhere();}};e.exports=l(q,g);});
__d("ChatApp",["CSS","JSLogger"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('JSLogger'),i=false,j=false,k=false,l=null,m={init:function(n,o,p){if(l){h.create('chat_app').error('repeated_init');return;}l=n;d(['TabsViewport','ChatTabController','ChatTabViewCoordinator','MercuryServerRequests','MercuryChannelHandler','MercuryStateCheck'],function(q,r,s,t,u,v){t.handleUpdate(p);this.tabsViewport=new q(o);this.tabController=new r(this.tabsViewport);this.tabViewCoordinator=new s(o,this.tabsViewport);i=j=true;}.bind(this));},hide:function(){if(!i||k)return;g.hide(l);k=true;},unhide:function(){if(i){if(k){g.show(l);this.tabsViewport.checkWidth();d(['Dock'],function(n){n.resizeAllFlyouts();});k=false;}}else if(!j){d(['UIPagelet'],function(n){n.loadFromEndpoint('DockChatPagelet','pagelet_chat');});j=true;}}};e.exports=m;});
__d("ChatTabModel",["function-extensions","Arbiter","ArbiterMixin","ChatBehavior","ChatConfig","copyProperties","JSLogger","MercuryAssert","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker","PresenceState","PresenceUtil","areObjectsEqual","PresenceInitialData"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatBehavior'),j=b('ChatConfig'),k=b('copyProperties'),l=b('JSLogger'),m=b('MercuryAssert'),n=b('MercuryServerRequests'),o=b('MercuryThreads'),p=b('MercuryTimestampTracker'),q=c('PresenceInitialData'),r=b('PresenceState'),s=b('PresenceUtil'),t=b('areObjectsEqual'),u=[],v=null,w=null,x=null,y=null;function z(){return parseInt(q.serverTime,10);}var aa=j.get('tab_max_load_age')||3600000,ba=z()-aa,ca=0,da=20,ea=l.create('chat_tab_model'),fa=false;function ga(xa){var ya=r.verifyNumber(xa.uct2);if(!ya||typeof ya!=='number'){ea.warn('bad_cookie_version',xa.uct2);return null;}if(ya<=ca||ya<ba)return null;return ya;}function ha(xa){var ya=ga(xa);if(!ya){var za={};za.old_tabs=xa&&xa.t2&&JSON.stringify(xa.t2);za.old_promoted=xa&&xa.lm2;za.old_time=xa&&xa.uct2;za.old_reason=xa&&xa.tr;za.old_window=xa&&xa.tw;var ab;if(w&&xa.t2)for(var bb=0;bb<xa.t2.length;bb++){var cb=xa.t2[bb];if(cb.i===w)ab=cb.r;}var db=[];u.forEach(function(eb){if(!eb.fragile){var fb={i:eb.id,si:eb.server_id};if(eb.raised||(eb.id===w&&ab))fb.r=1;db.push(fb);}});xa.t2=db;xa.uct2=ca;xa.lm2=v;xa.tr=y;xa.tw=s.getSessionID();za.new_tabs=JSON.stringify(xa.t2);za.new_promoted=xa.lm2;za.new_time=xa.uct2;za.new_reason=xa.tr;za.new_window=xa.tw;ea.debug('store',za);}return xa;}function ia(xa){if(xa){var ya=ga(xa);if(ya){var za={};za.old_tabs=JSON.stringify(u);za.old_promoted=v;za.old_time=ca;za.old_reason=y;za.window_id=s.getSessionID();za.cookie_tabs=xa&&xa.t2&&JSON.stringify(xa.t2);za.cookie_promoted=xa&&xa.lm2;za.cookie_time=xa&&xa.uct2;za.cookie_reason=xa&&xa.tr;za.cookie_window=xa&&xa.tw;ca=ya;y='load';var ab=ja(xa.t2,xa.lm2||null);za.load_result=ab;za.new_tabs=JSON.stringify(u);za.new_promoted=v;za.new_time=ca;za.new_reason=y;var event='load';if(!fa)event+='_init';ea.log(event,za);return ab;}}return false;}function ja(xa,ya){if(ka(xa,ya)){var za=u.filter(function(cb){return cb.fragile;}),ab={};v=null;u=xa.map(function(cb){var db={id:cb.i,server_id:cb.si};if(db.id==ya)v=db.id;if(w==cb.i){var eb=pa(w);if(eb!=-1){db.raised=u[eb].raised;return db;}else return null;}if(cb.r)db.raised=true;ab[db.id]=db;return db;});u=u.filter(function(cb){return cb!=null;});if(x)for(var bb in x)if(!ab[bb]||!ab[bb].raised)delete x[bb];za=za.filter(function(cb){return !ab[cb.id];});u=u.concat(za);oa();return true;}return false;}function ka(xa,ya){if(ya!=v)return true;var za=u.filter(function(cb){return !cb.fragile;});if(xa.length!=za.length)return true;for(var ab=0,bb=xa.length;ab<bb;ab++){if(xa[ab].id===w)continue;if(!t(xa[ab],za[ab]))return true;}return false;}function la(xa,ya,za){var ab=ia(r.get());if(ya===undefined||ya>ca){if(xa()){ab=true;y=za||null;na(ya);}}else ea.error('rejected',{change_time:ya,state_time:ca});ab&&ma();}function ma(){if(fa)va.inform('chat/tabs-changed',va.get());}function na(xa){if(xa===undefined)xa=Math.max(p.getLastUserMessageTimestamp()||1,ca+1);ca=xa;r.doSync();}function oa(){var xa=u.length-da;if(xa>0)u=u.filter(function(ya){return ya.raised||xa--<=0;});}function pa(xa){for(var ya=0;ya<u.length;ya++)if(u[ya].id==xa)return ya;return -1;}function qa(xa){var ya=o.getThreadMetaNow(xa);if(!ya)return false;if(ya.is_canonical_user){return sa(xa);}else{var za=ra(xa);if(za)n.getServerThreadID(xa,function(ab){if(ta(xa,ab)){na();ma();}});return za;}}function ra(xa){if(pa(xa)===-1){u.push({id:xa,fragile:true});ea.log('open_fragile_tab',{tabs:JSON.stringify(u),opened:xa,window_id:s.getSessionID()});return true;}return false;}function sa(xa){var ya=pa(xa);if(ya!=-1)if(u[ya].fragile){u.splice(ya,1);}else return false;for(var za=0;za<=u.length;za++)if(za==u.length||u[za].fragile){u.splice(za,0,{id:xa});oa();ea.log('open_tab',{tabs:JSON.stringify(u),opened:xa,window_id:s.getSessionID()});return true;}}function ta(xa,ya){var za=pa(xa);if(za!=-1&&u[za].fragile){var ab=u[za];ab.fragile=false;ab.server_id=ya;var bb=[];u.forEach(function(cb){if(cb.id!=xa){if(ab&&cb.fragile){bb.push(ab);ab=null;}bb.push(cb);}});if(ab)bb.push(ab);u=bb;ea.log('make_permanent',{tabs:JSON.stringify(u),tab_id:xa,window_id:s.getSessionID()});return true;}return false;}function ua(xa){var ya=pa(xa);if(xa==v)v=null;if(ya!=-1){u.splice(ya,1);ea.log('close_tab',{tabs:JSON.stringify(u),closed:xa,window_id:s.getSessionID()});return true;}return false;}r.registerStateStorer(ha);r.registerStateLoader(function(xa){if(ia(xa))ma();});function va(){}k(va,h,{indexOf:function(xa){return pa(xa);},getTab:function(xa){m.isThreadID(xa);var ya=this.indexOf(xa);if(ya>-1){var za=u[ya];return k({},za);}return null;},closeAllTabs:function(){if(u.length){ea.log('close_all_tabs',{closed_tabs:JSON.stringify(u),window_id:s.getSessionID()});u=[];v=null;if(x)x={};na();ma();}},closeFragileTabs:function(){var xa=[];for(var ya=0;ya<u.length;ya++)if(u[ya].fragile){xa.push(u[ya]);u.splice(ya);ma();break;}ea.log('close_fragile_tabs',{tabs:JSON.stringify(u),fragile_closed:xa,window_id:s.getSessionID()});},closeTab:function(xa,ya){m.isThreadID(xa);var za=false;if(x){delete x[xa];za=true;}la(function(){if(ua(xa))za=true;return za;},undefined,ya);},closeTabAndDemote:function(xa,ya,za){m.isThreadID(xa);var ab=false;if(x){delete x[xa];ab=true;}la(function(){if(ua(xa)){if(v){var bb=pa(v);if(bb>ya){var cb=u.splice(bb,1)[0];u.splice(ya,0,cb);v=null;}}ab=true;}return ab;},undefined,za);},raiseTab:function(xa,ya){m.isThreadID(xa);var za=false;if(x&&ya){x[xa]=true;za=true;}if(!ya&&xa===w){za&&ma();return;}la(function(){if(qa(xa))za=true;var ab=pa(xa);if(ab!=-1&&!u[ab].raised){u[ab].raised=true;za=true;ea.log('raise_tab',{tabs:JSON.stringify(u),raised:xa,window_id:s.getSessionID()});}return za;});},get:function(){var xa=u.map(function(ya){var za=k({},ya);delete za.fragile;if(x)za.raised=x[za.id];return za;});return {tabs:xa,promoted:v};},openFragileTab:function(xa){m.isThreadID(xa);if(ra(xa))ma();},openTab:function(xa){m.isThreadID(xa);la(qa.curry(xa));},lowerTab:function(xa){m.isThreadID(xa);var ya=false;if(x){delete x[xa];ya=true;}la(function(){var za=pa(xa);if(za!=-1&&u[za].raised){delete u[za].raised;ea.log('lower_tab',{tabs:JSON.stringify(u),lowered:xa,window_id:s.getSessionID()});ya=true;}return ya;});},raiseAndPromoteTab:function(xa,ya,za,ab){m.isThreadID(xa);var bb=false;if(x&&ya){x[xa]=true;bb=true;}if(!ya&&xa===w){bb&&ma();return;}la(function(){if(qa(xa))bb=true;var cb=pa(xa);if(cb!=-1&&(!u[cb].raised||v!=xa)){u[cb].raised=true;v=xa;bb=true;ea.log('raise_and_promote_tab',{tabs:JSON.stringify(u),promoted:xa,window_id:s.getSessionID()});}return bb;},za,ab);},squelchTab:function(xa){m.isThreadID(xa);w=xa;this.lowerTab(xa);ea.log('squelch_tab',{squelched:xa,tabs:JSON.stringify(u),window_id:s.getSessionID()});},clearSquelchedTab:function(){if(w)ea.log('unsquelch_tab',{squelched:w,tabs:JSON.stringify(u),window_id:s.getSessionID()});w=null;},persistLocalRaised:function(){if(x){la(function(){var xa=false;u.forEach(function(ya){if(ya.raised!=x[ya.id]){xa=true;if(x[ya.id]){ya.raised=true;}else delete ya.raised;}});return xa;});ea.log('persist_local_raise',{tabs:JSON.stringify(u),window_id:s.getSessionID()});}}});g.subscribe(l.DUMP_EVENT,function(xa,ya){ya.chat_tabs={promoted:v,tabs:u.map(function(za){return k({},za);}),time:ca,max_load_age:aa};});function wa(){var xa=i.ignoresRemoteTabRaise();if(xa&&!x){ea.log('start_ignore_remote_raise');x={};ma();}else if(!xa&&x){ea.log('stop_ignore_remote_raise');x=null;ma();}}i.subscribe(i.ON_CHANGED,wa);wa();ia(r.getInitial(),true);if(ca===0)ca=z()-600000;fa=true;e.exports=va;});
__d("VideoCallPromo",["ArbiterMixin","AsyncRequest","AvailableList","AvailableListConstants","ChatConfig","ChatVisibility","ContextualDialogX","copyProperties","CSS","MercuryThreads","MercuryParticipants","VideoCallCore","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('AvailableList'),j=b('AvailableListConstants'),k=b('ChatConfig'),l=b('ChatVisibility'),m=b('ContextualDialogX'),n=b('copyProperties'),o=b('CSS'),p=b('MercuryThreads'),q=b('MercuryParticipants'),r=c('ChatTabTemplates'),s=b('VideoCallCore');function t(){this._dialog=null;}function u(w){if(!(s.isSupported()&&k.get('video.show_promo')))return false;var x=p.getCanonicalUserInThread(w);if(!x)return false;return l.isOnline()&&s.availableForCall(x);}function v(w){new h().setURI('/ajax/chat/video/log_promo.php').setData({viewedUserID:w}).setAllowCrossPageTransition(true).setErrorHandler(bagofholding).send();}n(t.prototype,g);n(t.prototype,{render:function(w,x){var y=u(x);if(!y)return;var z=p.getCanonicalUserInThread(x);q.get('fbid:'+z,function(aa){if(!aa.call_promo)return;var ba=r[':fb:mercury:call:promo'].build();this._dialog=new m();this._dialog.init(ba.getRoot()).setWidth(250).setAlignH('center').setContext(w).show();o.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');o.addClass(w,'video_call_promo');v(p.getCanonicalUserInThread(x));this.inform('chat/dialog-rendered',{dialog:this,thread_id:x});}.bind(this));},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=t;});
__d("VideoCallTourDialog",["ArbiterMixin","ContextualDialogX","copyProperties","CSS","MercuryThreads","VideoCallCore","VideoCallingTour","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ContextualDialogX'),i=b('copyProperties'),j=b('CSS'),k=b('MercuryThreads'),l=c('ChatTabTemplates'),m=b('VideoCallCore'),n=b('VideoCallingTour');function o(){this._dialog=null;}i(o.prototype,g);i(o.prototype,{render:function(p,q){var r=k.getCanonicalUserInThread(q);if(!r||!m.availableForCall(r))return;var s=l[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();j.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');j.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});n.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;});
__d("ChatContextualDialogController",["event-extensions","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallPromo","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('ChatTabModel'),i=b('VideoCallingTour'),j=b('VideoCallPromo'),k=b('VideoCallTourDialog'),l=b('copyProperties'),m=b('setTimeoutAcrossTransitions'),n=60000,o=false,p=false,q=function(x,y){this._videoCallPromo=new j();this._videoCallTour=new k();this._threadID=x;this._tabMainElement=y;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function r(x,event,y){if(x._openDialog)x._openDialog.updatePosition();}function s(x){if(x._openDialog)x._openDialog.updatePosition();}function t(x){if(x._openDialog){x._openDialog.hide();x._openDialog=null;}if(x._timeout){clearTimeout(x._timeout);x._timeout=null;}while(x._subscriptionTokens.length)x._subscriptionTokens.pop().unsubscribe();if(x._scrollListener){x._scrollListener.remove();x._scrollListener=null;}}function u(x,event,y){if(y.thread_id===x._threadID){x._openDialog=y.dialog;o=true;w(x);x._timeout=m(x.destroy.bind(x,x._threadID),n);x._scrollListener=Event.listen(window,'scroll',s.curry(x));}}function v(x,y){if(!x._openDialog){x._subscriptionTokens.push(y.subscribe('chat/dialog-rendered',u.curry(x)));y.render(x._tabMainElement,x._threadID);}}function w(x){x._subscriptionTokens.push(h.subscribe('chat/tabs-changed',r.curry(x)),q.subscribe('dialog/close-all',t.curry(x)));}l(q,g);l(q.prototype,{destroy:function(){t(this);},tabFocused:function(){if(p){v(this,this._videoCallTour);return;}if(!o)v(this,this._videoCallPromo);},tabNotActive:function(){t(this);},hideVideoCallouts:function(){t(this);}});i.subscribe('videocallingtour/start',function(){p=true;q.inform('dialog/close-all');});i.subscribe('videocallingtour/end',function(){p=false;});e.exports=q;});
__d("ChatPrivacyActionController",["Arbiter","ChatVisibility","JSLogger","PresencePrivacy","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatVisibility'),i=b('JSLogger'),j=b('PresencePrivacy'),k=b('copyProperties'),l=function(m,n){this._userID=m;this._logger=i.create('blackbird');this._getState=function(){if(h.isOnline())return j.allows(this._userID)?l.NORMAL:l.BLOCKED;return l.OFFLINE;};this._togglePrivacy=function(){var o=this._getState();switch(this._getState()){case l.OFFLINE:if(h.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});h.goOnline(function(){if(!j.allows(this._userID)){if(this._getState()!==l.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case l.BLOCKED:j.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case l.NORMAL:j.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};(function(){var o=function(){n&&n(this._getState());}.bind(this);o();this._subscribeToken=j.subscribe('privacy-changed',o);}.bind(this)).defer();};l.OFFLINE='offline';l.BLOCKED='blocked';l.NORMAL='normal';k(l.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){j.unsubscribe(this._subscribeToken);}});e.exports=l;});
__d("MessagesEmoticonView",["event-extensions","function-extensions","DOM","InputSelection","Parent","TextAreaControl","Toggler","copyProperties","endsWith","startsWith"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('DOM'),h=b('InputSelection'),i=b('Parent'),j=b('TextAreaControl'),k=b('Toggler'),l=b('copyProperties'),m=b('endsWith'),n=b('startsWith'),o={smile:':)',frown:':(',tongue:':P',grin:'=D',gasp:':o',wink:';)',glasses:'8)',sunglasses:'B|',grumpy:'>:(',unsure:':/',cry:":'(",devil:'3:)',angel:'O:)',kiss:':*',heart:'<3',kiki:'^_^',squint:'-_-',confused:'o.O',upset:'>:o',pacman:':v',robot:':|]',colonthree:':3',penguin:'<(")',putnam:':putnam:',shark:'(^^^)','42':':42:',like:'(y)',confused_rev:'O.o'};function p(r,s,t){var u=i.byClass(r,'emoteIcon');if(!u)return;var v='name_',w=null;u.className.split(' ').forEach(function(da){if(n(da,v))w=da.substring(v.length);});if(!o[w])return;var x=j.getInstance(s),y=x.getValue(),z=o[w],aa=y.substring(0,t.start),ba=y.substring(t.end);if(t.start>0&&!m(aa,' '))z=' '+z;if(!n(ba,' '))z+=' ';var ca=aa+z+ba;t.start+=z.length;t.end=t.start;x.setValue(ca);h.set(s,t.start,t.end);}function q(r,s){var t={start:0,end:0};function u(){t=h.get(s);}var v=g.find(r,'.uiToggleFlyout');this._subscription=k.subscribe('show',function(w,x){if(x.active&&g.contains(r,x.active))h.set(s,t.start,t.end);});this._eventListeners=[Event.listen(v,'click',function(event){k.hide(r);p(event.getTarget(),s,t);}),Event.listen(s,'keyup',u),Event.listen(s,'click',u)];}l(q.prototype,{destroy:function(){this._subscription.unsubscribe();while(this._eventListeners.length)this._eventListeners.pop().remove();}});l(q,{create:function(r,s){return new q(r,s);}});e.exports=q;});
__d("MercuryAttachmentRenderer",["CSS","DOM","md5","MercuryAttachment","Style","tx","URI","MercuryMessages","MercuryParticipants","MercuryAttachmentTemplates","MercuryConstants"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('md5'),j=b('MercuryAttachment'),k=b('Style'),l=b('tx'),m=b('URI'),n=c('MercuryAttachmentTemplates'),o=c('MercuryConstants'),p=b('MercuryMessages'),q=b('MercuryParticipants');function r(u,v){var w=n[v].build().setNodeContent('filename',u.name),x=w.getNode('link');x.setAttribute('href',u.url);u.rel&&x.setAttribute('rel',u.rel);g.addClass(w.getRoot(),j.getAttachIconClass(u.icon_type));return w;}function s(u){var v=o.SocialReportHoldout;if(!v)return false;var w=i(u.substring(5).toString());w=w.substring(v.start,v.start+v.length);w=parseInt(w,16);var x=v.buckets;return (((w%x)+x)%x)<v.limit;}var t={renderError:function(u){var v=n[':fb:mercury:attachment:error'].build();h.appendContent(v.getNode('error'),u.error_msg);return v.getRoot();},renderExternalLink:function(u){var v=n[':fb:mercury:attachment:external-link'].build().setNodeContent('name',u.name).setNodeContent('shortLink',u.base_url),w=v.getNode('preview');w.setAttribute('href',u.url);u.rel&&w.setAttribute('rel',u.rel);if(u.preview_url){var x=v.getNode('preview-image');x.setAttribute('src',u.preview_url);g.addClass(w,u.preview_class);g.show(x);}else{g.addClass(v.getRoot(),'noMedia');g.hide(w);}v.getNode('name').setAttribute('href',u.url);return v.getRoot();},renderFileLink:function(u){var v=':fb:mercury:attachment:file-link',w=r(u,v);return w.getRoot();},renderExtendedFileLink:function(u){var v=':fb:mercury:attachment:extended-file-link',w=r(u,v);if(u.open_url){var x=w.getNode('openLinkContainer');g.show(x);var y=w.getNode('openFile');y.setAttribute('href',u.open_url);}var z=w.getNode('downloadFile');z.setAttribute('href',u.url);u.rel&&z.setAttribute('rel',u.rel);return w.getRoot();},renderMusic:function(u){var v=n[':fb:mercury:attachment:music'].build().setNodeContent('filename',u.name),w=v.getNode('link');w.setAttribute('href',u.url);w.setAttribute('target','_blank');u.rel&&w.setAttribute('rel',u.rel);var x=v.getNode('preview');x.setAttribute('href',u.url);u.rel&&x.setAttribute('rel',u.rel);var y=v.getNode('preview-image');y.setAttribute('src',u.preview_url);g.show(y);g.addClass(v.getNode('icon_link'),'MercuryMusicIcon');return v.getRoot();},renderPreview:function(u,v,w,x,y,z){var aa=n[':fb:mercury:attachment:preview'].build(),ba=aa.getNode('image-link'),ca='';if(u){ba.setAttribute('href',u.url);u.rel&&ba.setAttribute('rel',u.rel);ca=u.preview_url;if(w&&m(ca).getPath()=='/ajax/messaging/attachment.php')ca+=w;if(x)this.renderReportRespondLink(aa.getRoot(),u,x.message_id);g.addClass(ba,u.preview_class);}else{ca='/images/blank.gif';g.addClass(ba,'imagePreview');g.addClass(ba,'thumbnail');}var da=aa.getNode('preview-image');if(!v){if(!u){k.set(da,'height','194px');k.set(da,'width','194px');}}else{g.addClass(da,'invisible_elem');da.onload=function(){var ea=da.offsetWidth,fa=da.offsetHeight,ga,ha;if(ea>fa){k.set(da,'maxHeight',v+'px');ha=Math.min(fa,v);ga=Math.ceil(ea*ha/fa);}else{k.set(da,'maxWidth',v+'px');ga=Math.min(ea,v);ha=Math.ceil(fa*ga/ea);}k.set(da,'marginTop','-'+(ha>>>1)+'px');k.set(da,'marginLeft','-'+(ga>>>1)+'px');g.removeClass(da,'invisible_elem');};}da.setAttribute('src',ca);return aa.getRoot();},renderMultiplePreviews:function(u){return this._renderMultiplePreviews(u,u.length);},renderMultipleThumbnails:function(u){return this._renderMultiplePreviews(null,u);},renderShareLink:function(u){var v=n[':fb:mercury:attachment:share-link'].build().setNodeContent('name',u.name),w=v.getNode('link');w.setAttribute('href',u.url);u.rel&&w.setAttribute('rel',u.rel);return v.getRoot();},renderVideoThumb:function(u){var v=n[':fb:mercury:attachment:video-thumb'].build(),w=v.getNode('thumb');w.setAttribute('href',u.url);w.setAttribute('rel',u.rel);var x=h.find(v.getRoot(),'img');x.src=u.preview_url;return v.getRoot();},_renderMultiplePreviews:function(u,v){var w='singleImagePreview',x=0;if(v==2||v==4){w='doubleImagePreview';x=194;}else if(v>1){w='multipleImagePreview';x=129;}var y=h.create('div',{className:'imagePreviews'});g.addClass(y,w);g.addClass(y,'clearfix');if(u){var z='&numPreviews='+v;for(var aa=0;aa<v;++aa){var ba=this.renderPreview(u[aa],x,z);h.appendContent(y,ba);}}else for(aa=0;aa<v;++aa){ba=this.renderPreview(null,x);h.appendContent(y,ba);}return y;},renderShareXHP:function(u,v){var w=h.create('div');if(u){var x=u.share_xhp;h.appendContent(w,x);this.renderReportRespondLink(w,u,v);}return w;},renderReportRespondLink:function(u,v,w){if(!v.is_social_report_attachment)return null;switch(v.share_data_type){case o.MercurySupportedShareType.FB_PHOTO:break;default:return null;}var x=null;if(w)x=p.getMessagesFromIDs([w])[0];if(!x)return null;if(x.author===q.user)return null;if(s(x.author))return null;var y=null;q.get(x.author,function(z){y=h.create('a',{rel:'dialog-post',className:'SocialReportLink',id:'respond-link',ajaxify:m('/ajax/report/social_resolution/photo/').setQueryData({attachment_fbid:v.attach_id,photo_fbid:v.shared_object_id,sender_id:q.getUserID(z.id)}).toString()});h.setContent(y,l._("Respond to {name}'s request",{name:z.name}));h.appendContent(u,y);});}};e.exports=t;});
__d("MercuryTypingReceiver",["Arbiter","ChannelConstants","MercuryParticipants","MercuryServerRequests","MercuryThreads","TypingDetector","setTimeoutAcrossTransitions","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryParticipants'),j=b('MercuryServerRequests'),k=b('MercuryThreads'),l=b('TypingDetector'),m=b('setTimeoutAcrossTransitions'),n=c('MercuryConstants'),o,p={},q=30000,r=new g();function s(x){var y=p[x]||{},z=Object.keys(y);z.sort(function(aa,ba){return y[aa]-y[ba];});return z;}function t(){o=null;var x=Date.now(),y={},z=false;for(var aa in p){var ba=false;for(var ca in p[aa]||{})if(p[aa][ca]<x-q){delete p[aa][ca];ba=true;}else z=true;if(ba)y[aa]=s(aa);}for(var da in y){r.inform('state-changed',y);break;}if(z)o=m(t,3000);}function u(x,y){if(x in p)if(y in p[x]){delete p[x][y];v(x);}}function v(x){var y={};y[x]=s(x);r.inform('state-changed',y);}function w(x){if(x.thread)return j.getClientThreadIDNow(x.thread);if(x.type==='typ')return k.getThreadIdForUser(x.from);return null;}g.subscribe([h.getArbiterType('typ'),h.getArbiterType('ttyp')],function(x,y){var z=y.obj,aa=w(z);if(aa){var ba=i.getIDForUser(z.from);if(z.st==l.TYPING){p[aa]=p[aa]||{};var ca=p[aa][ba];p[aa][ba]=Date.now();if(!o)o=m(t,3000);!ca&&v(aa);}else if(z.st==l.INACTIVE)u(aa,ba);}});j.subscribe('update-typing-state',function(x,y){var z=y.payload_source;if(z!=n.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE)return;var aa=y.actions;if(!aa||!aa.length)return;var ba=n.MercuryActionType.USER_GENERATED_MESSAGE;aa.forEach(function(ca){if(ca.action_type==ba&&ca.author!=i.user)u(ca.thread_id,ca.author);});});e.exports=r;});
__d("ChatTabIndicatorController",["ArbiterMixin","DOM","MercuryParticipants","MercuryRoger","MercuryDelayedRoger","MercuryThreads","MercuryTypingReceiver","copyProperties","tx","date-extensions","MercuryConfig","MercuryConstants"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DOM'),i=b('MercuryParticipants'),j=b('MercuryRoger'),k=b('MercuryDelayedRoger'),l=b('MercuryThreads'),m=b('MercuryTypingReceiver'),n=b('copyProperties'),o=b('tx');b('date-extensions');var p=c('MercuryConfig'),q=c('MercuryConstants'),r=[];function s(t){this._threadID=t;this._canonicalUser=l.getCanonicalUserInThread(t);r.push(this);}n(s.prototype,g,{destroy:function(){r.remove(this);},setLastMessage:function(t){this._lastMsg=t;this._handleStateChange();},_informStateChanged:function(t){if(t.activity=='none'&&this._currentActivity=='none')return;this._currentActivity=t.activity;this.inform('state-changed',t);},_notifySentFrom:function(){var t=q.MercurySourceType,u,v,w=this._lastMsg.location_text;if(w){u=o._("Sent from {location}",{location:w});v='sentFromMobile';}else switch(this._lastMsg.source){case t.CHAT_ORCA:case t.TITAN_ORCA:u=h.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},"Sent from Messenger");v='sentFromMobile';break;case t.MOBILE:case t.CHAT_IPHONE:case t.TITAN_API_MOBILE:case t.TITAN_WAP:u=h.create('a',{href:'/mobile','class':'fcg',target:'_blank'},"Sent from Mobile");v='sentFromMobile';break;case t.EMAIL:case t.TITAN_EMAIL_REPLY:u="Sent from email";v='sentFromEmail';break;default:this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:v,text:u});},_notifySeenTimestamp:function(t){var u=j.getSeenTimestamp(this._threadID,t[0])*.001,v=Date.now()*.001,w=p['24h_times']?'H:i':'g:i A';if(u<v-518400){w='M j';}else if(u<v-86400)w='D '+w;var x=Date.format(w,u);this._informStateChanged({activity:'seen-timestamp',text:o._("Seen {timestamp}",{timestamp:x})});},_notifySeenBy:function(t){var u=this._lastMsg,v=true;i.getMulti(t,function(w){v=false;if(this._lastMsg!=u)return;var x=l.getThreadMetaNow(this._threadID),y=x?x.participants.length:0,z=t.length+(u.author!=i.user),aa,ba=false;if(y>2&&z>=y-1){aa="Seen by everyone";}else if(t.length==1){aa=o._("Seen by {user}",{user:w[t[0]].short_name});}else if(t.length==2){aa=o._("Seen by {user1}, {user2}",{user1:w[t[0]].short_name,user2:w[t[1]].short_name});}else if(t.length==3){aa=o._("Seen by {user1}, {user2}, {user3}",{user1:w[t[0]].short_name,user2:w[t[1]].short_name,user3:w[t[2]].short_name});}else if(t.length>3){var ca=Object.keys(w).length-2,da=o._("{num} more",{num:ca}),ea=h.create('span',{className:'more'},da);aa=h.tx._("Seen by {user1}, {user2}, {=num more link}",{user1:w[t[0]].short_name,user2:w[t[1]].short_name,'=num more link':ea});ba=true;}this._informStateChanged({activity:'seen-by',text:aa,seenBy:t,tooltip:ba});}.bind(this));v&&this._informStateChanged({activity:'none'});},_notifyTyping:function(t){var u=this._lastMsg,v=true;i.getMulti(t,function(w){v=false;if(this._lastMsg!=u)return;if(this._canonicalUser||p.ChatMultiTypGK){var x=l.getThreadMetaNow(this._threadID),y=x?x.participants.length:0,z,aa=false;if(y>2&&t.length>=y-1){z="Everyone is typing...";}else if(t.length==1){z=o._("{name} is typing...",{name:w[t[0]].short_name});}else if(t.length==2){z=o._("{user1} and {user2} are typing...",{user1:w[t[0]].short_name,user2:w[t[1]].short_name});}else if(t.length==3){z=o._("{user1}, {user2}, and {user3} are typing...",{user1:w[t[0]].short_name,user2:w[t[1]].short_name,user3:w[t[2]].short_name});}else if(t.length>3){var ba=Object.keys(w).length-2,ca=o._("{num} more",{num:ba}),da=h.create('a',{href:'#'},ca);z=h.tx._("{user1}, {user2}, and {=num more link} are typing...",{user1:w[t[0]].short_name,user2:w[t[1]].short_name,'=num more link':da});aa=true;}this._informStateChanged({activity:'typing',text:z,typing:t,tooltip:aa});}}.bind(this));v&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var t=q.MercuryActionType.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==t){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=i.user){this._notifySentFrom();return;}var u=k.getSeenBy(this._threadID,true);if(u.length)if(this._canonicalUser){this._notifySeenTimestamp(u);return;}else{this._notifySeenBy(u);return;}this._informStateChanged({activity:'none'});}});m.subscribe('state-changed',function(t,u){r.forEach(function(v){var w=u[v._threadID];if(w!==undefined){v._typing=w;v._handleStateChange();}});});k.subscribe('state-changed',function(t,u){r.forEach(function(v){u[v._threadID]&&v._handleStateChange();});});e.exports=s;});
__d("ChatTabIndicatorLine",["ChatTabIndicatorController","CSS","DOM","DOMQuery","MercuryParticipants","Tooltip","copyProperties","csx"],function(a,b,c,d,e,f){var g=b('ChatTabIndicatorController'),h=b('CSS'),i=b('DOM'),j=b('DOMQuery'),k=b('MercuryParticipants'),l=b('Tooltip'),m=b('copyProperties'),n=b('csx');function o(p,q,r){this._typingIndicator=q;this._messagesView=r;this._controller=new g(p);this._subscription=this._controller.subscribe('state-changed',this._handleStateChanged.bind(this));}m(o.prototype,{destroy:function(){this._setClass(null);this._subscription.unsubscribe();this._controller.destroy();},setLastMessage:function(p){this._controller.setLastMessage(p);},_handleStateChanged:function(p,q){var r=this._messagesView.isScrolledToBottom();this._rerender(q);r&&this._messagesView.scrollToBottom();},_rerender:function(p){if(p.activity=='none'){this._setClass(null);return;}var q=i.find(this._typingIndicator,"._9q");if(p.text){i.setContent(q,p.text);}else i.empty(q);if(p.activity.substring(0,4)=='seen'){this._setClass('seen');if(p.activity=='seen-by'&&p.tooltip)k.getMulti(p.seenBy,function(r){var s=i.create('div'),t=0;for(var u in r)if(t++>=2){var v=i.create('div');i.setContent(v,r[u].name);i.appendContent(s,v);}var w=j.find(this._typingIndicator,'span.more');l.set(w,s,'above','center');}.bind(this));}else this._setClass(p.activity);},_setClass:function(p){if(this._lastClass===p)return;this._lastClass&&h.removeClass(this._typingIndicator,this._lastClass);p&&h.addClass(this._typingIndicator,p);this._lastClass=p;}});e.exports=o;});
__d("MercuryMessageRenderer",["MercuryAttachmentRenderer","CSS","DOM","DOMQuery","HTML","htmlHyperlink","MercuryEmoji","MercuryParticipants","Tooltip","tx","MercuryConstants"],function(a,b,c,d,e,f){var g=b('MercuryAttachmentRenderer'),h=b('CSS'),i=b('DOM'),j=b('DOMQuery'),k=b('HTML'),l=b('htmlHyperlink'),m=b('MercuryEmoji'),n=b('MercuryParticipants'),o=b('Tooltip'),p=c('MercuryConstants'),q=b('tx'),r={renderTooltipFlyout:function(ha,ia){ia.forEach(function(ja){var ka=i.create('div');i.setContent(ka,ja.name);i.appendContent(ha,ka);});},renderLogMessage:function(ha,ia,ja,ka){u(ha,ka);v(ia,ka);w(ja,ka);},formatMessageBody:function(ha,ia,ja){var ka=(ha||'').replace(/\s+$/,'');if(!ia)return t(ka,false,ja);var la=Object.keys(ia).map(function(oa){return window.parseInt(oa);}).sort(function(oa,pa){return oa-pa;}),ma=[],na=0;la.forEach(function(oa){var pa=ka.slice(na,oa);if(pa)ma.push(t(pa,false,ja));na=oa+ia[oa].length;var qa=ka.slice(oa,na);if(qa)ma.push(t(qa,true,ja));});if(na<ka.length)ma.push(t(ka.slice(na),false,ja));return ma.length===0?null:ma.length===1?ma[0]:i.create('span',{},ma);}};function s(ha,ia){var ja=ha.replace(/\r\n?/g,'\n').split(/\n{2,}/),ka=[];for(var la=0;la<ja.length;la++){var ma=ja[la];if(ma.length){ka.push('<p>');ka.push(ia(ma));ka.push('</p>');}}return ka.join('');}function t(ha,ia,ja){var ka=null;if(ha.length===0&&!ia)return ka;function la(ma){return l(ma,m.htmlEmojiAndEmote,null,true);}ka=ja?s(ha,la):la(ha);if(ia)return i.create('span',{className:'highlight'},k(ka));return k(ka);}function u(ha,ia){var ja='';switch(ia.log_message_type){case p.MercuryLogMessageType.SUBSCRIBE:ja='mercurySubscribeIcon';break;case p.MercuryLogMessageType.UNSUBSCRIBE:ja='mercuryUnsubscribeIcon';break;case p.MercuryLogMessageType.THREAD_NAME:ja='mercuryThreadNameIcon';break;case p.MercuryLogMessageType.THREAD_IMAGE:ja='mercuryThreadImageIcon';break;case p.MercuryLogMessageType.VIDEO_CALL:var ka=ia.log_message_data.answered;if(ka||ga(ia)){ja='mercuryVideoCallIcon';}else ja='mercuryMissedVideoCallIcon';break;case p.MercuryLogMessageType.SERVER_ERROR:ja='mercuryErrorIcon';break;}h.addClass(ha,ja);}function v(ha,ia){switch(ia.log_message_type){case p.MercuryLogMessageType.SUBSCRIBE:da(ha,ia);break;case p.MercuryLogMessageType.UNSUBSCRIBE:ea(ha,ia);break;case p.MercuryLogMessageType.VIDEO_CALL:if(ga(ia)){x(ha,ia);}else y(ha,ia);break;case p.MercuryLogMessageType.THREAD_NAME:z(ha,ia);break;case p.MercuryLogMessageType.THREAD_IMAGE:aa(ha,ia);break;case p.MercuryLogMessageType.SERVER_ERROR:fa(ha,ia);break;}}function w(ha,ia){var ja=ia.log_message_type;if(ja==p.MercuryLogMessageType.THREAD_IMAGE){var ka=ia.log_message_data.image;ka&&i.setContent(ha,g.renderPreview(ka));h.show(ha);}}var x=function(ha,ia){n.get(ia.author,function(ja){var ka=ja.short_name,la;switch(ia.log_message_data.event_name){case 'installing':la=i.tx._("{firstname} is setting up video calling...",{firstname:ka});break;case 'installed':la=i.tx._("{firstname} finished setting up video calling.",{firstname:ka});break;case 'install_canceled':la=i.tx._("You canceled the video calling installation. ",{firstname:ka});break;}if(la)i.setContent(ha,la);});},y=function(ha,ia){var ja=ia.log_message_data.caller,ka=ia.log_message_data.callee,la=[ja,ka];n.getMulti(la,function(ma){if(ja==n.user){var na=ma[ka].short_name,oa;if(ia.log_message_data.answered){oa=i.tx._("You called {firstname}.",{firstname:na});}else oa=i.tx._("{firstname} missed a call from you. ",{firstname:na});}else{var pa=ma[ja].short_name;if(ia.log_message_data.answered){oa=i.tx._("{firstname} called you.",{firstname:pa});}else oa=i.tx._("You missed a call from {firstname}. ",{firstname:pa});}i.setContent(ha,oa);});},z=function(ha,ia){var ja=ia.log_message_data.name,ka=i.create('b',{},ja);if(ia.author==n.user){if(ja){i.setContent(ha,i.tx._("You named the conversation: {name}.",{name:ka}));}else i.setContent(ha,i.tx._("You removed the conversation name."));}else n.get(ia.author,function(la){var ma,na=ba(la);if(ja){ma=i.tx._("{actor} named the conversation: {name}.",{actor:na,name:ka});}else ma=i.tx._("{actor} removed the conversation name.",{actor:na});i.setContent(ha,ma);});},aa=function(ha,ia){if(ia.author==n.user){if(ia.log_message_data.image){i.setContent(ha,i.tx._("You changed the conversation picture."));}else i.setContent(ha,i.tx._("You removed the conversation picture."));}else n.get(ia.author,function(ja){var ka=ba(ja),la;if(ia.log_message_data.image){la=i.tx._("{actor} changed the conversation picture.",{actor:ka});}else la=i.tx._("{actor} removed the conversation picture.",{actor:ka});i.setContent(ha,la);});},ba=function(ha){if(ha.href)return i.create('a',{href:ha.href},ha.name);return ha.name;},ca=function(ha){var ia=ha.indexOf(n.user);if(ia>0)return ha.splice(ia,1).concat(ha);return ha;},da=function(ha,ia){var ja=ca(ia.log_message_data.added_participants),ka=null,la;if(ja.length==1){ka=[ia.author,ja[0]];n.getMulti(ka,function(ma){if(ia.author==n.user){la=i.tx._("You added {subscriber1}.",{subscriber1:ba(ma[ja[0]])});}else if(ja[0]==n.user){la=i.tx._("{actor} added you.",{actor:ba(ma[ia.author])});}else la=i.tx._("{actor} added {subscriber1}.",{actor:ba(ma[ia.author]),subscriber1:ba(ma[ja[0]])});i.setContent(ha,la);});}else if(ja.length==2){ka=[ia.author].concat(ja);n.getMulti(ka,function(ma){if(ia.author==n.user){la=i.tx._("You added {subscriber1} and {subscriber2}.",{subscriber1:ba(ma[ja[0]]),subscriber2:ba(ma[ja[1]])});}else if(ja[0]==n.user){la=i.tx._("{actor} added you and {subscriber2}.",{actor:ba(ma[ia.author]),subscriber2:ba(ma[ja[1]])});}else la=i.tx._("{actor} added {subscriber1} and {subscriber2}.",{actor:ba(ma[ia.author]),subscriber1:ba(ma[ja[0]]),subscriber2:ba(ma[ja[1]])});i.setContent(ha,la);});}else if(ja.length==3){ka=[ia.author].concat(ja);n.getMulti(ka,function(ma){if(ia.author==n.user){la=i.tx._("You added {subscriber1}, {subscriber2} and {subscriber3}.",{subscriber1:ba(ma[ja[0]]),subscriber2:ba(ma[ja[1]]),subscriber3:ba(ma[ja[2]])});}else if(ja[0]==n.user){la=i.tx._("{actor} added you, {subscriber2} and {subscriber3}.",{actor:ba(ma[ia.author]),subscriber2:ba(ma[ja[1]]),subscriber3:ba(ma[ja[2]])});}else la=i.tx._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",{actor:ba(ma[ia.author]),subscriber1:ba(ma[ja[0]]),subscriber2:ba(ma[ja[1]]),subscriber3:ba(ma[ja[2]])});i.setContent(ha,la);});}else{ka=[ia.author].concat(ja);n.getMulti(ka,function(ma){var na=i.tx._("{num} more",{num:ja.length-2}),oa=i.create('span',{className:'more'},na),pa=i.create('div');r.renderTooltipFlyout(pa,ja.slice(2).map(function(ra){return ma[ra];}));if(ia.author==n.user){la=i.tx._("You added {subscriber1}, {subscriber2} and {more_people}.",{subscriber1:ba(ma[ja[0]]),subscriber2:ba(ma[ja[1]]),more_people:oa});}else if(ja[0]==n.user){la=i.tx._("{actor} added you, {subscriber2} and {more_people}.",{actor:ba(ma[ia.author]),subscriber2:ba(ma[ja[1]]),more_people:oa});}else la=i.tx._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",{actor:ba(ma[ia.author]),subscriber1:ba(ma[ja[0]]),subscriber2:ba(ma[ja[1]]),more_people:oa});i.setContent(ha,la);var qa=j.find(ha,'span.more');o.set(qa,pa,'above','center');});}},ea=function(ha,ia){n.get(ia.author,function(ja){var ka;if(ia.author==n.user){ka=i.tx._("You left the conversation.");}else ka=i.tx._("{actor} left the conversation.",{actor:ba(ja)});i.setContent(ha,ka);});},fa=function(ha,ia){var ja="We were unable to fetch previous messages in this conversation.";i.setContent(ha,ja);},ga=function(ha){return ha.log_message_data.event_name==='installing'||ha.log_message_data.event_name==='install_canceled';};e.exports=r;});
__d("ChatTabMessagesView",["event-extensions","Arbiter","ArbiterMixin","MercuryAttachmentRenderer","ChannelConstants","ChatConfig","ChatTabIndicatorLine","ChatVisibility","CSS","DOM","Env","MercuryMessages","MercuryThreadMetadataRenderer","MercuryThreadMetadataRawRenderer","MercuryThreads","MercuryMessageRenderer","MercuryParticipants","MercuryThreadInformer","Tooltip","VideoCallCore","copyProperties","isRTL","tx","date-extensions","ChatTabTemplates","MercuryConstants"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('MercuryAttachmentRenderer'),j=b('ChannelConstants'),k=b('ChatConfig'),l=b('ChatTabIndicatorLine'),m=b('ChatVisibility'),n=b('CSS'),o=b('DOM'),p=b('Env'),q=b('MercuryMessages'),r=b('MercuryThreadMetadataRenderer'),s=b('MercuryThreadMetadataRawRenderer'),t=b('MercuryThreads'),u=b('MercuryMessageRenderer'),v=b('MercuryParticipants'),w=b('MercuryThreadInformer'),x=b('Tooltip'),y=b('VideoCallCore'),z=c('ChatTabTemplates'),aa=c('MercuryConstants'),ba=b('copyProperties'),ca=b('isRTL'),da=b('tx');b('date-extensions');function ea(pa){return Date.format(k.get('24h_times')?'H:i':'g:ia',pa/1000);}function fa(pa){var qa=z[':fb:chat:conversation:message-group'].build();qa.setNodeContent('timestamp',ea(pa.timestamp));v.get(pa.author,function(ra){var sa=qa.getNode('profileLink');sa.href=ra.href;var ta=ra.fbid==p.user?"You":ra.name;x.set(sa,ta,'left');qa.setNodeProperty('profilePhoto','src',ra.image_src);});return qa;}function ga(pa){var qa=z[':fb:chat:conversation:message:event'].build();qa.setNodeContent('timestamp',ea(pa.timestamp));u.renderLogMessage(qa.getNode('icon'),qa.getNode('message'),qa.getNode('attachment'),pa);var ra=ha(pa);if(ra)o.appendContent(qa.getNode('message'),ra);return qa.getRoot();}function ha(pa){var qa,ra;if(pa.log_message_type==aa.MercuryLogMessageType.VIDEO_CALL)if(pa.log_message_data.event_name=='install_canceled'){qa=o.tx._("Retry setup and call back.");ra='callback_cancelinstall_link';return ia(qa,pa.thread_id,pa.log_message_data.to,ra);}else if(!pa.log_message_data.event_name&&pa.log_message_data.callee==v.user&&!pa.log_message_data.answered){qa=o.tx._("Call Back");ra='callback_link';return ia(qa,pa.thread_id,pa.log_message_data.caller.split(':')[1],ra);}return null;}function ia(pa,qa,ra,sa){if(y.isSupported()){var ta=!m.isOnline()||!y.availableForCall(ra),ua=o.create('a',{href:'#',className:'callBackLink'},pa);if(ta)n.hide(ua);ua.setAttribute('data-gt',JSON.stringify({videochat:'clicked_callback_link'}));Event.listen(ua,'click',function(){na.inform('video-call-clicked',{userID:ra,threadID:qa,clickSource:sa});});return ua;}return null;}function ja(pa){var qa=z[':fb:mercury:chat:message:forward'].build(),ra=qa.getNode('forwardText');if(ra){n.hide(qa.getRoot());r.renderTitanLink(pa.thread_id,qa.getNode('forwardLink'),n.show.bind(n,qa.getRoot()));if(pa.forward_count>1){o.appendContent(ra,da._("{count} forwarded messages",{count:pa.forward_count}));}else o.appendContent(ra,"1 forwarded message");}return qa.getRoot();}var ka=["January","February","March","April","May","June","July","August","September","October","November","December"];function la(pa){var qa=new Date();qa.setHours(0);qa.setMinutes(0);qa.setSeconds(0);qa.setMilliseconds(0);var ra=24*60*60*1000,sa=qa.getTime()-pa.getTime();if(sa<=0){return "Today";}else if(sa<ra)return "Yesterday";return da._("{month} {date}",{month:ka[pa.getMonth()],date:pa.getDate()});}var ma=[];function na(pa,qa,ra,sa,ta){this.threadID=pa;this.sheetController=qa;this.scrollContainer=ra;this.conversationElem=sa;this.messageElements={};this.messageGroup=null;this.prevMessage=null;var ua=aa.MercuryThreadlistConstants.MESSAGE_TIMESTAMP_THRESHOLD;this._olderTimestamp=(new Date()).getTime()-ua;ma.push(this);this._subscription=g.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this));Event.listen(this.scrollContainer,'scroll',function(){if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}}.bind(this));if(ta)this.indicatorLine=new l(this.threadID,ta,this);q.getThreadMessagesRange(this.threadID,0,aa.MercuryThreadlistConstants.RECENT_MESSAGES_LIMIT,Function.prototype);this.rerender();}ba(na,h);ba(na.prototype,{destroy:function(){o.empty(this.conversationElem);this._subscription.unsubscribe();ma.remove(this);this.indicatorLine&&this.indicatorLine.destroy();this.destroyed=true;},_appendMessage:function(pa){if(pa==this.prevMessage)return;var qa=aa.MercuryThreadlistConstants,ra=qa.GROUPING_THRESHOLD,sa=pa.action_type==aa.MercuryActionType.LOG_MESSAGE&&pa.log_message_type==aa.MercuryLogMessageType.SERVER_ERROR;if(pa.is_cleared)return;var ta=null;if(this.prevMessage)ta=new Date(this.prevMessage.timestamp);var ua=new Date(pa.timestamp);if(!sa&&(!ta||ta.getDate()!=ua.getDate()||ta.getMonth()!=ua.getMonth()||ta.getFullYear()!=ua.getFullYear())){var va=z[':fb:chat:conversation:date-break'].build();o.setContent(va.getRoot(),la(ua));o.appendContent(this.conversationElem,va.getRoot());this.messageGroup=null;}if(pa.action_type==aa.MercuryActionType.LOG_MESSAGE){o.appendContent(this.conversationElem,ga(pa));this.messageGroup=null;this.prevMessage=pa;return;}if(!this.messageGroup||this.prevMessage.author!=pa.author||this.prevMessage.timestamp<pa.timestamp-ra){this.messageGroup=fa(pa);o.appendContent(this.conversationElem,this.messageGroup.getRoot());}var wa=this._renderSingleMessage(pa);this.messageElements[pa.message_id]=wa;o.appendContent(this.messageGroup.getNode('messages'),wa);this.prevMessage=pa;},rerender:function(){o.empty(this.conversationElem);this.messageElements={};this.messageGroup=null;this.prevMessage=null;var pa=q.getThreadMessagesSinceTimestamp(this.threadID,this._olderTimestamp);this._appendMessages(pa);},update:function(pa){for(var qa in pa){var ra=this.messageElements[qa];if(ra){var sa=this._renderSingleMessage(q.getMessagesFromIDs([qa])[0]);this.messageElements[qa]=sa;o.replace(ra,sa);}}},_appendMessages:function(pa){var qa=this.isScrolledToBottom();pa.forEach(this._appendMessage.bind(this));this.indicatorLine&&this.indicatorLine.setLastMessage(this.prevMessage);if(k.get('should_show_orca_promotion'))this.sheetController.displayMessengerPromoTabSheet(this.prevMessage);if(qa){this.scrollToBottom();}else{this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}},isScrolledToBottom:function(){var pa=this.scrollContainer;return pa.scrollTop+pa.clientHeight>=pa.scrollHeight;},scrollToBottom:function(){this.scrollContainer.scrollTop=this.scrollContainer.scrollHeight;},_renderSingleMessage:function(pa){var qa=z[':fb:chat:conversation:message'].render();if(pa.subject){var ra=z[':fb:chat:conversation:message:subject'].render();o.setContent(ra,pa.subject);o.appendContent(qa,ra);}if(pa.body.substr(0,4)=='?OTR'){o.setContent(qa,"[encrypted message]");n.addClass(qa,'cyphertext');}else{n.addClass(qa,ca(pa.body)?'direction_rtl':'direction_ltr');o.appendContent(qa,u.formatMessageBody(pa.body));}if(pa.has_attachment)this._appendMessageAttachments(qa,pa);if(pa.forward_count)o.appendContent(qa,ja(pa));var sa=s.renderStatusIndicator(pa.status,q.resendMessage.shield(q,pa));if(sa){n.addClass(qa,'errorStatus');var ta=z[':fb:chat:conversation:message:status'].build();o.appendContent(ta.getNode('message'),qa);o.appendContent(ta.getNode('status'),sa);return ta.getRoot();}return qa;},_appendMessageAttachments:function(pa,qa){var ra=aa.MercuryAttachmentType,sa=qa.attachments;for(var ta=0,ua=sa.length;ta<ua;++ta){var va=sa[ta],wa=va.attach_type,xa=va.share_data_type;if(wa==ra.ERROR)o.appendContent(pa,i.renderError(va));if(wa==ra.FILE)o.appendContent(pa,i.renderFileLink(va));var ya=null,za;if(wa==ra.SHARE&&xa==aa.MercurySupportedShareType.FB_VIDEO){ya=i.renderVideoThumb(va);za=o.find(ya,'img');Event.listen(za,'load',this._thumbLoaded.shield(this,za));}else if(wa==ra.SHARE&&(xa==aa.MercurySupportedShareType.FB_MUSIC_ALBUM||xa==aa.MercurySupportedShareType.FB_SONG)){ya=i.renderMusic(va);za=o.find(ya,'img');Event.listen(za,'load',this._thumbLoaded.shield(this,za));}else if(wa==ra.SHARE&&(xa==aa.MercurySupportedShareType.EXTERNAL||xa==aa.MercurySupportedShareType.FB_TEMPLATE)){ya=i.renderExternalLink(va);za=o.find(ya,'img');Event.listen(za,'load',this._thumbLoaded.shield(this,za));}else if(va.preview_url){v.get(qa.author,function(ab){var bb=v.getUserID(ab.id);ya=i.renderPreview(va,0,null,qa,ab,bb);za=o.find(ya,'img');Event.listen(za,'load',this._thumbLoaded.shield(this,za));}.bind(this));}else if(wa==ra.SHARE)ya=i.renderShareLink(va);if(ya)o.appendContent(pa,ya);}},_thumbLoaded:function(pa){var qa=this.scrollContainer.scrollTop+this.scrollContainer.clientHeight;if(qa+pa.offsetHeight>=this.scrollContainer.scrollHeight)this.scrollToBottom();}});w.subscribe('messages-reordered',function(pa,qa){ma.forEach(function(ra){qa[ra.threadID]&&ra.rerender();});});w.subscribe('messages-updated',function(pa,qa){ma.forEach(function(ra){qa[ra.threadID]&&ra.update(qa[ra.threadID]);});});w.subscribe('messages-received',function(pa,qa){ma.forEach(function(ra){var sa=qa[ra.threadID];sa&&ra._appendMessages(sa);});});g.subscribe(j.getArbiterType('chat_event'),function(pa,qa){if(oa(qa.obj)){var ra=(p.user==qa.obj.from)?qa.obj.to:qa.obj.from,sa=t.getThreadIdForUser(ra),ta=ma.filter(function(wa){return wa.threadID===sa;});if(ta.length>0){var ua=ta[0],va=q.constructLogMessageObject(aa.MercurySourceType.CHAT_WEB,sa,aa.MercuryLogMessageType.VIDEO_CALL,qa.obj);va.author='fbid:'+qa.obj.from;ua._appendMessages([va]);}}});function oa(pa){return (pa.event_name==='installing'||pa.event_name==='install_canceled');}e.exports=na;});
__d("ChatTabSheetPolicy",[],function(a,b,c,d,e,f){var g={canReplaceOpenSheet:function(h,i){if(h.getType()==i.getType())return false;if(h.isPermanent()&&!i.isPermanent())return false;return true;}};e.exports=g;});
__d("ChatTabSheetView",["event-extensions","Animation","ChatTabSheetPolicy","CSS","DOM","Style","Vector","copyProperties","ChatTabTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('ChatTabSheetPolicy'),i=b('CSS'),j=b('DOM'),k=b('Style'),l=b('Vector'),m=b('copyProperties'),n=c('ChatTabTemplates'),o=5000,p=function(q,r,s){this._threadID=q;this._rootElement=r;this._tabMainElement=s;this._openSheet=null;};m(p.prototype,{destroy:function(){j.empty(this._rootElement);},_openCommon:function(q,r){if(this._openSheet&&!h.canReplaceOpenSheet(this._openSheet,q))return;this.clear(function(){this._openSheet=q;var s=n[':fb:mercury:chat:tab-sheet:loading'].build().getRoot();j.setContent(this._rootElement,s);i.show(s);i.show(this._rootElement);q.render();if(r){i.addClass(this._tabMainElement,'sheetSlide');var t=l.getElementDimensions(this._rootElement).y;k.set(this._rootElement,'bottom',t+'px');this._animation=new g(this._rootElement).to('bottom',0).duration(150).ease(g.ease.both).ondone(function(){i.removeClass(this._tabMainElement,'sheetSlide');}.bind(this)).go();}if(!q.isPermanent()){var u=o;if(q.getCloseTimeout)u=q.getCloseTimeout();this._sheetCloseHandler=this.close.bind(this,q).defer(u,false);if(q.timeoutCanBeReset)q.setResetTimeoutCallback(this.resetTimeout.bind(this));}}.bind(this));},resetTimeout:function(q,r){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=this.close.bind(this,q).defer(r,false);},set:function(q){return this._openCommon(q,false);},open:function(q){return this._openCommon(q,true);},close:function(q,r){if(this._openSheet!=q)return;if(!this._openSheet){r&&r();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}i.addClass(this._tabMainElement,'sheetSlide');var s=l.getElementDimensions(this._rootElement).y;this._animation=new g(this._rootElement).to('bottom',s+'px').duration(100).ease(g.ease.begin).ondone(function(){j.empty(this._rootElement);i.hide(this._rootElement);i.removeClass(this._tabMainElement,'sheetSlide');this._openSheet=null;r&&r();}.bind(this)).go();},clear:function(q){this.close(this._openSheet,q);}});e.exports=p;});
__d("MercuryTypeahead",["event-extensions","ArbiterMixin","DOM","Env","Input","Tokenizer","Typeahead","TypeaheadCore","copyProperties","MercuryTypeaheadTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('DOM'),i=b('Env'),j=b('Input'),k=b('Tokenizer'),l=b('Typeahead'),m=b('TypeaheadCore'),n=b('copyProperties'),o=c('MercuryTypeaheadTemplates'),p=function(q,r){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._dataSource=q;this._view=r;};n(p.prototype,g);n(p.prototype,{setPlaceholder:function(q){this._placeholder=q;return this;},setExcludedParticipants:function(q){this._exclusions=[];q.forEach(function(r){var s=r.indexOf(':');if(r.substr(0,s)=='fbid')this._exclusions.push(r.substr(s+1));}.bind(this));return this;},setViewNodeID:function(q){this._viewNodeID=q;},setViewOption:function(q,r){this._viewOptions[q]=r;},addTokenizerBehavior:function(q){this._tokenizerBehaviors.push(q);},build:function(q){if(this._domElement)return;var r=o[':fb:mercury:tokenizer'].build(),s=o[':fb:mercury:typeahead'].build();this._domElement=r.getRoot();h.appendContent(this._domElement,s.getRoot());var t=s.getNode('textfield');j.setPlaceholder(t,this._placeholder);t.setAttribute('data-placeholder',this._placeholder);var u={node_id:this._viewNodeID,ctor:this._view,options:this._viewOptions},v={ctor:m,options:{setValueOnSelect:true}};this._typeahead=new l(this._dataSource,u,v,s.getRoot());this._typeahead.init();var w={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new k(this._domElement,this._typeahead);this._tokenizer.init(r.getNode('tokenarea'),'participants',[],w);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],function(){this.inform('tokens-changed');}.bind(this));Event.listen(t,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));Event.listen(this._domElement,'click',this.focus.bind(this));},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var q=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(r){q.push('fbid:'+r);});return q;},getTokens:function(){var q=[];if(this._tokenizer)q=this._tokenizer.getTokens();return q;},getTokenizer:function(){return this._tokenizer;},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);}});e.exports=p;});
__d("ChatAddFriendsTabSheetRawRenderer",["event-extensions","DOM","ContextualTypeaheadView","MercuryTypeahead","tx","MercuryDataSourceWrapper","ChatTabTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOM'),h=b('ContextualTypeaheadView'),i=b('MercuryTypeahead'),j=c('MercuryDataSourceWrapper').source,k=c('ChatTabTemplates'),l=b('tx'),m={render:function(n,o,p,q,r){var s=k[':fb:mercury:chat:tab-sheet:add-friends'].build(),t=new i(j,h);t.setExcludedParticipants(q.participants);t.setPlaceholder("Enter a friend's name");t.build();g.replace(s.getNode('participantsTypeahead'),t.getElement());g.setContent(p,s.getRoot());t.focus();var u=function(){var v=t.getSelectedParticipantIDs();if(v.length)r(v);o.close(n);};Event.listen(s.getNode('doneButton'),'click',u);}};e.exports=m;});
__d("MultiChatController",["Arbiter","AsyncSignal","copyProperties","Form","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncSignal'),i=b('copyProperties'),j=b('Form'),k=b('MercuryMessages'),l=b('MercuryServerRequests'),m=b('MercuryThreads');function n(){}i(n,{subscribe:function(o,p){o.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(o,p);}.bind(this));},createGroupThreadFromChooserDialog:function(o,p){var q=j.serialize(o.getRoot()),r=JSON.parse(q.profileChooserItems),s=[];for(var t in r)if(r[t])s.push(t);var u=n.createThreadForFBIDs(s);l.subscribe('update-thread-ids',function(v,w){for(var x in w)if(w[x]==u)new h('/ajax/groups/chat/log',{group_id:p,message_id:x}).send();});o.hide();},createThreadForTokens:function(o){if(!o.length)return;var p;if(o.length==1){p='user:'+o[0].split(':')[1];}else p='root:'+k.generateNewClientMessageID((new Date()).getTime());m.createNewLocalThread(p,o);g.inform('chat/open-tab',{thread_id:p});return p;},createThreadForFBIDs:function(o){var p=[];for(var q=0;q<o.length;q++)p.push("fbid:"+o[q]);return n.createThreadForTokens(p);}});e.exports=n;});
__d("ChatAddFriendsTabSheet",["ChatTabSheetView","ChatAddFriendsTabSheetRawRenderer","MercuryMessages","MultiChatController","MercuryServerRequests","MercuryThreads","copyProperties","MercuryConstants"],function(a,b,c,d,e,f){var g=b('ChatTabSheetView'),h=b('ChatAddFriendsTabSheetRawRenderer'),i=b('MercuryMessages'),j=b('MultiChatController'),k=b('MercuryServerRequests'),l=b('MercuryThreads'),m=b('copyProperties'),n=c('MercuryConstants');function o(r,s,t){this._threadID=r;this._rootElement=s;this._sheetView=t;}m(o.prototype,{render:function(){l.getThreadMeta(this._threadID,function(r){var s=r.is_canonical_user?p:q;h.render(this,this._sheetView,this._rootElement,r,s.curry(r));}.bind(this));},isPermanent:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);}});function p(r,s){var t=r.participants;j.createThreadForTokens(t.concat(s));}function q(r,s){var t=r.thread_id;if(l.isEmptyLocalThread(t)){l.addParticipantsToThreadLocally(t,s);}else i.sendMessage(i.constructLogMessageObject(n.MercurySourceType.CHAT_WEB,t,n.MercuryLogMessageType.SUBSCRIBE,{added_participants:s}));}e.exports=o;});
__d("ChatAvailabilityTabSheetRawRenderer",["AvailableListConstants","GenderConst","CSS","DOM","ChatTabTemplates","MercuryConfig"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('GenderConst'),i=c('ChatTabTemplates'),j=b('CSS'),k=b('DOM'),l=c('MercuryConfig'),m={render:function(q,r,s){var t=i[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),u=null;switch(q){case g.ACTIVE:j.addClass(t.getRoot(),'active');u=n(s);break;case g.MOBILE:j.addClass(t.getRoot(),'mobile');u=o(s);break;case g.OFFLINE:u=p(s);break;}k.setContent(t.getNode('text'),u);k.setContent(r,t.getRoot());}};function n(q){return k.tx._("{name} is now available.",{name:q.firstName});}function o(q){return k.tx._("Your messages will be sent to {name}'s phone.",{name:q.firstName});}function p(q){switch(q.gender){case h.FEMALE_SINGULAR:case h.FEMALE_SINGULAR_GUESS:if(l.ChatControlLanguageChangeGK){return k.tx._("{name} isn't on chat, but you can still send her a message.",{name:q.firstName});}else return k.tx._("{name} is offline, but you can still send her a message.",{name:q.firstName});case h.MALE_SINGULAR:case h.MALE_SINGULAR_GUESS:if(l.ChatControlLanguageChangeGK){return k.tx._("{name} isn't on chat, but you can still send him a message.",{name:q.firstName});}else return k.tx._("{name} is offline, but you can still send him a message.",{name:q.firstName});default:if(l.ChatControlLanguageChangeGK){return k.tx._("{name} isn't on chat, but you can still send them a message.",{name:q.firstName});}else return k.tx._("{name} is offline, but you can still send them a message.",{name:q.firstName});}}e.exports=m;});
__d("ChatAvailabilityTabSheet",["Arbiter","AvailableList","AvailableListConstants","ChatAvailabilityTabSheetRawRenderer","ChatConfig","MercuryThreads","ShortProfiles","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChatAvailabilityTabSheetRawRenderer'),k=b('ChatConfig'),l=b('MercuryThreads'),m=b('ShortProfiles'),n=b('copyProperties');function o(p,q,r,s){this._handledAvailability=q;this._sheetView=s;this._rootElement=r;this._canonicalUser=l.getCanonicalUserInThread(p);if(this._canonicalUser){this._currentAvailability=i.ACTIVE;this._handleAvailabilityChange();g.subscribe(i.ON_AVAILABILITY_CHANGED,this._handleAvailabilityChange.bind(this));}}o.createSheets=function(p,q,r){var s={};if(k.get('roger.ui')){s[i.OFFLINE]=new o(p,i.OFFLINE,q,r);return s;}[i.ACTIVE,i.OFFLINE,i.MOBILE].forEach(function(t){s[t]=new o(p,t,q,r);});return s;};n(o.prototype,{render:function(){!this._canonicalUser;m.get(this._canonicalUser,j.render.curry(this._currentAvailability,this._rootElement));},isPermanent:function(){return false;},getType:function(){switch(this._handledAvailability){case i.ACTIVE:return 'availability_active_type';case i.MOBILE:return 'availability_mobile_type';case i.OFFLINE:return 'availability_offline_type';default:throw new Error("Invalid handled availability");}},getCloseTimeout:function(){return 5000;},_handleAvailabilityChange:function(){var p=h.get(this._canonicalUser);if(p==this._currentAvailability)return;this._currentAvailability=p;if(p==this._handledAvailability)this._sheetView.open(this);}});e.exports=o;});
__d("ChatNewMessagesTabSheet",["DOM","copyProperties","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('copyProperties'),i=c('ChatTabTemplates');function j(k,l,m){this._threadID=k;this._rootElement=l;this._sheetView=m;}h(j.prototype,{render:function(){var k=i[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(k.getNode('text'),g.tx._("Scroll down to see new messages."));g.setContent(this._rootElement,k.getRoot());},isPermanent:function(){return true;},getType:function(){return 'new_messages_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=j;});
__d("ChatNoRecipientsTabSheet",["DOM","MercuryParticipants","MercuryThreadInformer","MercuryThreads","copyProperties","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryParticipants'),i=b('MercuryThreadInformer'),j=b('MercuryThreads'),k=b('copyProperties'),l=c('ChatTabTemplates');function m(n,o,p){this._threadID=n;this._rootElement=o;this._sheetView=p;i.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}k(m.prototype,{render:function(){var n=l[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(n.getNode('text'),g.tx._("All recipients have left this conversation. Please close the stale tab."));g.setContent(this._rootElement,n.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){j.getThreadMeta(this._threadID,function(n){var o=h.user,p=n.participants.filter(function(q){return q!=o;});if(p.length<1){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=m;});
__d("ChatOfflineTabSheet",["event-extensions","ChatPrivacyActionController","ChatTabSheetView","ChatVisibility","CSS","DOM","JSLogger","MercuryParticipants","MercuryThreads","copyProperties","MercuryConfig","ChatTabTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ChatPrivacyActionController'),h=b('ChatTabSheetView'),i=b('ChatVisibility'),j=b('CSS'),k=b('DOM'),l=b('JSLogger'),m=b('MercuryParticipants'),n=b('MercuryThreads'),o=b('copyProperties'),o=b('copyProperties'),p=c('MercuryConfig'),q=c('ChatTabTemplates');function r(s,t,u){this._rootElement=t;this._sheetView=u;this._logger=l.create('blackbird');this._canonicalUser=n.getCanonicalUserInThread(s);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}o(r.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('offline_sheet_open_with_non_friend');return;}var s=q[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),t='fbid:'+this._canonicalUser;m.get(t,function(u){var v='fbChatGoOnlineLink',w=p.ChatControlLanguageChangeGK?k.tx._("turn on chat"):k.tx._("go online"),x=k.create('a',{href:'#',className:v},w),y;if(p.ChatControlLanguageChangeGK){y=k.tx._("To chat with {name} and other friends, {link}.",{name:u.short_name,link:x});}else y=k.tx._("You are now offline. To chat with {name} and other friends, {link}.",{name:u.short_name,link:x});k.setContent(s.getNode('text'),y);j.addClass(s.getRoot(),'chatOffline');k.setContent(this._rootElement,s.getRoot());Event.listen(this._rootElement,'click',function(event){if(j.hasClass(event.getTarget(),v)){if(i.isOnline())this._logger.error('tab_sheet_already_online');this._privacyActionController.togglePrivacy();this._logger.log('tab_sheet_go_online',{tab_id:this._canonicalUser});return false;}}.bind(this));}.bind(this));},_handlePrivacyChange:function(s){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(s){case g.OFFLINE:this._sheetView.open(this);break;case g.NORMAL:case g.BLOCKED:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'offline_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=r;});
__d("ChatUserBlockedTabSheet",["event-extensions","ChatPrivacyActionController","ChatTabSheetView","CSS","DOM","GenderConst","JSLogger","MercuryParticipants","MercuryThreads","copyProperties","tx","MercuryConfig","ChatTabTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ChatPrivacyActionController'),h=b('ChatTabSheetView'),i=b('CSS'),j=b('DOM'),k=b('GenderConst'),l=b('JSLogger'),m=b('MercuryParticipants'),n=b('MercuryThreads'),o=b('copyProperties'),p=c('MercuryConfig'),q=c('ChatTabTemplates'),r=b('tx');function s(t,u,v){this._rootElement=u;this._sheetView=v;this._logger=l.create('blackbird');this._canonicalUser=n.getCanonicalUserInThread(t);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}o(s.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('user_blocked_sheet_open_with_non_friend');return;}var t=q[':fb:mercury:chat:tab-sheet:user-blocked'].build(),u='fbid:'+this._canonicalUser;m.get(u,function(v){var w=null;switch(v.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:w=p.ChatControlLanguageChangeGK?r._("You turned off chat for {name} but you can still send her a message. ",{name:v.short_name}):r._("{name} sees you as offline on chat, but you can still send her a message. ",{name:v.short_name});break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:w=p.ChatControlLanguageChangeGK?r._("You turned off chat for {name} but you can still send him a message. ",{name:v.short_name}):r._("{name} sees you as offline on chat, but you can still send him a message. ",{name:v.short_name});break;default:w=p.ChatControlLanguageChangeGK?r._("You turned off chat for {name} but you can still send them a message. ",{name:v.short_name}):r._("{name} sees you as offline on chat, but you can still send them a message. ",{name:v.short_name});}j.setContent(t.getNode('text'),w);var x=p.ChatControlLanguageChangeGK?r._("Turn on chat for {name}?",{name:v.short_name}):r._("Go Online to {name}",{name:v.short_name});j.setContent(t.getNode('actionLink'),x);i.addClass(t.getRoot(),'blocked');j.setContent(this._rootElement,t.getRoot());Event.listen(t.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));}.bind(this));},_handlePrivacyChange:function(t){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(t){case g.BLOCKED:this._sheetView.open(this);break;case g.NORMAL:case g.OFFLINE:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=s;});
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatAvailabilityTabSheet","ChatMessengerPromoTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatTabSheetView","ChatUserBlockedTabSheet","copyProperties","MercuryThreads"],function(a,b,c,d,e,f){var g=b('ChatAddFriendsTabSheet'),h=b('ChatAvailabilityTabSheet'),i=b('ChatMessengerPromoTabSheet'),j=b('ChatNewMessagesTabSheet'),k=b('ChatNoRecipientsTabSheet'),l=b('ChatOfflineTabSheet'),m=b('ChatTabSheetView'),n=b('ChatUserBlockedTabSheet'),o=b('copyProperties'),p=b('MercuryThreads'),q=function(r,s,t){this._sheetView=new m(r,s,t);this._addFriendsTabSheet=new g(r,s,this._sheetView);this._userBlockedTabSheet=new n(r,s,this._sheetView);this._offlineTabSheet=new l(r,s,this._sheetView);this._messengerPromoTabSheet=new i(r,s,this._sheetView);this._newMessagesTabSheet=new j(r,s,this._sheetView);this._availabilityTabSheets=h.createSheets(r,s,this._sheetView);if(p.isMultichatThread(r))this._noRecipientsTabSheet=new k(r,s,this._sheetView);};o(q.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},openNewMessagesSheet:function(){this._newMessagesTabSheet.open();},closeNewMessagesSheet:function(){this._newMessagesTabSheet.close();},displayMessengerPromoTabSheet:function(r){this._messengerPromoTabSheet.displayPromo(r);},destroy:function(){this._sheetView.destroy();this._offlineTabSheet.destroy();this._userBlockedTabSheet.destroy();}});e.exports=q;});
__d("ChatTabView",["event-extensions","function-extensions","Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AvailableList","AvailableListConstants","ChatBehavior","ChatConfig","ChatContextualDialogController","ChatQuietLinks","ChatPrivacyActionController","MessagesEmoticonView","ChatTabMessagesView","ChatTabSheetController","ChatVisibility","CSS","Dialog","Dock","DOM","JSLogger","Keys","MercuryMessages","MercuryParticipants","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreadMetadataRawRenderer","MercuryThreads","MercuryTypingReceiver","NubController","Parent","PresencePrivacy","TextAreaControl","Tooltip","TypingIndicator","URI","UserAgent","VideoCallCore","copyProperties","setIntervalAcrossTransitions","tx","MercuryConfig","MercuryConstants","ChatTabTemplates"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('AvailableList'),l=b('AvailableListConstants'),m=b('ChatBehavior'),n=b('ChatConfig'),o=b('ChatContextualDialogController'),p=b('ChatQuietLinks'),q=b('ChatPrivacyActionController'),r=b('MessagesEmoticonView'),s=b('ChatTabMessagesView'),t=b('ChatTabSheetController'),u=b('ChatVisibility'),v=b('CSS'),w=b('Dialog'),x=b('Dock'),y=b('DOM'),z=b('JSLogger'),aa=b('Keys'),ba=b('MercuryMessages'),ca=b('MercuryParticipants'),da=b('MercuryServerRequests'),ea=b('MercuryThreadInformer'),fa=b('MercuryThreadMetadataRenderer'),ga=b('MercuryThreadMetadataRawRenderer'),ha=b('MercuryThreads'),ia=b('MercuryTypingReceiver'),ja=b('NubController'),ka=b('Parent'),la=b('PresencePrivacy'),ma=b('TextAreaControl'),na=b('Tooltip'),oa=b('TypingIndicator'),pa=b('URI'),qa=b('UserAgent'),ra=b('VideoCallCore'),sa=c('MercuryConfig'),ta=c('MercuryConstants'),ua=c('ChatTabTemplates'),va=b('copyProperties'),wa=b('setIntervalAcrossTransitions'),xa=b('tx'),ya=z.create('tab_view'),za={};function ab(jb,kb){var lb=y.create('div');kb=kb.filter(function(mb){return mb!=ca.user;});ca.getMulti(kb,function(mb){for(var nb in mb){var ob=mb[nb],pb=ua[':fb:mercury:chat:multichat-tooltip-item'].build();y.setContent(pb.getNode('name'),ob.name);var qb=ca.getUserID(nb),rb=qb&&k.get(qb)==l.ACTIVE;v.conditionShow(pb.getNode('icon'),rb);v.conditionClass(pb.getNode('name'),'tooltipItemWithIcon',rb);y.appendContent(lb,pb.getRoot());}na.set(jb,lb,'above','center');});}var bb={},cb=null,db=false;function eb(jb,kb,lb){if(lb){bb[jb]=kb;if(!cb)cb=wa(fb,600);}else{v.removeClass(kb,'highlightTitle');delete bb[jb];}}function fb(){for(var jb in bb){var kb=bb[jb];if(kb.parentNode){v.conditionClass(kb,'highlightTitle',db);}else delete bb[jb];}db=!db;if(!Object.keys(bb).length){clearInterval(cb);cb=null;}}function gb(jb){var kb=da.tokenizeThreadID(jb);switch(kb.type){case 'user':return ua[':fb:mercury:chat:user-tab'].build();case 'group':return ua[':fb:mercury:chat:group-tab'].build();}return ua[':fb:mercury:chat:multichat-tab'].build();}function hb(jb,kb){if(kb)da.ensureThreadIsFetched(kb);this._threadID=jb;this._eventListeners=[];this._tabTemplate=gb(jb);this._tabElem=this._tabTemplate.getRoot();if(!(this._getNode instanceof Function))ya.log('getnode_undefined',{is_getnode_set:!!this._getNode,is_prototype_set:!!hb.prototype,is_window:window==this,is_chat_tab_view:this instanceof hb,ctor_name:this.constructor&&this.constructor.name});this._sheetController=new t(this._threadID,this._getNode('sheet'),this._tabElem);this._contextualDialogController=new o(this._threadID,this._getNode('videoCallLink'));this._messagesView=null;var lb=this._getNode('conversationLink');if(lb){v.hide(lb);fa.renderTitanLink(jb,lb,v.show.bind(v,lb));}if(ha.isMultichatThread(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var mb=this._getCanonicalUserID();if(this._isTitleTextLinked())ca.get('fbid:'+mb,function(qb){if(qb.href){var rb=this._getNode('titlebarText');rb.setAttribute('href',qb.href);rb.removeAttribute('rel');v.removeClass(rb,'noLink');}}.bind(this));this._nubController=new ja().init(this._tabElem);ma.getInstance(this._getNode('input')).subscribe('resize',function(){this._nubController.flyoutContentChanged();}.bind(this));this._nubController.subscribe('resize',function(){this._emoticonsNode.style.left=(this._getNode('input').clientWidth+3)+'px';ma.getInstance(this._getNode('input')).update();}.bind(this));this._listen('closeButton','click',this._closeClicked);this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('addFriendLink','click',this._addFriendLinkClicked,true);this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);this._listen('clearWindowLink','click',this._clearHistory,true);this._listen('unsubscribeLink','click',this._unsubscribeLinkClicked,true);this._listen('videoCallLink','click',this._callClicked,true);this._listen('reportSpamLink','click',this._reportSpamClicked,true);this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._emoticonsNode=this._getNode('emoticons');this._emoticonView=new r(this._emoticonsNode,this._getNode('input'));if(qa.firefox()){this._listen('input','keypress',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._privacyLink=this._getNode('privacyLink');if(this._privacyLink){this._privacyActionController=new q(mb,this._updatePrivacyLink.bind(this));this._eventListeners.push(Event.listen(this._privacyLink,'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController)));}var nb=mb||(n.get('chat_multi_typ_send')&&ha.isMultichatThread(this._threadID));if(nb)da.getServerThreadID(this._threadID,function(qb){this._typingIndicator=new oa(mb,this._getNode('input'),'mercury-chat',null,qb);}.bind(this));var ob=this._getNode('muteGroupLink');if(ob){var pb=ha.getCanonicalGroupInThread(this._threadID);if(pb)ob.setAttribute('ajaxify',pa(ob.getAttribute('ajaxify')).addQueryData({id:pb}));}p.removeEmptyHrefs(this._tabElem);za[jb]=this;this.updateAvailableStatus();this.updateTab();}function ib(){for(var jb in za){za[jb].updateAvailableStatus();za[jb].updateMultichatTooltip();}}g.subscribe(['buddylist/availability-changed'],ib);la.subscribe(['privacy-changed','privacy-availability-changed'],ib);m.subscribe(m.ON_CHANGED,function(){for(var jb in za)ha.getThreadMeta(jb,function(kb){za[jb]._updateUnreadCount(kb);});});ia.subscribe('state-changed',function(jb,kb){for(var lb in kb){var mb=kb[lb]&&kb[lb].length,nb=za[lb];nb&&nb.showTypingIndicator(mb);}});ea.subscribe('threads-updated',function(jb,kb){for(var lb in za)kb[lb]&&za[lb].updateTab();});ea.subscribe('threads-deleted',function(jb,kb){for(var lb in za)hb.inform('thread-deleted',lb);});va(hb,h,{get:function(jb){return za[jb];}});va(hb.prototype,{getThreadID:function(){return this._threadID;},isVisible:function(){return v.shown(this._tabElem);},setVisibleState:function(jb,kb){var lb=v.shown(this._tabElem),mb=v.hasClass(this._tabElem,'opened');v.conditionShow(this._tabElem,jb);v.conditionClass(this._tabElem,'opened',kb);if(!(lb&&mb)&&jb&&kb){if(!this._messagesView)this._messagesView=new s(this._threadID,this._sheetController,this._getNode('chatConv'),this._getNode('conversation'),this._getNode('typingIndicator'));this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(lb&&mb&&!(jb&&kb))this._contextualDialogController.tabNotActive();},focus:function(){var jb=v.hasClass(this._tabElem,'opened')?'input':'dockButton';this._getNode(jb).focus();},isFocused:function(){var jb=document.activeElement;return ka.byClass(jb,'fbMercuryChatTab')===this._tabElem;},setInput:function(jb){this._getNode('input').value=jb;},insertBefore:function(jb){y.insertBefore(jb._tabElem,this._tabElem);},appendTo:function(jb){y.appendContent(jb,this._tabElem);},nextTabIs:function(jb){var kb=jb&&jb._tabElem;return this._tabElem.nextSibling==kb;},destroy:function(){y.remove(this._tabElem);this._emoticonView&&this._emoticonView.destroy();while(this._eventListeners.length)this._eventListeners.pop().remove();this._messagesView&&this._messagesView.destroy();this._sheetController.destroy();this._contextualDialogController.destroy();this._privacyActionController&&this._privacyActionController.destroy();delete za[this._threadID];x.unregisterNubController(this._nubController);},updateAvailableStatus:function(){var jb={active:false,mobile:false,greenphone:false},kb=this._getCanonicalUserID(),lb=true,mb=false;if(kb){var nb=k.get(kb);lb=!u.isOnline();mb=!la.allows(kb);jb.active=(nb===l.ACTIVE);if(n.get('sidebar_mobile_icon_green')){jb.greenphone=nb===l.MOBILE;}else jb.mobile=nb===l.MOBILE;this._updateCallLink(nb);}v.conditionClass(this._tabElem,'chatOffline',lb);v.conditionClass(this._tabElem,'blocked',!lb&&mb);for(var ob in jb)v.conditionClass(this._tabElem,ob,!lb&&!mb&&jb[ob]);},updateTab:function(){ha.getThreadMeta(this._threadID,function(jb){if(!jb.is_subscribed){hb.inform('unsubscribed',this._threadID);return;}fa.renderAndSeparatedParticipantList(this._threadID,[this._getNode('name'),this._getNode('titlebarText')],{names_renderer:ga.renderShortNames,check_length:true});this._updateUnreadCount(jb);this.updateMultichatTooltip();this._updateArchiveWarning(jb);}.bind(this));},_updateArchiveWarning:function(jb){var kb=false;ca.get(ca.user,function(lb){kb=lb.employee;if(kb)ca.getMulti(jb.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_showArchiveWarningIfAllParticipantsAreEmployees:function(jb){var kb=true;for(var lb in jb)kb=kb&&jb[lb].employee;var mb=this._getNode('titanArchiveWarning');if(mb){if(this._titlebarTooltipAnchor)v.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',kb);v.conditionShow(mb,kb);}},updateMultichatTooltip:function(){if(ha.isMultichatThread(this._threadID))ha.getThreadMeta(this._threadID,function(jb){ab(this._titlebarTooltipAnchor,jb.participants);}.bind(this));},_getNode:function(jb){return this._tabTemplate.getNode(jb);},_getCanonicalUserID:function(){return ha.getCanonicalUserInThread(this._threadID);},_listen:function(jb,event,kb,lb){var mb=this._getNode(jb);if(mb){this._eventListeners.push(Event.listen(mb,event,kb.bind(this)));}else if(!lb)throw new Error('Could not find node "'+jb+'"');},_closeClicked:function(jb){hb.inform('closed-tab',this._threadID);jb.prevent();},_nubClicked:function(){return hb.inform('nub-activated',this._threadID);},_dockKeyDown:function(event){if(event.keyCode===aa.RETURN||event.keyCode===aa.SPACE){hb.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===aa.ESC){hb.inform('esc-pressed',this._threadID);event.kill();}else if(event.keyCode===aa.TAB){var jb=hb.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!jb&&event.kill();}},_isTitleTextLinked:function(){var jb=this._getCanonicalUserID();return jb&&n.get('chat_tab_title_link_timeline');},_titleClicked:function(event){var jb=event.getTarget(),kb=ka.byClass(jb,'titlebarText'),lb=kb&&this._isTitleTextLinked();if(!lb&&!ka.byClass(jb,'uiSelector')&&!ka.byClass(jb,'addToThread'))hb.inform('lower-activated',this._threadID);},_callClicked:function(jb){var kb=this._getCanonicalUserID();if(ra.availableForCall(kb)){var lb='chat_tab_icon';if(jb.target&&v.hasClass(jb.target,'video_call_promo')){lb='chat_tab_icon_promo';}else if(jb.target&&v.hasClass(jb.target,'video_call_tour'))lb='chat_tab_icon_tour';hb.inform('video-call-clicked',{threadID:this._threadID,userID:kb,clickSource:lb});}return false;},_addFriendLinkClicked:function(){this._sheetController.openAddFriendsSheet();},_clearHistory:function(){var jb=ha.getThreadMetaNow(this._threadID);if(jb){var kb=this._getCanonicalUserID();da.clearChat(this._threadID,kb,jb.timestamp);}},_unsubscribeLinkClicked:function(){var jb=[];jb.push({name:'unsubscribe',label:"Leave Conversation",handler:this._unsubscribeToThread.bind(this)});jb.push(w.CANCEL);new w().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(jb).show();},_reportSpamClicked:function(){var jb=this._getCanonicalUserID(),kb=pa('/ajax/chat/report.php').addQueryData({id:jb}).addQueryData({src:'top_report_link'});i.send(new j(kb));},_focusTab:function(){v.addClass(this._tabElem,'focusedTab');hb.inform('focused',this._threadID);this._contextualDialogController.tabFocused();},_blurTab:function(){v.removeClass(this._tabElem,'focusedTab');},_inputKeyDown:function(event){if(event.keyCode===aa.RETURN&&!event.shiftKey){var jb=this._getNode('input'),kb=jb.value||'';if(!/^\s*$/.test(kb))ha.getThreadMeta(this._threadID,function(lb){var mb=ba.constructUserGeneratedMessageObject(kb,ta.MercurySourceType.CHAT_WEB,this._threadID);if(ha.isEmptyLocalThread(this._threadID)){var nb=da.tokenizeThreadID(this._threadID);mb.message_id=nb.value;mb.specific_to_list=lb.participants;}ba.sendMessage(mb);this._getNode('input').value='';this._typingIndicator&&this._typingIndicator.resetState();this._messagesView&&this._messagesView.scrollToBottom();}.bind(this));event.kill();}if(event.keyCode===aa.DOWN&&event.shiftKey&&this._getNode('input').value===''){hb.inform('lower-activated',this._threadID);event.kill();return;}this._handleHotkeyPressed(event);},_chatConvClicked:function(){!y.getSelection()&&this.focus();},showTypingIndicator:function(jb){var kb=this._getCanonicalUserID()||(n.get('chat_multi_typ')&&ha.isMultichatThread(this._threadID));if(kb)v.conditionClass(this._tabElem,'typing',jb);},_updateUnreadCount:function(jb){var kb=jb.unread_count;if(typeof kb!='undefined'){var lb=!!kb&&(!m.showsTabUnreadUI||m.showsTabUnreadUI()),mb=this._getNode('numMessages');v.conditionShow(mb,lb);v.conditionClass(this._tabElem,'highlightTab',lb);eb(this._threadID,this._tabElem,lb);y.setContent(mb,kb);}},_updateCallLink:function(jb){var kb=this._getNode('videoCallLink');if(u.isOnline()){var lb=this._getCanonicalUserID(),mb='fbid:'+lb;ca.get(mb,function(nb){if(ra.availableForCall(lb)){na.set(kb,xa._("Start a video call with {firstname}",{firstname:nb.short_name}));this._updateCallBackLinks(this._tabElem,true);}else{na.set(kb,xa._("{firstname} is currently unavailable for video calling",{firstname:nb.short_name}));this._hideVideoCallouts();this._updateCallBackLinks(this._tabElem,false);}}.bind(this));}else{na.set(kb,"You must be online to make a call.");this._hideVideoCallouts();this._updateCallBackLinks(document.body,false);}},_updateCallBackLinks:function(jb,kb){var lb=y.scry(jb,'a.callBackLink');if(kb){lb.forEach(v.show);}else lb.forEach(v.hide);},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_updatePrivacyLink:function(jb){if(jb==q.OFFLINE){y.setContent(this._privacyLink,"Go online");}else{var kb=this._getCanonicalUserID(),lb='fbid:'+kb;ca.get(lb,function(mb){var nb=null;if(jb==q.BLOCKED){if(sa.ChatControlLanguageChangeGK){nb=xa._("Turn On Chat for {name}",{name:mb.short_name});}else nb=xa._("Go Online to {name}",{name:mb.short_name});}else if(sa.ChatControlLanguageChangeGK){nb=xa._("Turn Off Chat for {name}",{name:mb.short_name});}else nb=xa._("Go Offline to {name}",{name:mb.short_name});y.setContent(this._privacyLink,nb);}.bind(this));}},_unsubscribeToThread:function(){if(ha.isEmptyLocalThread(this._threadID)){hb.inform('unsubscribed',this._threadID);}else{var jb=ba.constructLogMessageObject(ta.MercurySourceType.CHAT_WEB,this._threadID,ta.MercuryLogMessageType.UNSUBSCRIBE,{});ba.sendMessage(jb);}return true;},_emoticonView:null});e.exports=hb;});
__d("ChatNewMessageHandler",["ChatActivity","ChatTabModel","ChatTabView","JSLogger","MercuryAssert","MercuryBrowserAlerts","MercuryThreads","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('ChatActivity'),h=b('ChatTabModel'),i=b('ChatTabView'),j=b('JSLogger'),k=b('MercuryAssert'),l=b('MercuryBrowserAlerts'),m=b('MercuryThreads'),n=b('MercuryUnseenState'),o=j.create('chat_new_message'),p={_raiseTab:function(q,r){var s=h.getTab(q),t=false;if(s){t=s.raised;}else{h.raiseTab(q,false);t=true;}r.to_new_tab=!s;r.to_raised_tab=!!t;},_notify:function(q,r,s){var t=i.get(q);s.view_is_visible=t&&t.isVisible();s.view_is_focused=t&&t.isFocused();if(!s.view_is_visible)o.log('message_to_hidden');s.is_active=g.isActive();l.messageReceived(r);},newMessage:function(q,r){k.isThreadID(q);var s={thread_id:q,message_id:r.message_id};this._raiseTab(q,s);this._notify(q,r,s);o.log('message',s);}};l.subscribe('before-alert',function(q,event){var r=event.threadID,s=i.get(r),t=h.getTab(r);if(t&&t.raised&&s&&s.isVisible()&&s.isFocused()){m.changeThreadReadStatus(r,true);n.markThreadSeen(r);event.cancelAlert();}});e.exports=p;});
__d("ChatTabPresence",["Arbiter","AvailableList","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('ChatTabModel'),j=b('MercuryThreads'),k={};function l(m){var n=j.getCanonicalUserInThread(m);if(n)h.updateForID(n);}i.subscribe('chat/tabs-changed',function(event,m){m.tabs.forEach(function(n){if(n.raised&&!k[n.id])l(n.id);});k={};m.tabs.forEach(function(n){if(n.raised)k[n.id]=true;});});e.exports={};});
__d("ChatTabPolicy",["ChatBehavior","ChatConfig","FBDesktopPlugin","JSLogger","MercuryAssert","MercuryParticipants","MercuryThreads","MercuryUnseenState","PresencePrivacy","ShortProfiles","MercuryConstants"],function(a,b,c,d,e,f){var g=b('ChatBehavior'),h=b('ChatConfig'),i=b('FBDesktopPlugin'),j=b('JSLogger'),k=b('MercuryAssert'),l=b('MercuryParticipants'),m=b('MercuryThreads'),n=b('MercuryUnseenState'),o=b('PresencePrivacy'),p=b('ShortProfiles'),q=c('MercuryConstants'),r=j.create('tab_policy');function s(t,u){n.markThreadSeen(t,u);}e.exports={messageIsAllowed:function(t,u,v){var w=t.thread_id,x=u.message_id;k.isThreadID(w);k.isParticipantID(u.author);var y;if(t.mode==q.MercuryThreadMode.OBJECT_ORIGINATED){y={thread_id:w,message_id:x,mode:t.mode};r.log('message_object_originated',y);return;}var z=q.MercurySourceType;if(u.source==z.EMAIL||u.source==z.TITAN_EMAIL_REPLY){y={thread_id:w,message_id:x,source:u.source};r.log('message_source_not_allowed',y);return;}var aa=l.getUserID(u.author);if(!aa){r.log('message_bad_author',{thread_id:w,message_id:x,user:aa});return;}if(u.action_type!=q.MercuryActionType.USER_GENERATED_MESSAGE){y={thread_id:w,message_id:x,type:u.action_type};r.log('message_non_user_generated',y);return;}if(t.is_canonical_user&&!g.notifiesUserMessages()){r.log('message_jabber',{thread_id:w,message_id:x});s(w,true);return;}if(i.shouldSuppressMessages()){r.log('message_desktop',{thread_id:w,message_id:x});return;}if(t.folder!=q.MessagingTag.INBOX){r.log('message_folder',{thread_id:w,message_id:x,folder:t.folder});return;}p.get(aa,function(ba){if(!o.allows(aa)){r.log('message_privacy',{thread_id:w,message_id:x,user:aa});return;}if(ba.type!='friend'){r.log('message_non_friend',{thread_id:w,message_id:x,user:aa});return;}v();});}};});
__d("ChatTabViewSelector",["Arbiter","copyProperties","CSS","DataStore","DOM","Menu","MercuryThreadInformer","MercuryThreads","NubController","MercuryThreadMetadataRenderer","Toggler","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('Menu'),m=b('MercuryThreadInformer'),n=b('MercuryThreads'),o=b('NubController'),p=b('MercuryThreadMetadataRenderer'),q=b('Toggler'),r=c('ChatTabTemplates');function s(t){var u=r[':fb:chat:tab:selector'].build(),v=u.getRoot(),w=u.getNode('menu'),x=k.find(w,'.uiMenuInner'),y={},z=new o().init(v);i.hide(v);k.insertBefore(t,v);function aa(da){var ea=0;for(var fa in y){var ga=y[fa],ha=n.getThreadMetaNow(fa),ia=ga.getNode('unreadCount'),ja=(ha&&ha.unread_count)||0;ea+=ja;if(ja>9)ja='+';i.conditionClass(ia,'invisible_elem',!ja);k.setContent(ia,ja);}var ka=u.getNode('numMessages');i.conditionShow(ka,ea);k.setContent(ka,ea);}this.setTabData=function(da){y={};if(da.length<1){i.hide(v);return;}i.show(v);k.empty(x);da.forEach(function(ea){var fa=r[':fb:chat:tab:selector:item'].build();y[ea.id]=fa;var ga=fa.getNode('content');p.renderAndSeparatedParticipantList(ea.id,ga);k.prependContent(x,fa.getRoot());j.set(fa.getRoot(),'threadID',ea.id);});z.flyoutContentChanged();k.setContent(u.getNode('numTabs'),da.length);aa();};function ba(event,da){if(da.menu!=w)return;var ea=j.get(da.item,'threadID');s.inform('selected',ea);q.hide(v);}function ca(event,da){l.register(w);}l.subscribe('select',ba.bind(this));q.listen('show',v,function(){g.inform('layer_shown',{type:'ChatTabSelector'});ca();});q.listen('hide',v,function(){g.inform('layer_hidden',{type:'ChatTabSelector'});});m.subscribe('threads-updated',aa);}h(s,new g());e.exports=s;});
__d("ChatTabController",["ChatTabPresence","Arbiter","AsyncRequest","ChatActivity","ChatConfig","ChatNewMessageHandler","ChatTabMessagesView","ChatTabModel","ChatTabPolicy","ChatTabView","ChatTabViewSelector","ChatTitleBarBlinker","Dialog","JSLogger","MercuryMessages","MercuryParticipants","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","MercuryUnseenState","Style","UserAgent","VideoCallCore"],function(a,b,c,d,e,f){b('ChatTabPresence');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('ChatActivity'),j=b('ChatConfig'),k=b('ChatNewMessageHandler'),l=b('ChatTabMessagesView'),m=b('ChatTabModel'),n=b('ChatTabPolicy'),o=b('ChatTabView'),p=b('ChatTabViewSelector'),q=b('ChatTitleBarBlinker'),r=b('Dialog'),s=b('JSLogger'),t=b('MercuryMessages'),u=b('MercuryParticipants'),v=b('MercuryServerRequests'),w=b('MercuryThreadInformer'),x=b('MercuryThreads'),y=b('MercuryUnseenState'),z=b('Style'),aa=b('UserAgent'),ba=b('VideoCallCore'),ca=j.get('tab_auto_close_timeout')||7200000,da=s.create('tab_controller');function ea(pa){x.changeThreadReadStatus(pa,true);fa(pa);}function fa(pa){y.markThreadSeen(pa);}function ga(){var pa=m.get();pa.tabs.forEach(function(qa){var ra=o.get(qa.id);if(qa.raised&&ra&&ra.isVisible())ea(qa.id);});}function ha(){var pa=m.get();pa.tabs.forEach(function(qa){fa(qa.id);});}function ia(pa,qa,ra){var sa=m.get().tabs;pa+=qa?1:-1;while(pa>=0&&pa<sa.length){var ta=sa[pa],ua=o.get(ta.id);if(ua&&ua.isVisible()&&(!ra||ta.raised)){ua.focus();return true;}pa+=qa?1:-1;}return false;}function ja(pa){function qa(ta){var ua=pa.shouldPromoteOnRaise(ta);g.inform("chat/promote-tab",ta);if(ua){m.raiseAndPromoteTab(ta,true);}else m.raiseTab(ta,true);var va=o.get(ta);va&&va.focus();}function ra(ta,ua){var va=m.get(),wa=pa.getMaxTabsToShow(),xa=m.indexOf(ta);m.closeTabAndDemote(ta,wa-2,ua);return xa;}p.subscribe('selected',function(ta,ua){qa(ua);});g.subscribe('chat/open-tab',function(ta,ua){qa(ua.thread_id);});g.subscribe('page_transition',function(ta,ua){m.closeFragileTabs();});v.subscribe('model-update-completed',ha);o.subscribe('focused',function(event,ta){ea(ta);});i.subscribe('idle',function(ta,ua){if(ua>ca){var va=m.get().tabs;va.forEach(function(wa){var xa=wa.id;x.getThreadMeta(xa,function(ya){if(!ya.unread_count){da.log('autoclose_idle_seen',{thread_id:xa,idleness:ua});m.closeTab(xa,'autoclose_idle_seen');}});});}});o.subscribe('nub-activated',function(ta,ua){qa(ua);});o.subscribe('lower-activated',function(ta,ua){m.lowerTab(ua);var va=o.get(ua);va&&va.focus();ea(ua);});function sa(ta,ua){ba.showOutgoingCallDialog(ua.userID,ua.clickSource);m.lowerTab(ua.threadID);}o.subscribe('video-call-clicked',sa);l.subscribe('video-call-clicked',sa);o.subscribe('closed-tab',function(ta,ua){da.log('close_view',{thread_id:ua});ra(ua,'close_view');ea(ua);return false;});o.subscribe('thread-deleted',function(ta,ua){da.log('close_thread_deleted',{thread_id:ua});ra(ua,'close_thread_deleted');return false;});o.subscribe('unsubscribed',function(ta,ua){da.log('close_view_unsubscribed',{thread_id:ua});ra(ua,'close_view_unsubscribed');return false;});o.subscribe('esc-pressed',function(ta,ua){da.log('close_esc',{thread_id:ua});var va=ra(ua,'close_esc');ia(va-1,true,true)||ia(va,false,true);});w.subscribe('messages-received',function(ta,ua){for(var va in ua){var wa=ua[va];for(var xa=0;xa<wa.length;xa++){var ya=wa[xa];if(ya.author!=u.user){if(!ya.is_unread){da.log('message_already_read',{action_id:ya.action_id,thread_id:ya.thread_id});continue;}x.getThreadMeta(va,function(za){n.messageIsAllowed(za,ya,function(){k.newMessage(va,ya);});});}}}});w.subscribe('thread-read-changed',function(ta,ua){for(var va in ua)if(!ua[va].mark_as_read){da.log('autoclose_marked_unread',{thread_id:va});m.closeTab(va,'autoclose_marked_unread');}});o.subscribe('tab-pressed',function(ta,ua){return !ia(m.indexOf(ua.id),ua.shiftPressed);});g.subscribe(s.DUMP_EVENT,function(ta,ua){ua.chat_controller={auto_close_timeout:ca};});}if(aa.firefox()){var ka=function(){return z.get(document.body,'overflowX')+' '+z.get(document.body,'overflowY');},la=ka(),ma=function(){var pa=ka();if(pa!==la){la=pa;g.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var na=new MutationObserver(ma),oa={attributes:true,attributeFilter:['class','style']};na.observe(document.documentElement,oa);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))ma();},false);}e.exports=ja;});
__d("ChatTabViewCoordinator",["Arbiter","ChatConfig","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","VideoCallCore"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatConfig'),i=b('ChatTabModel'),j=b('ChatTabView'),k=b('ChatTabViewSelector'),l=b('CSS'),m=b('VideoCallCore');function n(o,p){var q=new k(o),r={},s=false;function t(){var y=i.get(),z={};y.tabs.forEach(function(ba){z[ba.id]=1;});for(var aa in r)if(!z[aa]){r[aa].destroy();delete(r[aa]);}u(y);v(y);}function u(y){var z=null;y.tabs.forEach(function(aa){var ba=aa.id,ca=false;if(!r[ba]){r[ba]=new j(ba,aa.server_id);ca=true;}if(ca||!r[ba].nextTabIs(z))if(z){r[ba].insertBefore(z);}else r[ba].appendTo(o);z=r[ba];});}function v(y){var z=p.getTabsToShow(y),aa=[],ba=false;y.tabs.forEach(function(ca){if(!z[ca.id]){r[ca.id].setVisibleState(false,ca.raised);aa.push(ca);}});y.tabs.forEach(function(ca){if(z[ca.id]){r[ca.id].setVisibleState(true,ca.raised);ba|=ca.raised;}});q.setTabData(aa);x(ba);}function w(y){for(var z=0,aa=y.tabs.length;z<aa;z++){var ba=y.tabs[z];if(ba.raised)if(ba.id===y.promoted||z<p.getMaxTabsToShow()-1)return true;}return false;}function x(y){if(!y&&s){g.inform('layer_hidden',{type:'ChatTab'});s=false;}else if(y&&!s){g.inform('layer_shown',{type:'ChatTab'});s=true;}}if(m.isSupported())l.addClass(o,'videoCallEnabled');p.subscribe('tabs-changed',t);t();}e.exports=n;});
__d("TabsViewport",["event-extensions","ArbiterMixin","ChatConfig","ChatTabModel","Class","CSS","Dock","DOM","Parent","Vector","areObjectsEqual","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('ChatConfig'),i=b('ChatTabModel'),j=b('Class'),k=b('CSS'),l=b('Dock'),m=b('DOM'),n=b('Parent'),o=b('Vector'),p=b('areObjectsEqual'),q=b('copyProperties');function r(s){this._root=s;Event.listen(window,'resize',this._recalculateWidth.bind(this));l.subscribe('resize',this._recalculateWidth.bind(this));i.subscribe('chat/tabs-changed',this._recalculateTabs.shield(this,true));this._recalculateWidth();this._initialized=true;}q(r.prototype,g,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var s=r._getAvailableDockWidth(this._root),t=Math.max(1,Math.floor(s/264)),u=t!=this._maxShown;if(!this._viewState||u||s<=this._viewState.usedWidth||s>this._viewState.widthToShowNext){this._availableWidth=s;this._maxShown=t;this._viewState=null;this._recalculateTabs(u);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(s){var t=r._getTabsToShow(i.get(),this._availableWidth);if(s||!p(this._viewState,t)){this._viewState=t;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},shouldPromoteOnRaise:function(s){if(!this._viewState.tabsToShow[s])return true;if(this._viewState.nextToHide!=s)return false;var t=i.getTab(s),u=t&&t.raised;return !u&&(this._availableWidth-this._viewState.usedWidth<100);}});q(r,{_getAvailableDockWidth:function(s){var t=o.getViewportDimensions().x;t-=230;t-=50;var u=n.byClass(s,'fbDock'),v=o.getElementDimensions(u),w=n.byClass(s,'fbDockChat'),x=o.getElementDimensions(w),y=v.x-x.x;t-=y;t-=20;return Math.max(t,0);},_getTabsToShow:function(s,t){var u=164,v=264;t=Math.max(t,v+1);function w(la){return la.raised?v:u;}var x=JSON.parse(JSON.stringify(s.tabs)),y=-1,z=null;if(s.promoted)x.forEach(function(la,ma){if(la.id===s.promoted){y=ma;z=la;}});var aa=0,ba=0,ca=!z;x.forEach(function(la,ma){var na=w(la);la.leftmostOffset=aa+v;aa+=na;if(la.leftmostOffset<t)ba++;ca|=ma==y;la.alreadyPlacedPromoted=ca;});function da(la,ma,na){var oa={};for(var pa=0;pa<ma;pa++){var qa=la[pa];if(!qa.alreadyPlacedPromoted&&pa==ma-1){oa[na]=true;}else oa[qa.id]=true;}return oa;}var ea=da(x,ba,s.promoted),fa=da(x,ba-1,s.promoted),ga=null;for(var ha in ea)if(!fa[ha])ga=ha;var ia=x[ba-1],ja=ia?ia.leftmostOffset:0,ka=Infinity;if(ba<x.length)ka=x[ba].leftmostOffset;return {nextToHide:ga,tabsToShow:ea,usedWidth:ja,widthToShowNext:ka};}});e.exports=r;});
__d("MercuryStateCheck",["Arbiter","copyProperties","ChannelConstants","MercuryFolders","MercuryServerRequests","URI","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('ChannelConstants'),j=b('MercuryFolders'),k=b('MercuryServerRequests'),l=b('URI'),m=c('MercuryConstants'),n=h(new g(),{initialize:function(){g.subscribe(i.ON_INVALID_HISTORY,o);d(['ChannelConnection'],function(p){p.subscribe(p.CONNECTED,function(q,r){if(!r.init)o();});});}});function o(){var p;if(l.getRequestURI().getPath().search(/messages/)!==-1){p=j.getSupportedFolders();}else p=[m.MessagingTag.INBOX];k.fetchMissedMessages(p);}n.initialize();e.exports=n;});
__d("legacy:CompactTypeaheadRenderer",["CompactTypeaheadRenderer"],function(a,b,c,d){if(!a.TypeaheadRenderers)a.TypeaheadRenderers={};a.TypeaheadRenderers.compact=b('CompactTypeaheadRenderer');},3);